<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>能源综合管理平台项目实战 | ShuoChennn's Blog</title><meta name="keywords" content="前端,TypeScript,Vue,pinia,Vite,Element-plus"><meta name="author" content="ShuoChennn"><meta name="copyright" content="ShuoChennn"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.项目介绍动力港能源管理平台是基于公司充电能源业务，结合互联网技术，实现网络化管理，与云平台实现数据共享和远程控制，使用更加便捷和智能化。便于公司对能源设备的集中管理和监测，优化充电结构，提高充电效率。 1.项目技术栈Vue3 + vue-router 4.x + pinia + TypeScript + Vite + element plus + axios + less + echarts">
<meta property="og:type" content="article">
<meta property="og:title" content="能源综合管理平台项目实战">
<meta property="og:url" content="http://example.com/post/355b5773.html">
<meta property="og:site_name" content="ShuoChennn&#39;s Blog">
<meta property="og:description" content="1.项目介绍动力港能源管理平台是基于公司充电能源业务，结合互联网技术，实现网络化管理，与云平台实现数据共享和远程控制，使用更加便捷和智能化。便于公司对能源设备的集中管理和监测，优化充电结构，提高充电效率。 1.项目技术栈Vue3 + vue-router 4.x + pinia + TypeScript + Vite + element plus + axios + less + echarts">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2025-07-01T10:56:21.000Z">
<meta property="article:modified_time" content="2025-07-01T19:10:56.470Z">
<meta property="article:author" content="ShuoChennn">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="TypeScript">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="pinia">
<meta property="article:tag" content="Vite">
<meta property="article:tag" content="Element-plus">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="http://example.com/post/355b5773"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '能源综合管理平台项目实战',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-02 03:10:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/tzy13755126023/BLOG_SOURCE/css/function.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博客</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影评</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ShuoChennn's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博客</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影评</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">能源综合管理平台项目实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-01T10:56:21.000Z" title="发表于 2025-07-01 18:56:21">2025-07-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-01T19:10:56.470Z" title="更新于 2025-07-02 03:10:56">2025-07-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="能源综合管理平台项目实战"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1.项目介绍"></a>1.项目介绍</h1><p>动力港能源管理平台是基于公司充电能源业务，结合互联网技术，实现网络化管理，与云平台实现数据共享和远程控制，使用更加便捷和智能化。便于公司对能源设备的集中管理和监测，优化充电结构，提高充电效率。</p>
<h2 id="1-项目技术栈"><a href="#1-项目技术栈" class="headerlink" title="1.项目技术栈"></a>1.项目技术栈</h2><p><strong>Vue3 + vue-router 4.x + pinia + TypeScript + Vite + element plus + axios + less + echarts + 高德地图api + TinyMCE富文本编辑器</strong></p>
<h1 id="2-创建项目"><a href="#2-创建项目" class="headerlink" title="2.创建项目"></a>2.创建项目</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm create vite@latest my-vue-admin --template vue-ts</span><br></pre></td></tr></table></figure>

<p>直接选择vite给我提供的现成的模板</p>
<p>安装依赖：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install vue<span class="literal">-router</span>@<span class="number">4</span> pinia element<span class="literal">-plus</span></span><br></pre></td></tr></table></figure>

<p><strong>项目文件中关于：</strong></p>
<ul>
<li><p>**tsconfig.app.json:**一般用于更精细的控制编译选项，特别是与应用程序相关的选项，如 JSX 支持或模块解析策略等</p>
</li>
<li><p>**tsconfig.json:**是最基本的配置文件，提供全局设置</p>
</li>
<li><p>**tsconfig.node.json:**为 Node.js 环境或后台代码提供的 TypeScript 配置文件。通常用于配置 Node.js 脚本或服务（如 API 服务）的 TypeScript 编译选项</p>
</li>
<li><p><strong>vite-env.d.ts</strong>:全局类型声明</p>
</li>
</ul>
<p>安装less</p>
<p>package.json:</p>
<ul>
<li>“dependencies”:生产依赖，项目上线时一起打包上传服务器;</li>
<li>“devDependencies”:开发依赖，项目上线时不打包上传服务器，节约资源</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install <span class="literal">-D</span> less</span><br></pre></td></tr></table></figure>

<h2 id="常见报错解决："><a href="#常见报错解决：" class="headerlink" title="常见报错解决："></a>常见报错解决：</h2><p>如果更改了@符号，提示找不到模块 ‘@&#x2F;components&#x2F;xxx.vue’ 或其相应的类型声明”</p>
<p><img src="D:/Software/Typora/images/image-20240828140028681.png" alt="image-20240828140028681"></p>
<h1 id="3-创建文件夹结构"><a href="#3-创建文件夹结构" class="headerlink" title="3.创建文件夹结构"></a>3.创建文件夹结构</h1><ol>
<li>src目录下创建store用来存放pinia相关文件</li>
<li>src目录下创建router文件夹用来存放路由相关文件</li>
<li>src目录下创建views文件夹，用来存放我们的相关页面</li>
<li>src目录下创建utils文件夹，用来存放我们封装的一些工具函数</li>
</ol>
<h1 id="4-基本路由结构的创建"><a href="#4-基本路由结构的创建" class="headerlink" title="4.基本路由结构的创建"></a>4.基本路由结构的创建</h1><p>&#x3D;&#x3D;src-router-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory,<span class="title class_">RouteRecordRaw</span>  &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">RouteRecordRaw</span>[]=[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;Home&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&quot;../views/Home.vue&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;about&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&quot;../views/About.vue&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;main.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.less&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(router)<span class="comment">//app.use(router) 是将 Vue Router 插件添加到 Vue 应用中。这意味着你的应用将能够使用路由功能</span></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;App.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;RouterView/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-配置-src路径"><a href="#5-配置-src路径" class="headerlink" title="5.配置@ src路径"></a>5.配置@ src路径</h1><p>因为相对路径每次找很麻烦，我们可以使用@，表示src目录</p>
<p>只需要在</p>
<p>&#x3D;&#x3D;vite.config.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>此时可能会有报错，如下</p>
<p><img src="D:/Software/Typora/images/image-20241014143019905.png" alt="image-20241014143019905"></p>
<p>只需要运行：</p>
<p>在你的项目中安装 Node.js 的 TypeScript 类型定义</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install @types/node <span class="literal">--save-dev</span></span><br></pre></td></tr></table></figure>

<p>另外直接修改的话会看到有报错：</p>
<p><img src="D:/Software/Typora/images/image-20241014142310973-17513419767151.png" alt="image-20241014142310973"></p>
<p>只需要去tsconfig.app.json文件增加一个配置：即可,如下</p>
<p><img src="D:/Software/Typora/images/image-20241014142908128-17513419767162.png" alt="image-20241014142908128"></p>
<h1 id="6-项目基础路由搭建"><a href="#6-项目基础路由搭建" class="headerlink" title="6.项目基础路由搭建"></a>6.项目基础路由搭建</h1><p>将基础路由单独抽离为一个文件</p>
<p>&#x3D;&#x3D;src-router-basicRouteMap.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouteRecordRaw</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">RouteRecordRaw</span>[] =[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;Home&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&quot;@/layouts/DefaultLayout.vue&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/Login.vue&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)*&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;NotFound&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/NotFound.vue&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> routes</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;src-router-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">&quot;./basicRouteMap.ts&quot;</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<h1 id="7-登录页面搭建"><a href="#7-登录页面搭建" class="headerlink" title="7.登录页面搭建"></a>7.登录页面搭建</h1><h2 id="1-静态基础结构搭建"><a href="#1-静态基础结构搭建" class="headerlink" title="1.静态基础结构搭建"></a>1.静态基础结构搭建</h2><p>参照element-plus官网案例</p>
<h2 id="2-基础逻辑处理"><a href="#2-基础逻辑处理" class="headerlink" title="2.基础逻辑处理"></a>2.基础逻辑处理</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form :model=&quot;ruleForm&quot; label=&quot;用户名&quot; :rules=&quot;rules&quot;  ref=&quot;formRef&quot;&gt;</span><br><span class="line">     &lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">         &lt;el-input v-model=&quot;ruleForm.username&quot; placeholder=&quot;请输入用户名&quot; prefix-icon=&quot;User&quot;/&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">     &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">         &lt;el-input v-model=&quot;ruleForm.password&quot; placeholder=&quot;请输入密码&quot; prefix-icon=&quot;Lock&quot;/&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">     &lt;el-form-item&gt;</span><br><span class="line">         &lt;el-button type=&quot;primary&quot; style=&quot;width: 100%;&quot; &gt;登录&lt;/el-button&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line"> &lt;/el-form&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; reactive &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123; FormRules &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import logo from &quot;@/assets/logo.png&quot; //通过模块化的方式引入图片</span><br><span class="line">interface RuleForm &#123;</span><br><span class="line">  username: string;</span><br><span class="line">  password: string</span><br><span class="line">&#125;</span><br><span class="line">const ruleForm: RuleForm = reactive(&#123; //reactive官网有明确说明，不推荐使用泛型的写法</span><br><span class="line">  username: &quot;&quot;,</span><br><span class="line">  password: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const formRef = ref&lt;FormInstance&gt;();</span><br><span class="line">const rules = reactive&lt;FormRules&lt;RuleForm&gt;&gt;(&#123;</span><br><span class="line">  username: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入用户名&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 3, max: 8, message: &#x27;用户名要求3到8位字符&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">  ],</span><br><span class="line">  password: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>登录按钮事件</strong>:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  formRef.<span class="property">value</span>?.<span class="title function_">validate</span>(<span class="keyword">async</span> (<span class="attr">valid</span>: <span class="built_in">boolean</span>) =&gt; &#123; <span class="comment">//?.可选链操作符 </span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(valid)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于可选链操作符：</p>
<blockquote>
<p>可选链操作符 (<code>?.</code>) 是 JavaScript 中提供的一种简洁安全的访问嵌套属性的方法。使用可选链操作符的目的是避免在访问链中任意为 <code>null</code> 或 <code>undefined</code> 的情况引发运行时错误。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">someObject?.<span class="property">someProperty</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段代码会安全地尝试访问 <code>someObject</code> 的 <code>someProperty</code> 属性。如果 <code>someObject</code> 是 <code>null</code> 或 <code>undefined</code>，则整个表达式会返回 <code>undefined</code>，而不会抛出异常。</p>
</blockquote>
<p><strong>关于rules校验规则</strong></p>
<ol>
<li><strong>required</strong>: 是否必填，值为 <code>true</code> 或 <code>false</code>。</li>
<li><strong>message</strong>: 验证失败时的提示信息。</li>
<li><strong>trigger</strong>: 设置触发验证的时机，可以是 <code>blur</code>、<code>change</code> 等。</li>
<li><strong>min</strong> 和 <strong>max</strong>: 适用于字符串和数组，设置最小值和最大值。</li>
<li><strong>type</strong>: 数据类型，比如 <code>string</code>、<code>number</code>、<code>boolean</code>、<code>array</code>、<code>date</code> 等。</li>
<li><strong>pattern</strong>: 正则表达式，用于验证输入。</li>
</ol>
<h2 id="3-登录的接口处理"><a href="#3-登录的接口处理" class="headerlink" title="3.登录的接口处理"></a>3.登录的接口处理</h2><p>登录返回的用户数据是存储在store中，所以我们去store中定义</p>
<p>&#x3D;&#x3D;src-store-auth.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore=<span class="title function_">defineStore</span>(<span class="string">&quot;user&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">state</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">        <span class="attr">token</span>:<span class="literal">null</span>,</span><br><span class="line">        <span class="attr">roles</span>:[],</span><br><span class="line">        <span class="attr">username</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>既然用到了pinia，别忘了去main.ts中将pinia加入到我们的项目中</p>
<p>&#x3D;&#x3D;main.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./mock/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./router/guard&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./style.css&quot;</span></span><br><span class="line"><span class="comment">// 如果您正在使用CDN引入，请删除下面一行。</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(key, component)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>因为点击登陆之后，修改store中的数据，所以我们把登录的逻辑在action中写，现在我们需要后端接口，所以我们安装一下mockjs</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install mockjs -D</span><br></pre></td></tr></table></figure>



<p>src目录下新建mock文件夹，里面写index.ts</p>
<p>&#x3D;&#x3D;src-mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span>;</span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">setup</span>(&#123;</span><br><span class="line">  <span class="attr">timeout</span>: <span class="string">&#x27;200-600&#x27;</span> <span class="comment">// 设置延迟时间</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//管理员权限菜单</span></span><br><span class="line"><span class="keyword">const</span> menulist = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/dashboard&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;DataLine&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;充电站管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/chargingstation&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Lightning&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;充电站监控&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/monitor&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;VideoCamera&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;营收统计&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/revenue&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;DataAnalysis&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;充电桩管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/fault&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Warning&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;电子地图&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/map&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;MapLocation&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;运营管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/operations&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Files&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;订单管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/orders&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;DocumentCopy&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;订单详情&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/detail&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Share&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;计费管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/total&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Money&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;报警管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/alarm&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Phone&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;会员卡管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/equipment&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Magnet&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;招商管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/document&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Document&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;系统设置&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/system&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Setting&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;个人中心&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/personal&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;User&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">//运营专员权限菜单</span></span><br><span class="line"><span class="keyword">const</span> menulist2 = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/dashboard&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;DataLine&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;充电站管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/chargingstation&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Lightning&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;充电站监控&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/monitor&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;VideoCamera&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;营收统计&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/revenue&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;DataAnalysis&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;充电桩管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/chargingstation/fault&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Warning&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;电子地图&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/map&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;MapLocation&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;运营管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/operations&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Files&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;订单管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/orders&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;DocumentCopy&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;订单详情&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/detail&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Share&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;计费管理&quot;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&quot;/operations/total&quot;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;Money&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;报警管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/alarm&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Phone&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;会员卡管理&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/equipment&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;Magnet&quot;</span></span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;个人中心&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/personal&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;User&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">//登录接口</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&#x27;https://www.demo.com/login&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="function">(<span class="params">options: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(options.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span> (username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; password === <span class="string">&#x27;admin666&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登陆成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;admintokenkkljbuo2w9xla2&#x27;</span>,</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">username</span>: <span class="string">&#x27;赖军&#x27;</span>,</span><br><span class="line">          <span class="attr">roles</span>: [<span class="string">&#x27;admin&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">menulist</span>: menulist</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (username === <span class="string">&#x27;user&#x27;</span> &amp;&amp; password === <span class="string">&#x27;user666&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登陆成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;usertokenlkg55dws5ch4ew97cl&#x27;</span>,</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">username</span>: <span class="string">&#x27;江霞&#x27;</span>,</span><br><span class="line">          <span class="attr">roles</span>: [<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">menulist</span>: menulist2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;用户名或者密码有误&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里可能会有个报错</p>
<p><img src="D:/Software/Typora/images/image-20241016154349994.png" alt="image-20241016154349994"></p>
<p>我们要去全局类型声明文件配置一下</p>
<p>&#x3D;&#x3D;src-vite-env.d.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&quot;mockjs&quot;</span>  </span><br></pre></td></tr></table></figure>

<p>作用是：告诉编译器存在一个名为 <code>mockjs</code> 的模块</p>
<p>另外别忘了去main.ts文件下引入mock文件</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./mock/index&quot;</span>;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>创建api文件夹用来存放项目的所有api接口调用文件</p>
</blockquote>
<h2 id="4-axios二次封装"><a href="#4-axios二次封装" class="headerlink" title="4.axios二次封装"></a>4.axios二次封装</h2><p>发送请求我们需要使用axios，所以我们去安装</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;utils-axios.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">AxiosError</span>, <span class="title class_">InternalAxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElNotification</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 axios 实例</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">service</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&quot;https://www.demo.com&quot;</span>,<span class="comment">//后期我们会把它替换成环境变量</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">config: InternalAxiosRequestConfig</span>) =&gt;</span> &#123; </span><br><span class="line">        <span class="comment">// 可以在这里添加认证 token</span></span><br><span class="line">        <span class="comment">// config.headers[&#x27;Authorization&#x27;] = &#x27;Bearer &#x27; + getToken();</span></span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 请求错误处理</span></span><br><span class="line">        <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Request Error: &#x27;</span> + error.<span class="property">message</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">response: AxiosResponse</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">// 根据实际业务修改状态码不是 200 时的逻辑</span></span><br><span class="line">            <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">                <span class="attr">message</span>: res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Response Error: &#x27;</span> + error.<span class="property">message</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>

<h2 id="5-封装get-post请求"><a href="#5-封装get-post请求" class="headerlink" title="5.封装get post请求"></a>5.封装get post请求</h2><p>&#x3D;&#x3D;utils-http.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> service <span class="keyword">from</span> <span class="string">&quot;./axios&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ResponseData</span>&#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">data</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 封装GET方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url: <span class="built_in">string</span>, params?: <span class="built_in">any</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ResponseData</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> service.<span class="title function_">get</span>(url,&#123;params&#125; );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 封装POST方法</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">post</span>(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ResponseData</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> service.<span class="title function_">post</span>(url, data);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">export</span> &#123; get, post &#125;;</span><br></pre></td></tr></table></figure>



<h2 id="6-创建登录请求"><a href="#6-创建登录请求" class="headerlink" title="6.创建登录请求"></a>6.创建登录请求</h2><p>&#x3D;&#x3D;src-api-user.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">Login</span> = <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LoginParams</span> &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">password</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loginApi</span>(<span class="params">data:LoginParams</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Login</span>,data)</span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">export</span> &#123;loginApi&#125;</span><br></pre></td></tr></table></figure>



<p>&#x3D;&#x3D;store-auth.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; loginApi &#125; <span class="keyword">from</span> <span class="string">&#x27;../api/user&#x27;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LoginParams</span> &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">password</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore=<span class="title function_">defineStore</span>(<span class="string">&quot;user&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">state</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">        <span class="attr">token</span>:<span class="literal">null</span>,</span><br><span class="line">        <span class="attr">roles</span>:[],</span><br><span class="line">        <span class="attr">username</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">data:LoginParams</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> res= <span class="keyword">await</span> <span class="title function_">loginApi</span>(data);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">          &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最后调整store里的逻辑</p>
<p>&#x3D;&#x3D;store-auth.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; loginApi &#125; <span class="keyword">from</span> <span class="string">&#x27;../api/user&#x27;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LoginParams</span> &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">password</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore=<span class="title function_">defineStore</span>(<span class="string">&quot;user&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">state</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">        <span class="attr">token</span>:sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>) || <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">roles</span>: sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;roles&#x27;</span>) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;roles&#x27;</span>)!) : [],</span><br><span class="line">        <span class="attr">username</span>:sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;username&quot;</span>) || <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">menu</span>:sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;menu&quot;</span>)?<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;menu&quot;</span>)!):[]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">data: LoginParams</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123;<span class="attr">data</span>:&#123;token,<span class="attr">user</span>:&#123;username,roles&#125;,menulist&#125;&#125; = <span class="keyword">await</span> <span class="title function_">loginApi</span>(data);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">token</span>=token;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">roles</span>=roles;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">menu</span>=menulist;</span><br><span class="line">                <span class="comment">// //既存到pinia中又存到本地存储中是因为第一pinia中数据是响应式第二存取速度要比本地存储快</span></span><br><span class="line">                sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">                sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;roles&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(roles))</span><br><span class="line">                sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;username&quot;</span>,username)</span><br><span class="line">                sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;menu&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(roles))</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录失败:&quot;</span>, error);</span><br><span class="line">                <span class="comment">// 这里可以处理错误，比如显示提示信息</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;Login.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  formRef.<span class="property">value</span>?.<span class="title function_">validate</span>(<span class="keyword">async</span> (<span class="attr">valid</span>: <span class="built_in">boolean</span>) =&gt; &#123; <span class="comment">//?.可选链操作符 </span></span><br><span class="line">    <span class="keyword">if</span>(valid)&#123;</span><br><span class="line">      userStore.<span class="title function_">login</span>(ruleForm)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-useRouter使用误区"><a href="#8-useRouter使用误区" class="headerlink" title="8.useRouter使用误区"></a>8.useRouter使用误区</h1><p>&#x3D;&#x3D;Login.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  formRef.<span class="property">value</span>?.<span class="title function_">validate</span>( <span class="function">(<span class="params">valid: <span class="built_in">boolean</span></span>) =&gt;</span> &#123; <span class="comment">//?.可选链操作符 </span></span><br><span class="line">    <span class="keyword">if</span>(valid)&#123;</span><br><span class="line">      userStore.<span class="title function_">login</span>(ruleForm);</span><br><span class="line">      router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样有个问题，如果用户用户名密码不正确，也可以跳转，所以有同学想，那你在pinia中写跳转不就行了吗,类似如下写法</p>
<p><img src="D:/Software/Typora/images/image-20241017105930061.png" alt="image-20241017105930061"></p>
<p>但这是错误的， useRouter() 必须在组件上下文中使用。Pinia store 并不属于 Vue 组件的上下文，因此在 store 中调用 useRouter() 将导致错误</p>
<p>那如果我就是想在这里使用怎么办，有办法，可以将router传过来，如下更改</p>
<p><img src="D:/Software/Typora/images/image-20241017110315151.png" alt="image-20241017110315151"></p>
<p>&#x3D;&#x3D;Login.vue&#x3D;&#x3D;</p>
<p><img src="D:/Software/Typora/images/image-20241017110354595.png" alt="image-20241017110354595"></p>
<p>这种方式可以，不过我们还有另一种方式，就是导航守卫，导航守卫也可以控制路由跳转呀</p>
<h1 id="9-导航守卫"><a href="#9-导航守卫" class="headerlink" title="9.导航守卫"></a>9.导航守卫</h1><p>&#x3D;&#x3D;router-guard.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;../store/auth&quot;</span>;</span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">    <span class="keyword">const</span> isLogin = userStore.<span class="property">token</span>;</span><br><span class="line">    <span class="comment">// 用户未登录的情况</span></span><br><span class="line">    <span class="keyword">if</span> (!isLogin) &#123;</span><br><span class="line">        <span class="keyword">if</span> (to.<span class="property">path</span> !== <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 用户已登录但尝试访问登录页面的情况</span></span><br><span class="line">        <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span> &#125;; <span class="comment">// 阻止导航,让他跳回首页  </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>别忘了在main.ts中引入导航守卫文件</p>
<p>&#x3D;&#x3D;main.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@/router/guard&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="10-主页面开发"><a href="#10-主页面开发" class="headerlink" title="10.主页面开发"></a>10.主页面开发</h1><p>&#x3D;&#x3D;src-layouts-DefaultLayout.vue&#x3D;&#x3D;</p>
<p>直接复制element plus中的布局容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-container&gt;</span><br><span class="line">     &lt;el-aside width=&quot;200px&quot;&gt;Aside&lt;/el-aside&gt;</span><br><span class="line">     &lt;el-container&gt;</span><br><span class="line">       &lt;el-header&gt;Header&lt;/el-header&gt;</span><br><span class="line">       &lt;el-main&gt;Main&lt;/el-main&gt;</span><br><span class="line">     &lt;/el-container&gt;</span><br><span class="line">   &lt;/el-container&gt;</span><br></pre></td></tr></table></figure>

<p>加点样式:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">  .el-aside&#123;</span><br><span class="line">    height: 100vh;;</span><br><span class="line">    box-shadow: 10px 0 8px -2px rgba(0, 0, 0, 0.2);</span><br><span class="line">    background-color: white</span><br><span class="line">  &#125;</span><br><span class="line">  .el-header&#123;</span><br><span class="line">    padding: 0 !important</span><br><span class="line">  &#125;</span><br><span class="line">  .el-main&#123;</span><br><span class="line">    height: 80vh;</span><br><span class="line">    overflow: auto;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="11-开发侧边栏组件"><a href="#11-开发侧边栏组件" class="headerlink" title="11.开发侧边栏组件"></a>11.开发侧边栏组件</h1><p>&#x3D;&#x3D;components-navMenu-Menu.vue&#x3D;&#x3D;</p>
<p>直接去element plus官网中复制的现成代码，删掉了group,其他不变</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-menu active-text-color=&quot;#ffd04b&quot; background-color=&quot;#545c64&quot; class=&quot;el-menu-vertical-demo&quot; default-active=&quot;2&quot;</span><br><span class="line">        text-color=&quot;#fff&quot;&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;1&quot;&gt;</span><br><span class="line">            &lt;template #title&gt;</span><br><span class="line">                &lt;el-icon&gt;</span><br><span class="line">                    &lt;location /&gt;</span><br><span class="line">                &lt;/el-icon&gt;</span><br><span class="line">                &lt;span&gt;Navigator One&lt;/span&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;1-1&quot;&gt;item one&lt;/el-menu-item&gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;1-2&quot;&gt;item two&lt;/el-menu-item&gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;1-3&quot;&gt;item three&lt;/el-menu-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-sub-menu index=&quot;1-4&quot;&gt;</span><br><span class="line">                &lt;template #title&gt;item four&lt;/template&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;1-4-1&quot;&gt;item one&lt;/el-menu-item&gt;</span><br><span class="line">            &lt;/el-sub-menu&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;2&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;document /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;Navigator Two&lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;3&quot; disabled&gt;</span><br><span class="line">            &lt;el-icon&gt;</span><br><span class="line">                &lt;document /&gt;</span><br><span class="line">            &lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;Navigator Three&lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;4&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;</span><br><span class="line">                &lt;setting /&gt;</span><br><span class="line">            &lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;Navigator Four&lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">    &lt;/el-menu&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>然后去主页面引入菜单组件即可</p>
<p>&#x3D;&#x3D;DefaultLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">      &lt;Menu&gt;&lt;/Menu&gt;</span><br><span class="line"> &lt;/el-aside&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Menu from &#x27;../components/NavMenu/Menu.vue&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>如果报错,因为TypeScript 并不知道如何理解 <code>.vue</code> 文件，因此需要这样一个声明</p>
<p><img src="D:/Software/Typora/images/image-20241017145850520.png" alt="image-20241017145850520"></p>
<p>去全局类型声明文件中设置一下即可</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&quot;mockjs&quot;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">    <span class="keyword">import</span> &#123; <span class="title class_">ComponentOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">componentOptions</span>: <span class="title class_">ComponentOptions</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> componentOptions</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>模块声明</strong>：<code>declare module &#39;*.vue&#39;</code> 表示所有以 <code>.vue</code> 结尾的文件都可以作为模块导入。</li>
<li><strong>类型定义</strong>：它引入了 Vue 的 <code>ComponentOptions</code> 类型，这样 TypeScript 就能知道 <code>.vue</code> 文件中定义的组件是怎样的。</li>
<li><strong>导出</strong>：<code>export default componentOptions</code> 允许你在导入 <code>.vue</code> 文件时，获得一个符合 <code>ComponentOptions</code> 类型的默认导出。</li>
</ol>
<p>从store中取出菜单数据</p>
<p>&#x3D;&#x3D;components-navMenu-Menu.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/store/auth&#x27;;</span><br><span class="line">const userStore = useUserStore();</span><br><span class="line">console.log(userStore.menu)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>对菜单数据进行递归操作</strong></p>
</blockquote>
<p>&#x3D;&#x3D;components-navMenu-MenuItem.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-sub-menu v-if=&quot;item.children&quot; :index=&quot;item.url&quot;&gt;</span><br><span class="line">        &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;</span><br><span class="line">                &lt;document /&gt;</span><br><span class="line">            &lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;my-menu v-for=&quot;child in item.children&quot; :key=&quot;child.url&quot; :item=&quot;child&quot;&gt;&lt;/my-menu&gt;</span><br><span class="line">    &lt;/el-sub-menu&gt;</span><br><span class="line">    &lt;el-menu-item v-else :index=&quot;item.url&quot;&gt;</span><br><span class="line">        &lt;el-icon&gt;</span><br><span class="line">            &lt;document /&gt;</span><br><span class="line">        &lt;/el-icon&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/el-menu-item&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, PropType &#125; from &#x27;vue&#x27;;</span><br><span class="line">import  &#123; MenuItem as MenuItemType &#125; from &quot;../../types/user/index&quot;; //这里换成@符号会有bug，先不换了</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">    name: &#x27;MyMenu&#x27;, // 你可以给组件起一个名字</span><br><span class="line">    props: &#123;</span><br><span class="line">        item: &#123;</span><br><span class="line">            type: Object as PropType&lt;MenuItemType&gt;, //使用 TypeScript 的 PropType 来指定 item 的具体类型为 MenuItemType</span><br><span class="line">            required: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>然后Menu.vue组件中调用</p>
<p>&#x3D;&#x3D;components-navMenu-Menu.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-menu &gt;</span><br><span class="line">        &lt;menu-item v-for=&quot;item in menuItems&quot; :key=&quot;item.url&quot; :item=&quot;item&quot;&gt;&lt;/menu-item&gt;</span><br><span class="line">    &lt;/el-menu&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/store/auth&#x27;;</span><br><span class="line">import MenuItem from &#x27;./MenuItem.vue&#x27;;</span><br><span class="line">const userStore = useUserStore();</span><br><span class="line">const menuItems=userStore.menu</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-将图标字符串转为图标组件"><a href="#2-将图标字符串转为图标组件" class="headerlink" title="2.将图标字符串转为图标组件"></a>2.将图标字符串转为图标组件</h2><p>因为element plus中 <el-icon>中放的是图标组件，虽然我们全局注册了，但是因为后端返回给我们的是字符串，没办法直接用，</p>
<p>所以使用component组件解决</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;component :is=&quot;item.icon&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-优化侧边栏样式"><a href="#3-优化侧边栏样式" class="headerlink" title="3.优化侧边栏样式"></a>3.优化侧边栏样式</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;logo&quot;&gt;</span><br><span class="line">        &lt;img :src=&quot;logo&quot; width=&quot;34px&quot; height=&quot;34px&quot; /&gt;</span><br><span class="line">        &lt;h1&gt;动力港&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-menu&gt;</span><br><span class="line">        &lt;menu-item v-for=&quot;item in menuItems&quot; :key=&quot;item.url&quot; :item=&quot;item&quot;&gt;&lt;/menu-item&gt;</span><br><span class="line">    &lt;/el-menu&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/store/auth&#x27;;</span><br><span class="line">import logo from &quot;@/assets/logo.png&quot;</span><br><span class="line">import MenuItem from &#x27;./MenuItem.vue&#x27;;</span><br><span class="line">const userStore = useUserStore();</span><br><span class="line">const menuItems = userStore.menu</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">  .logo&#123;</span><br><span class="line">    display: flex;justify-content: center;height: 50px;align-items: center;padding:10px 0; </span><br><span class="line">    img&#123;margin-left: -10px;&#125;</span><br><span class="line">    h1&#123;color:#333;margin-left: 10px;font-size: 22px &#125;</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">  .el-menu&#123;</span><br><span class="line">    border-right: none; </span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>修改高亮样式</p>
<p>&#x3D;&#x3D;MenuItem.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">.is-active&#123;background-color: rgb(34 , 136, 255);color: #fff !important;&#125;</span><br><span class="line">.is-active&gt;div span&#123;color: #fff &#125;</span><br><span class="line">.el-menu-item:hover&#123;</span><br><span class="line">    background-color: rgb(34 , 136, 255) !important;color: #fff !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>隐藏滚动条</p>
<p>&#x3D;&#x3D;style.less&#x3D;&#x3D;</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-开启路由模式"><a href="#4-开启路由模式" class="headerlink" title="4.开启路由模式"></a>4.开启路由模式</h2><p><img src="D:/Software/Typora/images/image-20241018103847516.png" alt="image-20241018103847516"></p>
<h1 id="12-创建路由页面"><a href="#12-创建路由页面" class="headerlink" title="12.创建路由页面"></a>12.创建路由页面</h1><p>数据看板：() &#x3D;&gt; import(“@&#x2F;views&#x2F;dashboard&#x2F;DashBoard.vue”)</p>
<p>充电站监控：() &#x3D;&gt; import(“@&#x2F;views&#x2F;chargingstation&#x2F;Monitor.vue”)</p>
<p>营收统计：() &#x3D;&gt; import(“@&#x2F;views&#x2F;chargingstation&#x2F;Revenue.vue”)</p>
<p>充电桩管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;chargingstation&#x2F;Fault.vue”)</p>
<p>电子地图：() &#x3D;&gt; import(“@&#x2F;views&#x2F;Map&#x2F;ElectronicMap.vue”)</p>
<p>订单管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;operations&#x2F;Orders.vue”)</p>
<p>订单详情：() &#x3D;&gt; import(“@&#x2F;views&#x2F;operations&#x2F;Detail.vue”)</p>
<p>计费管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;operations&#x2F;Total.vue”)</p>
<p>报警管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;alarm&#x2F;Alarm.vue”)</p>
<p>会员卡管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;equipment&#x2F;Equipment.vue”)</p>
<p>招商管理：() &#x3D;&gt; import(“@&#x2F;views&#x2F;document&#x2F;Document.vue”)</p>
<p>系统设置： () &#x3D;&gt; import(“@&#x2F;views&#x2F;system&#x2F;System.vue”)</p>
<p>个人中心：() &#x3D;&gt; import(“@&#x2F;views&#x2F;personal&#x2F;Personal.vue”)</p>
<p>然后添加二级路由的<RouterView></p>
<p>&#x3D;&#x3D;layouts-DefaultLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">        &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">            &lt;Menu&gt;&lt;/Menu&gt;</span><br><span class="line">        &lt;/el-aside&gt;</span><br><span class="line">        &lt;el-container&gt;</span><br><span class="line">            &lt;el-header&gt;Header&lt;/el-header&gt;</span><br><span class="line">            &lt;el-main&gt;</span><br><span class="line">              &lt;RouterView/&gt;</span><br><span class="line">            &lt;/el-main&gt;</span><br><span class="line">        &lt;/el-container&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>隐藏订单详情菜单</p>
<p>&#x3D;&#x3D;components-navMenu-MenuItem.vue&#x3D;&#x3D;</p>
<p><img src="D:/Software/Typora/images/image-20241018120914156.png" alt="image-20241018120914156"></p>
<h1 id="13-页面权限控制"><a href="#13-页面权限控制" class="headerlink" title="13.页面权限控制"></a>13.页面权限控制</h1><p>现在虽然我们的菜单是根据后端动态生成的，但是如果用户直到路由，直接手动输入路由地址，还是可以跳转，所以我们需要控制</p>
<blockquote>
<p>页面级权限控制常见的两种思路：</p>
</blockquote>
<p>1.前端不默认创建完整路由表，后端返回权限名称，前端静态路由表中每一项都设置该路由表所需的权限，然后循环路由表，筛选出来该权限名称所拥有的路由表，通过addRoute方法动态添加路由，生成实际路由表</p>
<p>2.前端默认创建完整路由表，后端返回权限名称，路由表每一项中设置访问该路由所应该具备的权限，跳转的时候通过导航守卫控制是否允许跳转</p>
<p>&#x3D;&#x3D;router-basicRouterMap.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/system&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/system/System.vue&quot;</span>),   </span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">needAuth</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;manager&quot;</span>]</span><br><span class="line">    &#125;           </span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/system&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/system/System.vue&quot;</span>),   </span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">needAuth</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;manager&quot;</span>]</span><br><span class="line">    &#125;           </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>导航守卫添加代码</p>
<p>&#x3D;&#x3D;router-guard.ts&#x3D;&#x3D;</p>
<p><img src="D:/Software/Typora/images/image-20241018141623970.png" alt="image-20241018141623970"></p>
<h1 id="14-Header组件开发"><a href="#14-Header组件开发" class="headerlink" title="14.Header组件开发"></a>14.Header组件开发</h1><p>&#x3D;&#x3D;components-TopHeader-TopHeader.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;personal&quot;&gt;</span><br><span class="line">            &lt;el-badge is-dot class=&quot;item&quot;&gt;</span><br><span class="line">                &lt;el-icon size=&quot;20&quot;&gt;</span><br><span class="line">                    &lt;Bell /&gt;</span><br><span class="line">                &lt;/el-icon&gt;</span><br><span class="line">            &lt;/el-badge&gt;</span><br><span class="line">            &lt;el-avatar src=&quot;https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png&quot; /&gt;</span><br><span class="line">            &lt;el-dropdown :hide-on-click=&quot;false&quot; @command=&quot;handleCommand&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;el-dropdown-link&quot;&gt;</span><br><span class="line">                    欢迎你，&#123;&#123; username &#125;&#125;</span><br><span class="line">                    &lt;el-icon class=&quot;el-icon--right&quot;&gt;&lt;arrow-down /&gt;&lt;/el-icon&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;template #dropdown&gt;</span><br><span class="line">                    &lt;el-dropdown-menu&gt;</span><br><span class="line">                        &lt;el-dropdown-item icon=&quot;User&quot; command=&quot;user&quot;&gt;个人中心&lt;/el-dropdown-item&gt;</span><br><span class="line">                        &lt;el-dropdown-item icon=&quot;SwitchButton&quot; command=&quot;logout&quot;&gt;退出登录&lt;/el-dropdown-item&gt;</span><br><span class="line">                    &lt;/el-dropdown-menu&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;/el-dropdown&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &quot;@/store/auth.ts&quot;</span><br><span class="line">import &#123; storeToRefs &#125; from &quot;pinia&quot;;</span><br><span class="line">import &#123;useRouter&#125; from &quot;vue-router&quot;</span><br><span class="line">const userStore=useUserStore()</span><br><span class="line">const &#123;username&#125;=storeToRefs(userStore) </span><br><span class="line">const router=useRouter();</span><br><span class="line">function handleCommand(command:string) &#123;</span><br><span class="line">    if (command == &quot;user&quot;) &#123;</span><br><span class="line">        router.push(&quot;/personal&quot;) </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        userStore.logout()</span><br><span class="line">        router.push(&quot;/login&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">.header &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    height: 60px;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 0 20px;</span><br><span class="line">    .personal &#123;</span><br><span class="line">        float: right;</span><br><span class="line">        height: 60px;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line"></span><br><span class="line">        .el-dropdown-link &#123;</span><br><span class="line">            margin-left: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .item &#123;</span><br><span class="line">            margin-top: 10px;</span><br><span class="line">            margin-right: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;store-auth.ts&#x3D;&#x3D;</p>
<p>actions中添加logout</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">token</span> = <span class="literal">null</span>;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">roles</span> = [];</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">username</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">menu</span>=[]</span><br><span class="line">           sessionStorage.<span class="title function_">clear</span>()</span><br><span class="line">         &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="15-快捷页签导航开发"><a href="#15-快捷页签导航开发" class="headerlink" title="15.快捷页签导航开发"></a>15.快捷页签导航开发</h1><h2 id="1-基本功能"><a href="#1-基本功能" class="headerlink" title="1.基本功能"></a>1.基本功能</h2><p>先在DefaultLayout页面尝试基本功能</p>
<p>&#x3D;&#x3D;layouts-DefaultLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">      &lt;Menu&gt;&lt;/Menu&gt;</span><br><span class="line">    &lt;/el-aside&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-header&gt;</span><br><span class="line">        &lt;TopHeader /&gt;</span><br><span class="line">      &lt;/el-header&gt;</span><br><span class="line">      &lt;el-main&gt;</span><br><span class="line">        &lt;el-tabs </span><br><span class="line">            v-model=&quot;activeName&quot; </span><br><span class="line">            class=&quot;demo-tabs&quot; </span><br><span class="line">            closable</span><br><span class="line">            @tab-click=&quot;handleClick&quot;</span><br><span class="line">            @tab-remove=&quot;remove&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-tab-pane label=&quot;User&quot; name=&quot;first&quot;&gt;</span><br><span class="line">              &lt;template #label&gt;</span><br><span class="line">                &lt;span class=&quot;custom-tabs-label&quot;&gt;</span><br><span class="line">                  &lt;el-icon&gt;&lt;calendar /&gt;&lt;/el-icon&gt;</span><br><span class="line">                  &lt;span&gt;Route&lt;/span&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">              &lt;/template&gt;</span><br><span class="line">              route的内容</span><br><span class="line">            &lt;/el-tab-pane&gt;</span><br><span class="line">            &lt;el-tab-pane label=&quot;Config&quot; name=&quot;second&quot;&gt;Config&lt;/el-tab-pane&gt;</span><br><span class="line">            &lt;el-tab-pane label=&quot;Role&quot; name=&quot;third&quot;&gt;Role&lt;/el-tab-pane&gt;</span><br><span class="line">            &lt;el-tab-pane label=&quot;Task&quot; name=&quot;fourth&quot;&gt;Task&lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;/el-tabs&gt;</span><br><span class="line">        &lt;RouterView /&gt;</span><br><span class="line">      &lt;/el-main&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import Menu from &quot;@/components/navMenu/Menu.vue&quot;</span><br><span class="line">import TopHeader from &quot;@/components/TopHeader/TopHeader.vue&quot;</span><br><span class="line">import type &#123; TabsPaneContext &#125; from &#x27;element-plus&#x27;</span><br><span class="line">const activeName = ref(&#x27;first&#x27;)</span><br><span class="line">const handleClick=(tab: TabsPaneContext, event: Event)=&gt;&#123;</span><br><span class="line">  console.log(tab, event)</span><br><span class="line">  &#125;</span><br><span class="line">  const remove=(panelName:string)=&gt;&#123;</span><br><span class="line">    console.log(panelName)</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.el-aside &#123;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  ;</span><br><span class="line">  box-shadow: 10px 0 8px -2px rgba(0, 0, 0, 0.2);</span><br><span class="line">  background-color: white</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-header &#123;</span><br><span class="line">  padding: 0 !important</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-main &#123;</span><br><span class="line">  height: 80vh;</span><br><span class="line">  overflow: auto;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后创建单独的组件</p>
<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<p>将这些内容全部复制到该组件下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-tabs v-model=&quot;activeName&quot; class=&quot;demo-tabs&quot; closable @tab-click=&quot;handleClick&quot; @tab-remove=&quot;remove&quot;&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;User&quot; name=&quot;first&quot;&gt;</span><br><span class="line">            &lt;template #label&gt;</span><br><span class="line">                &lt;span class=&quot;custom-tabs-label&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;</span><br><span class="line">                        &lt;calendar /&gt;</span><br><span class="line">                    &lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;Route&lt;/span&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            route的内容</span><br><span class="line">        &lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;Config&quot; name=&quot;second&quot;&gt;Config&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;Role&quot; name=&quot;third&quot;&gt;Role&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;Task&quot; name=&quot;fourth&quot;&gt;Task&lt;/el-tab-pane&gt;</span><br><span class="line">    &lt;/el-tabs&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import type &#123; TabsPaneContext &#125; from &#x27;element-plus&#x27;</span><br><span class="line">const activeName = ref(&#x27;first&#x27;)</span><br><span class="line">const handleClick = (tab: TabsPaneContext, event: Event) =&gt; &#123;</span><br><span class="line">    console.log(tab, event)</span><br><span class="line">&#125;</span><br><span class="line">const remove = (panelName: string) =&gt; &#123;</span><br><span class="line">    console.log(panelName)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>那么问题来了，应该有几个tab-pane呢，应该是点击一次菜单，就应该多一个，默认有dashboard一个,所以此时我们创建store，存储所点击的菜单项</p>
<p>&#x3D;&#x3D;store-tabs.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span>&#123;<span class="title class_">MenuItem</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@/types/user&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTabsStore = <span class="title function_">defineStore</span>(<span class="string">&quot;tabs&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> tabs = ref&lt;<span class="title class_">MenuItem</span>[]&gt;([&#123; <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>, <span class="attr">path</span>: <span class="string">&quot;/dashboard&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;DataLine&quot;</span> &#125;]);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">addTab</span> = (<span class="params">name: <span class="built_in">string</span>, path: <span class="built_in">string</span>, icon: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tabs.<span class="property">value</span>.<span class="title function_">some</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">path</span> === path)) &#123;</span><br><span class="line">            tabs.<span class="property">value</span>.<span class="title function_">push</span>(&#123; name, path, icon &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;tabs,addTab&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>DefaultLayout.vue文件引入TabsLayout</p>
<p>&#x3D;&#x3D;DefaultLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-main&gt;</span><br><span class="line">    &lt;TabsLayout/&gt;</span><br><span class="line">    &lt;!-- &lt;RouterView /&gt; --&gt;</span><br><span class="line">&lt;/el-main&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">TabsLayout</span> <span class="keyword">from</span> <span class="string">&quot;@/layouts/TabsLayout.vue&quot;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useTabsStore&#125; <span class="keyword">from</span> <span class="string">&quot;@/store/tabs.ts&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> tabsStore = <span class="title function_">useTabsStore</span>();</span><br><span class="line"><span class="keyword">const</span> &#123;tabs&#125;=<span class="title function_">storeToRefs</span>(tabsStore);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">88</span>,tabs.<span class="property">value</span>) <span class="comment">//这里验证，确实可以拿到store中的数据</span></span><br></pre></td></tr></table></figure>

<h2 id="2-添加页签"><a href="#2-添加页签" class="headerlink" title="2.添加页签"></a>2.添加页签</h2><p>&#x3D;&#x3D;components-NavMenu-MenuItem.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;el-menu-item v-else :index=&quot;item.url&quot; @click=&quot;add(item.name, item.url, item.icon)&quot; v-show=&quot;!(item.name == &#x27;订单详情&#x27;)&quot;&gt;</span><br><span class="line">        &lt;el-icon&gt;</span><br><span class="line">            &lt;component :is=&quot;item.icon&quot; /&gt;</span><br><span class="line">        &lt;/el-icon&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/el-menu-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, PropType &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; MenuItem as MenuItemType &#125; from &quot;../../types/user/index&quot;;</span><br><span class="line">import &#123; useTabsStore &#125; from &#x27;@/store/tabs&#x27;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">    name: &#x27;MyMenu&#x27;, // 你可以给组件起一个名字</span><br><span class="line">    props: &#123;</span><br><span class="line">        item: &#123;</span><br><span class="line">            type: Object as PropType&lt;MenuItemType&gt;,</span><br><span class="line">            required: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    setup() &#123;</span><br><span class="line">        const tabsStore=useTabsStore();</span><br><span class="line">        const &#123;addTab&#125;=tabsStore;</span><br><span class="line">        function add(name: string, url: string, icon: string) &#123;</span><br><span class="line">            addTab(name, url, icon)</span><br><span class="line">        &#125;</span><br><span class="line">        return &#123;add &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-tabs v-model=&quot;activeName&quot; class=&quot;demo-tabs&quot; type=&quot;card&quot; closable @tab-click=&quot;handleClick&quot; @tab-remove=&quot;remove&quot;&gt;</span><br><span class="line">        &lt;el-tab-pane </span><br><span class="line">            v-for=&quot;item in tabs&quot;</span><br><span class="line">            :key=&quot;item.name&quot;</span><br><span class="line">            :label=&quot;item.name&quot;</span><br><span class="line">            :name=&quot;item.name&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;template #label&gt;</span><br><span class="line">                &lt;span class=&quot;custom-tabs-label&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;</span><br><span class="line">                        &lt;component :is=&quot;item.icon&quot; /&gt;</span><br><span class="line">                    &lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;&amp;nbsp;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            route的内容</span><br><span class="line">        &lt;/el-tab-pane&gt;</span><br><span class="line">    &lt;/el-tabs&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line"> .demo-tabs &#123;</span><br><span class="line">  ::v-deep  .is-active&#123;color: white !important;background-color: #5696ff;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>将<RouterView>挪到tabs中</p>
<p>很多同学的想法肯定是像下面这样加</p>
<p><img src="D:/Software/Typora/images/image-20241019133130266.png" alt="image-20241019133130266"></p>
<p>但是这样你想想，会渲染几个<RouterView>,很明显，循环执行了几次，就会有几个RouterView</p>
<p>我们可以在dashboard页面验证一下</p>
<p>&#x3D;&#x3D;views-dashboard-DashBoard.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    数据看板</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;onMounted&#125; from &quot;vue&quot;</span><br><span class="line">    onMounted(()=&gt;&#123;</span><br><span class="line">        console.log(888) //会发现，有几个选项卡就会执行几次</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>所以我们把RouterView拿到tabs的外面去，如下</p>
<p><img src="D:/Software/Typora/images/image-20241019133442049.png" alt="image-20241019133442049"></p>
<h2 id="3-左侧菜单和页签同步的问题"><a href="#3-左侧菜单和页签同步的问题" class="headerlink" title="3.左侧菜单和页签同步的问题"></a>3.左侧菜单和页签同步的问题</h2><p>store设置一个currentTab，用来保存当前高亮&#x2F;选中的tab,再添加一个setCurrentTab方法，设置当前高亮的方法</p>
<p>&#x3D;&#x3D;store-tabs.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span>&#123;<span class="title class_">MenuItem</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@/types/user&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTabsStore = <span class="title function_">defineStore</span>(<span class="string">&quot;tabs&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> tabs = ref&lt;<span class="title class_">MenuItem</span>[]&gt;([&#123; <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>, <span class="attr">url</span>: <span class="string">&quot;/dashboard&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;DataLine&quot;</span> &#125;]);</span><br><span class="line">    <span class="keyword">const</span> currentTab = ref&lt;&#123; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">url</span>: <span class="built_in">string</span> &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>, <span class="attr">url</span>: <span class="string">&quot;/dashboard&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">addTab</span> = (<span class="params">name: <span class="built_in">string</span>, url: <span class="built_in">string</span>, icon: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tabs.<span class="property">value</span>.<span class="title function_">some</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">url</span> === url)) &#123;</span><br><span class="line">            tabs.<span class="property">value</span>.<span class="title function_">push</span>(&#123; name, url, icon &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setCurrentTab</span> = (<span class="params">name: <span class="built_in">string</span>, path: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">        currentTab.<span class="property">value</span> = &#123; name, path &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;tabs,addTab,currentTab,setCurrentTab&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tabs v-model=&quot;currentTab.name&quot; &gt; 更改双向绑定</span><br><span class="line">    </span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import type &#123; TabsPaneContext &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123;useTabsStore&#125; from &quot;@/store/tabs.ts&quot;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line">const tabsStore = useTabsStore();</span><br><span class="line">const router=useRouter();</span><br><span class="line">const &#123;tabs,currentTab&#125;=storeToRefs(tabsStore);//添加解构赋值</span><br><span class="line">const &#123;setCurrentTab&#125;=tabsStore;//因为是方法，不需要响应式，单独解构</span><br><span class="line">const handleClick = (tab: TabsPaneContext, event: Event) =&gt; &#123;</span><br><span class="line">    router.push(tabs.value[tab.index].url) //路由跳转</span><br><span class="line">    setCurrentTab(tabs.value[tab.index].name,tabs.value[tab.index].url) //设置当前</span><br><span class="line">&#125;</span><br><span class="line">const remove = (panelName: string) =&gt; &#123;</span><br><span class="line">    console.log(panelName)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;components-navMenu-MenuItem.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tabsStore=<span class="title function_">useTabsStore</span>();</span><br><span class="line">    <span class="keyword">const</span> &#123;addTab,setCurrentTab&#125;=tabsStore;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">name: <span class="built_in">string</span>, url: <span class="built_in">string</span>, icon: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="title function_">addTab</span>(name, url, icon);</span><br><span class="line">        <span class="title function_">setCurrentTab</span>(name,url)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;add &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-解决刷新的问题"><a href="#4-解决刷新的问题" class="headerlink" title="4.解决刷新的问题"></a>4.解决刷新的问题</h2><p>之所以刷新后左侧菜单和tab对应不上，是因为我们给tab设置了一刷新默认都是dashboard，这个不太合理，所以去掉默认值如下</p>
<p><img src="D:/Software/Typora/images/image-20241019141947305.png" alt="image-20241019141947305"></p>
<p>刷新的时候我们能通过路由对象拿到当前路径，但是我需要拿到当前菜单数据的name和icon，所以我们定义一个方法，根据path，去菜单数据里找出对应的那个数据对象</p>
<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter,useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> route=<span class="title function_">useRoute</span>()</span><br><span class="line"><span class="keyword">const</span> &#123;menu&#125; =<span class="title function_">storeToRefs</span>(userStore)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findObjectByUrl</span>(<span class="params">arr, url</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">url</span> === url) &#123;</span><br><span class="line">      <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> found = <span class="title function_">findObjectByUrl</span>(item.<span class="property">children</span>, url);</span><br><span class="line">      <span class="keyword">if</span> (found) &#123;</span><br><span class="line">        <span class="keyword">return</span> found;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 如果未找到，返回 null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;name,url,icon&#125;=<span class="title function_">findObjectByUrl</span>(menu.<span class="property">value</span>,route.<span class="property">path</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addTab</span>(name,url,icon)</span><br><span class="line"><span class="title function_">setCurrentTab</span>(name,url)</span><br></pre></td></tr></table></figure>

<h2 id="5-删除功能"><a href="#5-删除功能" class="headerlink" title="5.删除功能"></a>5.删除功能</h2><p>基本的删除功能</p>
<p>&#x3D;&#x3D;store-tabs.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removeTab</span> = (<span class="params">name: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 删除指定路径的选项卡</span></span><br><span class="line">    tabs.<span class="property">value</span> = tabs.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">name</span> !== name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">remove</span> = (<span class="params">panelName: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">removeTab</span>(panelName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果删除的是当前高亮的tab，就会有bug</p>
<p>tabs.ts做如下修改</p>
<p>&#x3D;&#x3D;store-tabs.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removeTab</span> = (<span class="params">name: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//如果删除的是高亮的</span></span><br><span class="line">    <span class="keyword">if</span> (currentTab.<span class="property">value</span>.<span class="property">name</span> === name)&#123;</span><br><span class="line">        <span class="keyword">const</span> currentIndex = tabs.<span class="property">value</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">name</span> === name);</span><br><span class="line">         <span class="comment">// 如果被移除的标签是当前标签，更新当前标签为前面一个标签</span></span><br><span class="line">         currentTab.<span class="property">value</span> = tabs.<span class="property">value</span>[currentIndex - <span class="number">1</span>]; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除指定路径的选项卡</span></span><br><span class="line">    tabs.<span class="property">value</span> = tabs.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">name</span> !== name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;并将路由跳转过去</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">remove</span> = (<span class="params">panelName: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">removeTab</span>(panelName);</span><br><span class="line">    router.<span class="title function_">push</span>(currentTab.<span class="property">value</span>.<span class="property">url</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>还是会有bug,如下优化</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">remove</span> = (<span class="params">panelName: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(currentTab.<span class="property">value</span>.<span class="property">name</span>==panelName)&#123;</span><br><span class="line">        <span class="comment">//如果点击的是高亮的</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">552</span>,currentTab.<span class="property">value</span>)</span><br><span class="line">        <span class="title function_">removeTab</span>(panelName);</span><br><span class="line">        router.<span class="title function_">push</span>(currentTab.<span class="property">value</span>.<span class="property">url</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">removeTab</span>(panelName); </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，如果多个页签，选中了第一个，再删除第一个，就会有bug,改成如果高亮 是第一个，不允许删除</p>
<p>&#x3D;&#x3D;store-tabs.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removeTab</span> = (<span class="params">name: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//如果删除的是高亮的</span></span><br><span class="line">    <span class="keyword">if</span> (currentTab.<span class="property">value</span>.<span class="property">name</span> === name)&#123;</span><br><span class="line">        <span class="keyword">const</span> currentIndex = tabs.<span class="property">value</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">name</span> === name);</span><br><span class="line">         <span class="comment">// 如果被移除的标签是当前标签，更新当前标签为前面一个标签</span></span><br><span class="line">         <span class="keyword">if</span>(currentIndex!=<span class="number">0</span>)&#123;</span><br><span class="line">            currentTab.<span class="property">value</span> = tabs.<span class="property">value</span>[currentIndex - <span class="number">1</span>]; </span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">         &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除指定路径的选项卡</span></span><br><span class="line">    tabs.<span class="property">value</span> = tabs.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">tab</span> =&gt;</span> tab.<span class="property">name</span> !== name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="16-数据看板页面开发"><a href="#16-数据看板页面开发" class="headerlink" title="16.数据看板页面开发"></a>16.数据看板页面开发</h1><h2 id="1-设备运行状态模块开发"><a href="#1-设备运行状态模块开发" class="headerlink" title="1.设备运行状态模块开发"></a>1.设备运行状态模块开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">        &lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line">                &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                    &lt;h3&gt;今日设备运行状态&lt;/h3&gt;</span><br><span class="line">                    &lt;p&gt;更新时间：2024年8月31日&lt;/p&gt;</span><br><span class="line">                    &lt;el-icon color=&quot;#86909c&quot; style=&quot;margin-left: 5px;&quot;&gt;</span><br><span class="line">                        &lt;Refresh /&gt;</span><br><span class="line">                    &lt;/el-icon&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;equipment&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;item&quot;&gt;</span><br><span class="line">                        &lt;h4&gt;充电桩使用率&lt;/h4&gt;</span><br><span class="line">                        &lt;img :src=&quot;flash&quot; alt=&quot;&quot; class=&quot;mb mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;72 / 95&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;statistic-card&quot;&gt;</span><br><span class="line">                            &lt;el-statistic :value=&quot;9&quot;&gt;</span><br><span class="line">                                &lt;template #title&gt;</span><br><span class="line">                                    &lt;div style=&quot;display: inline-flex; align-items: center&quot;&gt;</span><br><span class="line">                                        异常设备</span><br><span class="line">                                        &lt;el-tooltip effect=&quot;dark&quot;</span><br><span class="line">                                            content=&quot;Number of users who logged into the product in one day&quot;</span><br><span class="line">                                            placement=&quot;top&quot;&gt;</span><br><span class="line">                                            &lt;el-icon style=&quot;margin-left: 4px&quot; :size=&quot;12&quot;&gt;</span><br><span class="line">                                                &lt;Warning /&gt;</span><br><span class="line">                                            &lt;/el-icon&gt;</span><br><span class="line">                                        &lt;/el-tooltip&gt;</span><br><span class="line">                                    &lt;/div&gt;</span><br><span class="line">                                &lt;/template&gt;</span><br><span class="line">                            &lt;/el-statistic&gt;</span><br><span class="line">                            &lt;div class=&quot;statistic-footer&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;footer-item&quot;&gt;</span><br><span class="line">                                    &lt;span&gt;相较昨日&lt;/span&gt;</span><br><span class="line">                                    &lt;span class=&quot;green&quot;&gt;</span><br><span class="line">                                        24%</span><br><span class="line">                                        &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                                            &lt;CaretTop /&gt;</span><br><span class="line">                                        &lt;/el-icon&gt;</span><br><span class="line">                                    &lt;/span&gt;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;item&quot;&gt;</span><br><span class="line">                        &lt;h4&gt;充电柜使用率&lt;/h4&gt;</span><br><span class="line">                        &lt;img :src=&quot;flash2&quot; alt=&quot;&quot; class=&quot;mb mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;655 / 1233&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;statistic-card&quot;&gt;</span><br><span class="line">                            &lt;el-statistic :value=&quot;22&quot;&gt;</span><br><span class="line">                                &lt;template #title&gt;</span><br><span class="line">                                    &lt;div style=&quot;display: inline-flex; align-items: center&quot;&gt;</span><br><span class="line">                                        异常设备</span><br><span class="line">                                        &lt;el-tooltip effect=&quot;dark&quot;</span><br><span class="line">                                            content=&quot;Number of users who logged into the product in one day&quot;</span><br><span class="line">                                            placement=&quot;top&quot;&gt;</span><br><span class="line">                                            &lt;el-icon style=&quot;margin-left: 4px&quot; :size=&quot;12&quot;&gt;</span><br><span class="line">                                                &lt;Warning /&gt;</span><br><span class="line">                                            &lt;/el-icon&gt;</span><br><span class="line">                                        &lt;/el-tooltip&gt;</span><br><span class="line">                                    &lt;/div&gt;</span><br><span class="line">                                &lt;/template&gt;</span><br><span class="line">                            &lt;/el-statistic&gt;</span><br><span class="line">                            &lt;div class=&quot;statistic-footer&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;footer-item&quot;&gt;</span><br><span class="line">                                    &lt;span&gt;相较昨日&lt;/span&gt;</span><br><span class="line">                                    &lt;span class=&quot;green&quot;&gt;</span><br><span class="line">                                        24%</span><br><span class="line">                                        &lt;el-icon color=&quot;red&quot;&gt;</span><br><span class="line">                                            &lt;CaretTop /&gt;</span><br><span class="line">                                        &lt;/el-icon&gt;</span><br><span class="line">                                    &lt;/span&gt;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;item&quot;&gt;</span><br><span class="line">                        &lt;h4&gt;充电站使用率&lt;/h4&gt;</span><br><span class="line">                        &lt;img :src=&quot;flash3&quot; alt=&quot;&quot; class=&quot;mb mt&quot;&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;h1&gt;2263 / 3398&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;statistic-card&quot;&gt;</span><br><span class="line">                            &lt;el-statistic :value=&quot;47&quot;&gt;</span><br><span class="line">                                &lt;template #title&gt;</span><br><span class="line">                                    &lt;div style=&quot;display: inline-flex; align-items: center&quot;&gt;</span><br><span class="line">                                        异常设备</span><br><span class="line">                                        &lt;el-tooltip effect=&quot;dark&quot;</span><br><span class="line">                                            content=&quot;Number of users who logged into the product in one day&quot;</span><br><span class="line">                                            placement=&quot;top&quot;&gt;</span><br><span class="line">                                            &lt;el-icon style=&quot;margin-left: 4px&quot; :size=&quot;12&quot;&gt;</span><br><span class="line">                                                &lt;Warning /&gt;</span><br><span class="line">                                            &lt;/el-icon&gt;</span><br><span class="line">                                        &lt;/el-tooltip&gt;</span><br><span class="line">                                    &lt;/div&gt;</span><br><span class="line">                                &lt;/template&gt;</span><br><span class="line">                            &lt;/el-statistic&gt;</span><br><span class="line">                            &lt;div class=&quot;statistic-footer&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;footer-item&quot;&gt;</span><br><span class="line">                                    &lt;span&gt;相较昨日&lt;/span&gt;</span><br><span class="line">                                    &lt;span class=&quot;green&quot;&gt;</span><br><span class="line">                                        24%</span><br><span class="line">                                        &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                                            &lt;CaretTop /&gt;</span><br><span class="line">                                        &lt;/el-icon&gt;</span><br><span class="line">                                    &lt;/span&gt;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span=&quot;6&quot;&gt;&lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import flash from &quot;@/assets/flash.png&quot;</span><br><span class="line">import flash2 from &quot;@/assets/flash2.png&quot;</span><br><span class="line">import flash3 from &quot;@/assets/flash3.png&quot;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.title &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: flex-end;</span><br><span class="line">    /* 底部对齐 */</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">    text-align: center;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">    p &#123;</span><br><span class="line">        color: #86909c;</span><br><span class="line">        margin-left: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">.equipment &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    padding: 0 50px;</span><br><span class="line"></span><br><span class="line">    .item &#123;</span><br><span class="line">        h4 &#123;</span><br><span class="line">            margin-bottom: 20px;</span><br><span class="line">            margin-top: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        h1 &#123;</span><br><span class="line">            font-size: 36px;</span><br><span class="line">            margin-bottom: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .statistic-card &#123;</span><br><span class="line">            .el-statistic__content &#123;</span><br><span class="line">                margin: 10px !important;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-常用功能页面开发"><a href="#2-常用功能页面开发" class="headerlink" title="2.常用功能页面开发"></a>2.常用功能页面开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">            &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;template #header&gt;</span><br><span class="line">                    &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;常用功能&lt;/h1&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">                &lt;div class=&quot;quick mt mb&quot;&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;repair&quot;&gt;</span><br><span class="line">                        &lt;p&gt;设备维修&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;daily&quot;&gt;</span><br><span class="line">                        &lt;p&gt;每日日报&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;progress&quot;&gt;</span><br><span class="line">                        &lt;p&gt;任务进度&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;total&quot;&gt;</span><br><span class="line">                        &lt;p&gt;营收占比&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;money&quot;&gt;</span><br><span class="line">                        &lt;p&gt;营收统计&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div :span=&quot;4&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;remain&quot;&gt;</span><br><span class="line">                        &lt;p&gt;待办事项&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import flash from &quot;@/assets/flash.png&quot;</span><br><span class="line">import flash2 from &quot;@/assets/flash2.png&quot;</span><br><span class="line">import flash3 from &quot;@/assets/flash3.png&quot;</span><br><span class="line">import repair from &quot;@/assets/repair.png&quot;</span><br><span class="line">import progress from &quot;@/assets/progress.png&quot;</span><br><span class="line">import remain from &quot;@/assets/remain.png&quot;</span><br><span class="line">import total from &quot;@/assets/total.png&quot;</span><br><span class="line">import money from &quot;@/assets/money.png&quot;</span><br><span class="line">import daily from &quot;@/assets/daily.png&quot;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">	.quick &#123;</span><br><span class="line">    padding: 0 40px;</span><br><span class="line">    margin-top: 30px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line"></span><br><span class="line">    p &#123;</span><br><span class="line">        margin-top: 10px;</span><br><span class="line">        color: #333;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-使用echarts"><a href="#3-使用echarts" class="headerlink" title="3.使用echarts"></a>3.使用echarts</h2><p>安装echarts</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>添加一个card</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">               &lt;template #header&gt;</span><br><span class="line">                   &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                       &lt;h1&gt;能源统计&lt;/h1&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">               &lt;/template&gt;</span><br><span class="line">               &lt;el-row&gt;</span><br><span class="line">                   &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                       &lt;div ref=&quot;chartRef2&quot; style=&quot;width: 100%; height: 400px;margin-top: -40px&quot;&gt;&lt;/div&gt;</span><br><span class="line">                   &lt;/el-col&gt;</span><br><span class="line">                   &lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">                       &lt;div ref=&quot;chartRef&quot; style=&quot;width: 100%; height: 400px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">                   &lt;/el-col&gt;</span><br><span class="line">               &lt;/el-row&gt;</span><br><span class="line"> &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<p>如下这样写刚好报错，因为我们的图标需要用到dom实例，但是现在是在setup生命周期里的，所以需要在挂载完毕的时候渲染图表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line">const chartRef = ref(null)</span><br><span class="line">const chartRef2 = ref(null)</span><br><span class="line">// 基于准备好的dom，初始化echarts实例</span><br><span class="line">var myChart = echarts.init(chartRef.value);</span><br><span class="line">// 绘制图表</span><br><span class="line">myChart.setOption(&#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts 入门示例&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;&#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;]</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;&#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;销量&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;,</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>改成下面的写法才可生效</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt; </span><br><span class="line">import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import &#123; onMounted &#125; from &quot;vue&quot;</span><br><span class="line">const chartRef = ref(null)</span><br><span class="line">const chartRef2 = ref(null)</span><br><span class="line">// 基于准备好的dom，初始化echarts实例</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    var myChart = echarts.init(chartRef.value);</span><br><span class="line">    // 绘制图表</span><br><span class="line">    myChart.setOption(&#123;</span><br><span class="line">        title: &#123;</span><br><span class="line">            text: &#x27;ECharts 入门示例&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        tooltip: &#123;&#125;,</span><br><span class="line">        xAxis: &#123;</span><br><span class="line">            data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;]</span><br><span class="line">        &#125;,</span><br><span class="line">        yAxis: &#123;&#125;,</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;销量&#x27;,</span><br><span class="line">                type: &#x27;bar&#x27;,</span><br><span class="line">                data: [5, 20, 36, 10, 10, 20]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-解决窗口变化echarts适配问题"><a href="#4-解决窗口变化echarts适配问题" class="headerlink" title="4.解决窗口变化echarts适配问题"></a>4.解决窗口变化echarts适配问题</h2><p>添加resize事件</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span><br><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartRef.<span class="property">value</span>);</span><br><span class="line"><span class="comment">// 绘制图表</span></span><br><span class="line">myChart.<span class="title function_">setOption</span>(&#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: [<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">data</span>: [<span class="number">150</span>, <span class="number">230</span>, <span class="number">224</span>, <span class="number">218</span>, <span class="number">135</span>, <span class="number">147</span>, <span class="number">260</span>],</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    myChart.<span class="title function_">resize</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>样式穿透优化一下</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.statistic-card</span> &#123;</span><br><span class="line">          :<span class="built_in">deep</span>(.el-statistic__content) &#123;</span><br><span class="line">               <span class="attribute">margin</span>: <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-封装useChart自定义组合式函数"><a href="#5-封装useChart自定义组合式函数" class="headerlink" title="5.封装useChart自定义组合式函数"></a>5.封装useChart自定义组合式函数</h2><p>hooks-useChart.ts</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onBeforeUnmount, <span class="title class_">Ref</span>,markRaw  &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useChart</span>(<span class="params">chartRef: Ref&lt;HTMLElement | <span class="literal">null</span>&gt;, initialOptions: <span class="built_in">any</span></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> chartInstance = ref&lt;echarts.<span class="property">ECharts</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> chartOptions = <span class="title function_">ref</span>(initialOptions);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">initChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (chartRef.<span class="property">value</span>) &#123;</span><br><span class="line">             chartInstance.<span class="property">value</span> =echarts.<span class="title function_">init</span>(chartRef.<span class="property">value</span>);</span><br><span class="line">             chartInstance.<span class="property">value</span>.<span class="title function_">setOption</span>(chartOptions.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        chartInstance.<span class="property">value</span>?.<span class="title function_">resize</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">initChart</span>();</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">        <span class="keyword">if</span> (chartInstance.<span class="property">value</span>) &#123;</span><br><span class="line">            chartInstance.<span class="property">value</span>.<span class="title function_">dispose</span>();<span class="comment">//dispose 方法的作用是释放图表实例所占用的资源，以便在不再需要图表时清理内存</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样封装有问题，会发现当我改变窗口的时候会报错</p>
<p>按如下更改：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Echarts 管理的状态和数据与 Vue 的响应式产生冲突，导致Echarts 无法正常更新而报错。</span></span><br><span class="line">          <span class="comment">// 解决：取消 VUE 的响应式系统观测 Echarts 的变化更新，让Echarts 自动更新。</span></span><br><span class="line">          chartInstance.<span class="property">value</span> =<span class="title function_">markRaw</span>(echarts.<span class="title function_">init</span>(chartRef.<span class="property">value</span>)) ;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<p>&#x3D;&#x3D;DashBoard.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> chartRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> chartOptions = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;ECharts 入门示例&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;衬衫333&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">useChart</span>(chartRef,chartOptions)</span><br></pre></td></tr></table></figure>

<h2 id="6-实现电量统计的图表"><a href="#6-实现电量统计的图表" class="headerlink" title="6.实现电量统计的图表"></a>6.实现电量统计的图表</h2><p>基本的配置:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> chartOptions = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;电量统计&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;left top&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span><br><span class="line">        <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params[<span class="number">0</span>].<span class="property">name</span> + <span class="string">&#x27;&lt;br/&gt;&#x27;</span> + params[<span class="number">0</span>].<span class="property">seriesName</span> + <span class="string">&#x27;: &#x27;</span> + params[<span class="number">0</span>].<span class="property">value</span> + <span class="string">&#x27;KW&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;充电量&#x27;</span>, <span class="string">&#x27;充电时长&#x27;</span>, <span class="string">&#x27;充电功率&#x27;</span>],</span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;13:00&#x27;</span>, <span class="string">&#x27;14:00&#x27;</span>, <span class="string">&#x27;15:00&#x27;</span>, <span class="string">&#x27;16:00&#x27;</span>, <span class="string">&#x27;17:00&#x27;</span>, <span class="string">&#x27;18:00&#x27;</span>, <span class="string">&#x27;19:00&#x27;</span>, <span class="string">&#x27;20:00&#x27;</span>, <span class="string">&#x27;21:00&#x27;</span>],</span><br><span class="line">        <span class="attr">boundaryGap</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;KW&#x27;</span>,</span><br><span class="line">        <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">            <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; KW&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电量&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="number">20</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">70</span>, <span class="number">60</span>, <span class="number">80</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>],</span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;purple&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 255, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电时长&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">80</span>, <span class="number">70</span>, <span class="number">90</span>, <span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>],</span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;lightgreen&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 255, 0, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电功率&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="number">30</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">70</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">60</span>],</span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;skyblue&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(173, 216, 230, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这样数据是写死的，我们真实工作中数据肯定是通过接口获取，所以添加获取图表数据的接口</p>
<p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//echarts图表数据接口</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/chartData&quot;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登陆成功&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>:[</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;充电量&quot;</span>,<span class="attr">data</span>: [<span class="number">20</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">70</span>, <span class="number">60</span>, <span class="number">80</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>]&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;充电时长&quot;</span>,<span class="attr">data</span>: [<span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">80</span>, <span class="number">70</span>, <span class="number">90</span>, <span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>]&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;充电功率&quot;</span>,<span class="attr">data</span>:  [<span class="number">30</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">70</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">60</span>]&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api-dashboard.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    chartData = <span class="string">&#x27;/chartData&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">chartDataApi</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">chartData</span>)</span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">export</span> &#123;chartDataApi&#125;</span><br></pre></td></tr></table></figure>

<p>优化我们之前封装的组合式函数</p>
<p>&#x3D;&#x3D;Dashboard.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;chartDataApi&#125; <span class="keyword">from</span> <span class="string">&quot;@/api/dashboard&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">const</span> chartRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setChartData</span>=<span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> chartOptions = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;电量统计&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;left top&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span><br><span class="line">        <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params[<span class="number">0</span>].<span class="property">name</span> + <span class="string">&#x27;&lt;br/&gt;&#x27;</span> + params[<span class="number">0</span>].<span class="property">seriesName</span> + <span class="string">&#x27;: &#x27;</span> + params[<span class="number">0</span>].<span class="property">value</span> + <span class="string">&#x27;KW&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">       <span class="comment">// data: [&#x27;充电量&#x27;, &#x27;充电时长&#x27;, &#x27;充电功率&#x27;],</span></span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;13:00&#x27;</span>, <span class="string">&#x27;14:00&#x27;</span>, <span class="string">&#x27;15:00&#x27;</span>, <span class="string">&#x27;16:00&#x27;</span>, <span class="string">&#x27;17:00&#x27;</span>, <span class="string">&#x27;18:00&#x27;</span>, <span class="string">&#x27;19:00&#x27;</span>, <span class="string">&#x27;20:00&#x27;</span>, <span class="string">&#x27;21:00&#x27;</span>],</span><br><span class="line">        <span class="attr">boundaryGap</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;KW&#x27;</span>,</span><br><span class="line">        <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">            <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; KW&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">         </span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电量&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">           <span class="comment">// data: [20, 50, 30, 70, 60, 80, 40, 60, 50],</span></span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;purple&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 255, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电时长&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">          <span class="comment">//  data: [30, 40, 60, 50, 70, 20, 30, 40, 60],</span></span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;lightgreen&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 255, 0, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;充电功率&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">          <span class="comment">//   data: [30, 40, 60, 50, 70, 20, 30, 40, 60],</span></span><br><span class="line">            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;skyblue&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(173, 216, 230, 0.5)&#x27;</span>,</span><br><span class="line">                <span class="attr">shadowBlur</span>: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line">    <span class="keyword">const</span> res=<span class="keyword">await</span> <span class="title function_">chartDataApi</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;res.<span class="property">data</span>.<span class="property">list</span>.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        chartOptions.<span class="property">series</span>[i].<span class="property">name</span>=res.<span class="property">data</span>.<span class="property">list</span>[i].<span class="property">name</span></span><br><span class="line">        chartOptions.<span class="property">series</span>[i].<span class="property">data</span>=res.<span class="property">data</span>.<span class="property">list</span>[i].<span class="property">data</span></span><br><span class="line">    &#125;</span><br><span class="line">    chartOptions.<span class="property">legend</span>.<span class="property">data</span>=res.<span class="property">data</span>.<span class="property">list</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>item.<span class="property">name</span>)  </span><br><span class="line">    <span class="keyword">return</span> chartOptions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useChart</span>(chartRef,setChartData)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;useChart.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onBeforeUnmount, <span class="title class_">Ref</span>,markRaw  &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useChart</span>(<span class="params">chartRef: Ref&lt;HTMLElement | <span class="literal">null</span>&gt;, setChartData: <span class="built_in">any</span></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> chartInstance = ref&lt;echarts.<span class="property">ECharts</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//const chartOptions = ref(initialOptions);</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">initChart</span> =<span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (chartRef.<span class="property">value</span>) &#123;</span><br><span class="line">             chartInstance.<span class="property">value</span> =<span class="title function_">markRaw</span>(echarts.<span class="title function_">init</span>(chartRef.<span class="property">value</span>));</span><br><span class="line">             <span class="keyword">const</span> options=<span class="keyword">await</span> <span class="title function_">setChartData</span>()</span><br><span class="line">             chartInstance.<span class="property">value</span>.<span class="title function_">setOption</span>(options);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        chartInstance.<span class="property">value</span>?.<span class="title function_">resize</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">initChart</span>();</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">        <span class="keyword">if</span> (chartInstance.<span class="property">value</span>) &#123;</span><br><span class="line">            chartInstance.<span class="property">value</span>.<span class="title function_">dispose</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>封装好之后，同理饼图我们也可以如此设置</p>
<p>原始配置项</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">        <span class="attr">formatter</span>: <span class="string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; %&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;营收占比&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">            <span class="attr">radius</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;70%&#x27;</span>], <span class="comment">// 内外半径形成环形</span></span><br><span class="line">            <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],</span><br><span class="line">            <span class="attr">roseType</span>: <span class="string">&#x27;area&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>: [<span class="string">&#x27;#4B6EBD&#x27;</span>, <span class="string">&#x27;#3DBB92&#x27;</span>, <span class="string">&#x27;#53C1D6&#x27;</span>], <span class="comment">// 颜色</span></span><br><span class="line">            <span class="attr">label</span>: &#123;</span><br><span class="line">                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">                <span class="attr">label</span>: &#123;</span><br><span class="line">                    <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">fontSize</span>: <span class="string">&#x27;16&#x27;</span>,</span><br><span class="line">                    <span class="attr">fontWeight</span>: <span class="string">&#x27;bold&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">data</span>: [</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">35</span>, <span class="attr">name</span>: <span class="string">&#x27;充电桩&#x27;</span> &#125;,  <span class="comment">// 数据值和名称</span></span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;充电站&#x27;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;充电杆&#x27;</span> &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">graphic</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;营收占比&#x27;</span>,</span><br><span class="line">            <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">            <span class="attr">textVerticalAlign</span>: <span class="string">&#x27;middle&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">fill</span>: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api-dashboard.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    chartData = <span class="string">&#x27;/chartData&#x27;</span>,</span><br><span class="line">    chartData2 = <span class="string">&#x27;/chartData2&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">chartDataApi</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">chartData</span>)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">chartDataApi2</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">chartData2</span>)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">export</span> &#123;chartDataApi,chartDataApi2&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">////echarts图表数据接口2 饼图</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/chartData2&quot;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;操作成功&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>:[</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">35</span>, <span class="attr">name</span>: <span class="string">&#x27;充电桩&#x27;</span> &#125;,  <span class="comment">// 数据值和名称</span></span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;充电站&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;充电杆&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Dashboard.vue</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">setChartData2</span>=<span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> chartOptions=<span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">        <span class="attr">formatter</span>: <span class="string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; %&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;营收占比&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">            <span class="attr">radius</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;70%&#x27;</span>], <span class="comment">// 内外半径形成环形</span></span><br><span class="line">            <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],</span><br><span class="line">            <span class="attr">roseType</span>: <span class="string">&#x27;area&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>: [<span class="string">&#x27;#4B6EBD&#x27;</span>, <span class="string">&#x27;#3DBB92&#x27;</span>, <span class="string">&#x27;#53C1D6&#x27;</span>], <span class="comment">// 颜色</span></span><br><span class="line">            <span class="attr">label</span>: &#123;</span><br><span class="line">                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">                <span class="attr">label</span>: &#123;</span><br><span class="line">                    <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">fontSize</span>: <span class="string">&#x27;16&#x27;</span>,</span><br><span class="line">                    <span class="attr">fontWeight</span>: <span class="string">&#x27;bold&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">data</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">graphic</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;营收占比&#x27;</span>,</span><br><span class="line">            <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">            <span class="attr">textVerticalAlign</span>: <span class="string">&#x27;middle&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">fill</span>: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">    <span class="keyword">const</span> res=<span class="keyword">await</span> <span class="title function_">chartDataApi2</span>();</span><br><span class="line">    chartOptions.<span class="property">series</span>[<span class="number">0</span>].<span class="property">data</span>=res.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">    <span class="keyword">return</span> chartOptions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useChart</span>(chartRef,setChartData)</span><br><span class="line"><span class="title function_">useChart</span>(chartRef2,setChartData2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-雷达图"><a href="#7-雷达图" class="headerlink" title="7.雷达图"></a>7.雷达图</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card&gt;</span><br><span class="line">              &lt;template #header&gt;</span><br><span class="line">                  &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                      &lt;h1&gt;设备总览&lt;/h1&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">              &lt;/template&gt;</span><br><span class="line">              &lt;div ref=&quot;chartRef3&quot; style=&quot;width: 100%; height: 240px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>



<p>&#x3D;&#x3D;mock&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//echarts图表数据接口3 雷达图</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/chartData3&quot;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;操作成功&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>: [<span class="number">42</span>, <span class="number">30</span>, <span class="number">200</span>, <span class="number">350</span>, <span class="number">500</span>, <span class="number">180</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>api</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">chartDataApi3</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">chartData3</span>)</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">setChartData3</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> chartOptions = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">radar</span>: &#123;</span><br><span class="line">        <span class="comment">// shape: &#x27;circle&#x27;,</span></span><br><span class="line">        <span class="attr">indicator</span>: [</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;闲置数&#x27;</span>, <span class="attr">max</span>: <span class="number">65</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;使用数&#x27;</span>, <span class="attr">max</span>: <span class="number">160</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;故障数&#x27;</span>, <span class="attr">max</span>: <span class="number">300</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;维修数&#x27;</span>, <span class="attr">max</span>: <span class="number">380</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;更换数&#x27;</span>, <span class="attr">max</span>: <span class="number">520</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&#x27;报废数&#x27;</span>, <span class="attr">max</span>: <span class="number">250</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;Budget vs spending&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;radar&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: [],</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;Allocated Budget&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">chartDataApi3</span>();</span><br><span class="line">    chartOptions.<span class="property">series</span>[<span class="number">0</span>].<span class="property">data</span>[<span class="number">0</span>].<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">    <span class="keyword">return</span> chartOptions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-营收统计表开发"><a href="#8-营收统计表开发" class="headerlink" title="8.营收统计表开发"></a>8.营收统计表开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">               &lt;template #header&gt;</span><br><span class="line">                   &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                       &lt;h1&gt;营收统计表&lt;/h1&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">               &lt;/template&gt;</span><br><span class="line">               &lt;ul class=&quot;ranking-list&quot;&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot; style=&quot;background-color:rgb(103, 194, 58);color: #fff ;&quot;&gt;1&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;广州&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;52,457&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                               &lt;CaretTop /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot; style=&quot;background-color:rgb(64, 158, 255) ;color: #fff ;&quot;&gt;2&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;上海&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;323,234&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;red&quot;&gt;</span><br><span class="line">                               &lt;CaretBottom /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot; style=&quot;background-color:rgb(230, 162, 60) ;color: #fff ;&quot;&gt;3&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;佛山&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;192,255&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;red&quot;&gt;</span><br><span class="line">                               &lt;CaretBottom /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot;&gt;4&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;珠海&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;17,540&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                               &lt;CaretTop /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot;&gt;5&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;深圳&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;662,337&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;red&quot;&gt;</span><br><span class="line">                               &lt;CaretBottom /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot;&gt;6&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;厦门&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;22,941&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                               &lt;CaretTop /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">                   &lt;li class=&quot;ranking-item&quot;&gt;</span><br><span class="line">                       &lt;span class=&quot;rank&quot;&gt;7&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;store-name&quot;&gt;长沙&lt;/span&gt;</span><br><span class="line">                       &lt;span class=&quot;sales&quot;&gt;565,221&lt;/span&gt;</span><br><span class="line">                       &lt;span style=&quot;margin-left: 50px;&quot;&gt;</span><br><span class="line">                           24%</span><br><span class="line">                           &lt;el-icon color=&quot;green&quot;&gt;</span><br><span class="line">                               &lt;CaretTop /&gt;</span><br><span class="line">                           &lt;/el-icon&gt;</span><br><span class="line">                       &lt;/span&gt;</span><br><span class="line">                   &lt;/li&gt;</span><br><span class="line">               &lt;/ul&gt;</span><br><span class="line">           &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.ranking-list</span> &#123;</span><br><span class="line">    <span class="attribute">list-style-type</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ranking-item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ranking-item</span><span class="selector-pseudo">:nth-child</span>(even) &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">253</span>, <span class="number">246</span>, <span class="number">236</span>);</span><br><span class="line">    <span class="comment">/* 交替背景色 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.rank</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="comment">/* 排名颜色 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.store-name</span> &#123;</span><br><span class="line">    <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sales</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">    <span class="comment">/* 销售额颜色 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-故障报警"><a href="#9-故障报警" class="headerlink" title="9.故障报警"></a>9.故障报警</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;template #header&gt;</span><br><span class="line">                    &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;故障报警&lt;/h1&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">                &lt;el-timeline style=&quot;max-width: 600px&quot;&gt;</span><br><span class="line">                    &lt;el-timeline-item timestamp=&quot;2018/4/12&quot; placement=&quot;top&quot; :hollow=&quot;true&quot; type=&quot;danger&quot;&gt;</span><br><span class="line">                        &lt;el-card&gt;</span><br><span class="line">                            &lt;h4&gt;矿业北路通讯中断&lt;/h4&gt;</span><br><span class="line">                        &lt;/el-card&gt;</span><br><span class="line">                    &lt;/el-timeline-item&gt;</span><br><span class="line">                    &lt;el-timeline-item timestamp=&quot;2018/4/3&quot; placement=&quot;top&quot; :hollow=&quot;true&quot; type=&quot;warning&quot;&gt;</span><br><span class="line">                        &lt;el-card&gt;</span><br><span class="line">                            &lt;h4&gt;黄河南路超出服务区域&lt;/h4&gt;               </span><br><span class="line">                        &lt;/el-card&gt;</span><br><span class="line">                    &lt;/el-timeline-item&gt;</span><br><span class="line">                    &lt;el-timeline-item timestamp=&quot;2018/4/2&quot; placement=&quot;top&quot; :hollow=&quot;true&quot; type=&quot;danger&quot;&gt;</span><br><span class="line">                        &lt;el-card&gt;</span><br><span class="line">                            &lt;h4&gt;6号机组异常断电&lt;/h4&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;/el-card&gt;</span><br><span class="line">                    &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;/el-timeline&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<h1 id="17-充电站监控页面开发"><a href="#17-充电站监控页面开发" class="headerlink" title="17.充电站监控页面开发"></a>17.充电站监控页面开发</h1><p>&#x3D;&#x3D;views-chargingstation-Monitor.vue&#x3D;&#x3D;</p>
<h2 id="1-顶部静态结构开发"><a href="#1-顶部静态结构开发" class="headerlink" title="1.顶部静态结构开发"></a>1.顶部静态结构开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;formParams.input&quot; placeholder=&quot;请输入站点名称、id&quot;&gt;</span><br><span class="line">                    &lt;template #append&gt;</span><br><span class="line">                        &lt;el-select v-model=&quot;select&quot; style=&quot;width: 115px&quot;&gt;</span><br><span class="line">                            &lt;el-option label=&quot;按名称查询&quot; value=&quot;name&quot; /&gt;</span><br><span class="line">                            &lt;el-option label=&quot;按ID查询&quot; value=&quot;id&quot; /&gt;</span><br><span class="line">                        &lt;/el-select&gt;</span><br><span class="line">                    &lt;/template&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-select v-model=&quot;formParams.value&quot; placeholder=&quot;充电站状态&quot;&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;1&quot; label=&quot;全部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;2&quot; label=&quot;使用中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;3&quot; label=&quot;空闲中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;4&quot; label=&quot;维护中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;5&quot; label=&quot;待维修&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button&gt;重置&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">	&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-row&gt;</span><br><span class="line">                &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                    &lt;el-statistic title=&quot;累计充电量(度)&quot; :value=&quot;268900&quot; /&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">                &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                    &lt;el-statistic title=&quot;累计充电次数(次)&quot; :value=&quot;1389&quot;&gt;&lt;/el-statistic&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">                &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                    &lt;el-statistic title=&quot;服务区域(个)&quot; :value=&quot;88&quot; /&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">                &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                    &lt;el-statistic title=&quot;累计效益(元)&quot; :value=&quot;5622178&quot;&gt;</span><br><span class="line">                    &lt;/el-statistic&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line"> 		 &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; &gt;</span><br><span class="line">                &lt;el-icon style=&quot;margin-right: 5px;&quot;&gt;</span><br><span class="line">                    &lt;Plus /&gt;</span><br><span class="line">                &lt;/el-icon&gt;</span><br><span class="line">                新增充电站</span><br><span class="line">            &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref,reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">const formParams = reactive(&#123;</span><br><span class="line">    input: &quot;&quot;,</span><br><span class="line">    value: 1</span><br><span class="line">&#125;)</span><br><span class="line">const select = ref(&quot;name&quot;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="2-表格开发"><a href="#2-表格开发" class="headerlink" title="2.表格开发"></a>2.表格开发</h2><p>了解为基础表格结构之后，开发接口，获取表格数据</p>
<blockquote>
<p><strong>mock接口开发：略，参见源文件</strong></p>
</blockquote>
<blockquote>
<p><strong>api文件封装</strong></p>
</blockquote>
<p>&#x3D;&#x3D;api-chargingstation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ListType</span>&#123;</span><br><span class="line">    <span class="attr">page</span>:<span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">pageSize</span>:<span class="built_in">number</span>,</span><br><span class="line">    name?:<span class="built_in">string</span>,</span><br><span class="line">    id?:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">status</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">List</span> = <span class="string">&#x27;/stationList&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">listApi</span>(<span class="params">data:ListType</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">List</span>,data)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">export</span> &#123;listApi&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;views-chargingstation-Monitor.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive,onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; listApi &#125; from &quot;@/api/chargingstation&quot;</span><br><span class="line">const formParams = reactive(&#123;</span><br><span class="line">    input: &quot;&quot;,</span><br><span class="line">    value: 1</span><br><span class="line">&#125;)</span><br><span class="line">const select = ref(&quot;name&quot;)</span><br><span class="line">const loadData = async () =&gt; &#123;</span><br><span class="line">    const res = await listApi(&#123;page:1,pageSize:10,status:1&#125;);</span><br><span class="line">    console.log(res)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    loadData()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>添加table静态结构和分页静态结构</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table :data=&quot;tableData&quot; style=&quot;width: 100%&quot;  v-loading=&quot;loading&quot;&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;index&quot; width=&quot;60&quot; label=&quot;序号&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;name&quot; label=&quot;站点名称&quot; width=&quot;200&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;id&quot; label=&quot;站点id&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;city&quot; label=&quot;所属城市&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;fast&quot; label=&quot;快充数&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;slow&quot; label=&quot;慢充数&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag v-if=&quot;scope.row.status == 2&quot; type=&quot;primary&quot;&gt;使用中&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag v-else-if=&quot;scope.row.status == 3&quot; type=&quot;success&quot;&gt;空闲中&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag v-else-if=&quot;scope.row.status == 4&quot; type=&quot;warning&quot;&gt;维护中&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag v-else-if=&quot;scope.row.status == 5&quot; type=&quot;danger&quot;&gt;待维修&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;now&quot; label=&quot;正在充电&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;fault&quot; label=&quot;故障数&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;person&quot; label=&quot;站点负责人&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;tel&quot; label=&quot;负责人电话&quot; /&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                    &lt;el-popconfirm title=&quot;确定要删除吗&quot; &gt;</span><br><span class="line">                        &lt;template #reference&gt;</span><br><span class="line">                            &lt;el-button type=&quot;danger&quot; size=&quot;small&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">                        &lt;/template&gt;</span><br><span class="line">                    &lt;/el-popconfirm&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">		&lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">                :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">                :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>对应的ts</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; listApi &#125; from &quot;@/api/chargingstation&quot;</span><br><span class="line">const formParams = reactive(&#123;</span><br><span class="line">    input: &quot;&quot;,</span><br><span class="line">    value: 1</span><br><span class="line">&#125;)</span><br><span class="line">const select = ref(&quot;name&quot;)</span><br><span class="line">const tableData = ref([]);</span><br><span class="line">const loading = ref(false);</span><br><span class="line">const totals = ref(0)</span><br><span class="line">const pageInfo = reactive(&#123;</span><br><span class="line">    page: 1,</span><br><span class="line">    pageSize: 10</span><br><span class="line">&#125;)</span><br><span class="line">const loadData = async () =&gt; &#123;</span><br><span class="line">    loading.value = true</span><br><span class="line">    const &#123;data:&#123;list,total&#125;&#125; = await listApi(&#123; ...pageInfo, [select.value]: formParams.input, status: formParams.value &#125;);</span><br><span class="line">    totals.value = total</span><br><span class="line">    tableData.value = list</span><br><span class="line">    loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    loadData()</span><br><span class="line">&#125;)</span><br><span class="line">const handleSizeChange = (size: number) =&gt; &#123;</span><br><span class="line">    pageInfo.pageSize = size</span><br><span class="line">    loadData()</span><br><span class="line">&#125;</span><br><span class="line">const handleCurrentChange = (page: number) =&gt; &#123;</span><br><span class="line">    pageInfo.page = page;</span><br><span class="line">    loadData()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-查询重置功能"><a href="#3-查询重置功能" class="headerlink" title="3.查询重置功能"></a>3.查询重置功能</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;loadData&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">&lt;el-button @click=&quot;handleReset&quot;&gt;重置&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>重置：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleReset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    pageInfo.<span class="property">page</span> = <span class="number">1</span>;</span><br><span class="line">    pageInfo.<span class="property">pageSize</span> = <span class="number">10</span>;</span><br><span class="line">    formParams.<span class="property">input</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    formParams.<span class="property">value</span> = <span class="number">1</span></span><br><span class="line">    select.<span class="property">value</span> = <span class="string">&quot;name&quot;</span></span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-新增-x2F-编辑充电站"><a href="#4-新增-x2F-编辑充电站" class="headerlink" title="4.新增&#x2F;编辑充电站"></a>4.新增&#x2F;编辑充电站</h2><p>&#x3D;&#x3D;views-chargingstation-components-StationForm.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;编辑站点信息&quot; :model-value=&quot;true&quot;&gt;</span><br><span class="line">        &lt;el-form :model=&quot;ruleForm&quot; label-width=&quot;120&quot; :rules=&quot;rules&quot; ref=&quot;formRef&quot;&gt;</span><br><span class="line">            &lt;el-row&gt;</span><br><span class="line">                &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;站点名称：&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.name&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;站点id：&quot; prop=&quot;id&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.id&quot; :disabled=&quot;disabled&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;所属城市：&quot; prop=&quot;city&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.city&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;站点负责人：&quot; prop=&quot;person&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.person&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;负责人电话：&quot; prop=&quot;tel&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.tel&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">                &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;快充数：&quot; prop=&quot;fast&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.fast&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;慢充数：&quot; prop=&quot;slow&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.slow&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;充电站状态：&quot; prop=&quot;status&quot;&gt;</span><br><span class="line">                        &lt;el-select v-model=&quot;ruleForm.status&quot; placeholder=&quot;充电站状态&quot; :disabled=&quot;disabled&quot;&gt;</span><br><span class="line">                            &lt;el-option :value=&quot;1&quot; label=&quot;全部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option :value=&quot;2&quot; label=&quot;使用中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option :value=&quot;3&quot; label=&quot;空闲中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option :value=&quot;4&quot; label=&quot;维护中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option :value=&quot;5&quot; label=&quot;待维修&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                        &lt;/el-select&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;正在充电：&quot; prop=&quot;now&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.now&quot; :disabled=&quot;disabled&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;故障数：&quot; prop=&quot;fault&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.fault&quot; :disabled=&quot;disabled&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;template #footer&gt;</span><br><span class="line">            &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">                &lt;el-button&gt;取消&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; &gt;</span><br><span class="line">                    确认</span><br><span class="line">                &lt;/el-button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref,reactive&#125; from &#x27;vue&#x27;</span><br><span class="line">import type &#123; FormRules &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import type &#123;RowType&#125; from &quot;../../../types/station&quot;</span><br><span class="line">const ruleForm = ref&lt;RowType&gt;(&#123;</span><br><span class="line">    name: &quot;&quot;,</span><br><span class="line">    id: &quot;&quot;,</span><br><span class="line">    city: &quot;&quot;,</span><br><span class="line">    fast: &quot;&quot;,</span><br><span class="line">    slow: &quot;&quot;,</span><br><span class="line">    status: &quot;&quot;,</span><br><span class="line">    now: &quot;&quot;,</span><br><span class="line">    fault: &quot;&quot;,</span><br><span class="line">    person: &quot;&quot;,</span><br><span class="line">    tel: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const disabled = ref(false)</span><br><span class="line">const rules = reactive&lt;FormRules&lt;RowType&gt;&gt;(&#123;</span><br><span class="line">    name: [</span><br><span class="line">        &#123; required: true, message: &#x27;站点名称不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    id: [</span><br><span class="line">        &#123; required: true, message: &#x27;站点id不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    city: [</span><br><span class="line">        &#123; required: true, message: &#x27;所属城市不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    person: [</span><br><span class="line">        &#123; required: true, message: &#x27;站点负责人不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    tel: [</span><br><span class="line">        &#123; required: true, message: &#x27;负责人电话不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    fast: [</span><br><span class="line">        &#123; required: true, message: &#x27;快充数不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    slow: [</span><br><span class="line">        &#123; required: true, message: &#x27;慢充数不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: [</span><br><span class="line">        &#123; required: true, message: &#x27;充电站状态不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    now: [</span><br><span class="line">        &#123; required: true, message: &#x27;正在充电数不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    fault: [</span><br><span class="line">        &#123; required: true, message: &#x27;故障数量不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-实现弹窗的开关功能"><a href="#5-实现弹窗的开关功能" class="headerlink" title="5.实现弹窗的开关功能"></a>5.实现弹窗的开关功能</h2><p>父组件中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;StationForm :dialog-visible=&quot;visible&quot;&gt;&lt;/StationForm&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>子组件中:</p>
<blockquote>
<p>这里没有选择使用v-model是因为这个数据是父组件传来的，不要双向绑定</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog :model-value=&quot;dialogVisible&quot; :title=&quot;title&quot; @close=&quot;handleCancel&quot;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    <span class="attr">dialogVisible</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>打开：</p>
</blockquote>
<p>&#x3D;&#x3D;父组件&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;edit(scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">RowType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/station&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">edit</span> = (<span class="params">row: RowType</span>) =&gt; &#123;</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关闭：</p>
</blockquote>
<p>&#x3D;&#x3D;子组件&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;el-dialog title=&quot;编辑站点信息&quot; :model-value=&quot;dialogVisible&quot; @close=&quot;handleCancel&quot;&gt; </span><br><span class="line">&lt;el-button @click=&quot;handleCancel&quot;&gt;取消&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&quot;close&quot;</span>])</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleCancel</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;close&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;父组件：&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;StationForm  :dialog-visible=&quot;visible&quot;  @close=&quot;visible = false&quot;&gt;&lt;/StationForm&gt;</span><br></pre></td></tr></table></figure>

<p>现在有个小问题，如果你验证未通过直接关掉，下次打开会发现那个提示还在，可以通过下面设置解决</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog title=&quot;编辑站点信息&quot; :model-value=&quot;dialogVisible&quot; @close=&quot;handleCancel&quot; destroy-on-close&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-实现编辑功能带入数据"><a href="#6-实现编辑功能带入数据" class="headerlink" title="6.实现编辑功能带入数据"></a>6.实现编辑功能带入数据</h2><p>涉及组件之间的传值，我们这里选择使用pinia,当然通过props也可以</p>
<p>&#x3D;&#x3D;store-station.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RowType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@/types/station&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useStationStore = <span class="title function_">defineStore</span>(<span class="string">&quot;station&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rowData = ref&lt;<span class="title class_">RowType</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">fast</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">slow</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">now</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">fault</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">person</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setRowData</span> = (<span class="params">row: RowType</span>) =&gt; &#123;</span><br><span class="line">        rowData.<span class="property">value</span> = row</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;store&quot;</span>,rowData.<span class="property">value</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; rowData, setRowData &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;父组件&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStationStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/station&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stationStore = <span class="title function_">useStationStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123; setRowData &#125; = stationStore</span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">edit</span> = (<span class="params">row: RowType</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setRowData</span>(row)</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;子组件&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStationStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/store/station&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> stationStore = <span class="title function_">useStationStore</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; rowData &#125; = <span class="title function_">storeToRefs</span>(stationStore);</span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> props.<span class="property">dialogVisible</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 等待 DOM 更新</span></span><br><span class="line">    ruleForm.<span class="property">value</span> = rowData.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>有某些数据不能改，所以设置下</p>
</blockquote>
<p>&#x3D;&#x3D;子组件&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> props.<span class="property">dialogVisible</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 等待 DOM 更新</span></span><br><span class="line">    disabled.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    ruleForm.<span class="property">value</span> = rowData.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-新增充电站"><a href="#7-新增充电站" class="headerlink" title="7.新增充电站"></a>7.新增充电站</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;handleAdd&quot;&gt;</span><br><span class="line">           &lt;el-icon style=&quot;margin-right: 5px;&quot;&gt;</span><br><span class="line">               &lt;Plus /&gt;</span><br><span class="line">           &lt;/el-icon&gt;</span><br><span class="line">           新增充电站</span><br><span class="line">       &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleAdd</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setRowData</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">fast</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">slow</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">now</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">fault</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">person</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>取消禁用状态，动态设置标题</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog :title=&quot;title&quot; :model-value=&quot;dialogVisible&quot; @close=&quot;handleCancel&quot; destroy-on-close&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> props.<span class="property">dialogVisible</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 等待 DOM 更新</span></span><br><span class="line">    <span class="keyword">if</span> (rowData.<span class="property">value</span>.<span class="property">name</span>) &#123; <span class="comment">//表示编辑</span></span><br><span class="line">        title.<span class="property">value</span> = <span class="string">&quot;编辑充电站信息&quot;</span></span><br><span class="line">        disabled.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 表示新增</span></span><br><span class="line">        title.<span class="property">value</span> = <span class="string">&quot;新增充电站&quot;</span></span><br><span class="line">        disabled.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    ruleForm.<span class="property">value</span> = rowData.<span class="property">value</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="8-弹框表单确认事件"><a href="#8-弹框表单确认事件" class="headerlink" title="8.弹框表单确认事件"></a>8.弹框表单确认事件</h2><p>提交表单的接口:</p>
<p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//新增/编辑充电站</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/station/edit&quot;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="function">(<span class="params">options: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">res</span>: <span class="built_in">any</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(options.<span class="property">body</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新增/编辑充电站接口收到数据：&quot;</span>res)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api-chargingstation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RowType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@/types/station&quot;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ListType</span>&#123;</span><br><span class="line">    <span class="attr">page</span>:<span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">pageSize</span>:<span class="built_in">number</span>,</span><br><span class="line">    name?:<span class="built_in">string</span>,</span><br><span class="line">    id?:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">status</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">List</span> = <span class="string">&#x27;/stationList&#x27;</span>,</span><br><span class="line">    <span class="title class_">Edit</span>=<span class="string">&quot;/station/edit&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">listApi</span>(<span class="params">data:ListType</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">List</span>,data)</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editApi</span>(<span class="params">data:RowType</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Edit</span>,data)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">export</span> &#123;listApi,editApi&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;子组件&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;handleConfirm&quot;&gt;</span><br><span class="line">                    确认</span><br><span class="line">                &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleConfirm</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    formRef.<span class="property">value</span>?.<span class="title function_">validate</span>(<span class="keyword">async</span> (<span class="attr">valid</span>: <span class="built_in">boolean</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="comment">//调用接口</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">editApi</span>(ruleForm.<span class="property">value</span>);</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">                    <span class="attr">message</span>: res.<span class="property">data</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="title function_">handleCancel</span>();</span><br><span class="line">                <span class="title function_">emit</span>(<span class="string">&quot;reload&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>&#x3D;&#x3D;父组件&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;StationForm :dialog-visible=&quot;visible&quot; @close=&quot;visible = false&quot; @reload=&quot;loadData&quot;&gt;&lt;/StationForm&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-删除充电站"><a href="#9-删除充电站" class="headerlink" title="9.删除充电站"></a>9.删除充电站</h2><p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除充电站接口</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/station/delete&quot;</span>, <span class="string">&quot;post&quot;</span>, <span class="function">(<span class="params">options: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">88</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(options.<span class="property">body</span>))</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RowType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@/types/station&quot;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ListType</span>&#123;</span><br><span class="line">    <span class="attr">page</span>:<span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">pageSize</span>:<span class="built_in">number</span>,</span><br><span class="line">    name?:<span class="built_in">string</span>,</span><br><span class="line">    id?:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">status</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">List</span> = <span class="string">&#x27;/stationList&#x27;</span>,</span><br><span class="line">    <span class="title class_">Edit</span>=<span class="string">&quot;/station/edit&quot;</span>,</span><br><span class="line">    <span class="title class_">Delete</span>=<span class="string">&quot;/station/delete&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">listApi</span>(<span class="params">data:ListType</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">List</span>,data)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editApi</span>(<span class="params">data:RowType</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Edit</span>,data)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deleteApi</span>(<span class="params">id:<span class="built_in">string</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Delete</span>,&#123;id&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> &#123;listApi,editApi,deleteApi&#125;</span><br></pre></td></tr></table></figure>



<p>&#x3D;&#x3D;父组件&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-popconfirm title=&quot;确定要删除吗&quot;  @confirm=&quot;handleDelete(scope.row.id)&quot;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; listApi,deleteApi &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/chargingstation&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleDelete</span> = <span class="keyword">async</span> (<span class="params">id: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">deleteApi</span>(id);</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123; &#125;</span><br><span class="line">    <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">data</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="18-营收统计页面开发"><a href="#18-营收统计页面开发" class="headerlink" title="18.营收统计页面开发"></a>18.营收统计页面开发</h1><h2 id="1-静态结构"><a href="#1-静态结构" class="headerlink" title="1.静态结构"></a>1.静态结构</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;今日总收入 (元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;239,824&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;本月总收入 (万元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;2,924&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;会员卡储值金额 (元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;239,824&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;服务费总金额 (元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;239,824&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;停车费总金额 (元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;239,824&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">                &lt;el-card&gt;</span><br><span class="line">                    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;round&quot;&gt;</span><br><span class="line">                            &lt;el-icon&gt;</span><br><span class="line">                                &lt;Document /&gt;</span><br><span class="line">                            &lt;/el-icon&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;h4&gt;电费总金额 (元)&lt;/h4&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;total mt&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;239,824&lt;/h1&gt;</span><br><span class="line">                        &lt;div class=&quot;percent&quot;&gt;-21%&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.title &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line"></span><br><span class="line">    .round &#123;</span><br><span class="line">        width: 30px;</span><br><span class="line">        height: 30px;</span><br><span class="line">        border-radius: 50%;</span><br><span class="line">        background-color: rgb(235, 236, 245);</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 35px;</span><br><span class="line">        margin-right: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h4 &#123;</span><br><span class="line">        color: #666;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.total &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line"></span><br><span class="line">    h1 &#123;</span><br><span class="line">        margin-right: 20px;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .percent &#123;</span><br><span class="line">        display: inline-block;</span><br><span class="line">        padding: 3px 5px;</span><br><span class="line">        height: 20px;</span><br><span class="line">        color: green;</span><br><span class="line">        font-size: 12px;</span><br><span class="line">        background-color: rgb(235, 247, 239);</span><br><span class="line">        border-radius: 2px;</span><br><span class="line">        line-height: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>封装一个千分位分隔的功能</p>
<p>&#x3D;&#x3D;utils-toThousands.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatNumberToThousands</span>(<span class="params">num: <span class="built_in">number</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="comment">// 确保输入是数字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(num)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;输入必须是一个有效的数字&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数字转换为字符串并去掉小数点后的多余零</span></span><br><span class="line">    <span class="keyword">const</span> numString = num.<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\.0$/</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拆分成整数部分和小数部分</span></span><br><span class="line">    <span class="keyword">const</span> [integerPart, decimalPart] = numString.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>); <span class="comment">// 2345  7</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用数组存储分隔后的整数部分</span></span><br><span class="line">    <span class="keyword">let</span> formattedInteger = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 反向遍历整数部分</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = integerPart.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123; <span class="comment">//2345   i=3</span></span><br><span class="line">        <span class="comment">// 将字符添加到格式化结果中   2345.7</span></span><br><span class="line">        formattedInteger = integerPart[i] + formattedInteger;<span class="comment">//5+&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 每隔3位添加逗号</span></span><br><span class="line">        <span class="keyword">if</span> ((integerPart.<span class="property">length</span> - i) % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; i !== <span class="number">0</span>) &#123;</span><br><span class="line">            formattedInteger = <span class="string">&quot;,&quot;</span> + formattedInteger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有小数部分，则返回完整格式</span></span><br><span class="line">    <span class="keyword">return</span> decimalPart ? <span class="string">`<span class="subst">$&#123;formattedInteger&#125;</span>.<span class="subst">$&#123;decimalPart&#125;</span>`</span> : formattedInteger;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> formatNumberToThousands</span><br></pre></td></tr></table></figure>

<h2 id="2-图表开发"><a href="#2-图表开发" class="headerlink" title="2.图表开发"></a>2.图表开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;div ref=&quot;chartRef&quot; style=&quot;width: 100%; height: 240px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<p>图表接口</p>
<p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//营收统计图表</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/revenueChart&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&quot;销售&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>:[<span class="number">60</span>, <span class="number">40</span>, <span class="number">120</span>, <span class="number">140</span>, <span class="number">160</span>, <span class="number">80</span>, <span class="number">140</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&quot;访问量&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>:[<span class="number">600</span>, <span class="number">400</span>, <span class="number">600</span>, <span class="number">700</span>, <span class="number">800</span>, <span class="number">400</span>, <span class="number">700</span>]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>api接口</p>
<p>&#x3D;&#x3D;api-chargingstation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post,get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RowType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@/types/station&quot;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ListType</span>&#123;</span><br><span class="line">    <span class="attr">page</span>:<span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">pageSize</span>:<span class="built_in">number</span>,</span><br><span class="line">    name?:<span class="built_in">string</span>,</span><br><span class="line">    id?:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">status</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">List</span> = <span class="string">&#x27;/stationList&#x27;</span>,</span><br><span class="line">    <span class="title class_">Edit</span>=<span class="string">&quot;/station/edit&quot;</span>,</span><br><span class="line">    <span class="title class_">Delete</span>=<span class="string">&quot;/station/delete&quot;</span>,</span><br><span class="line">    <span class="title class_">RevenueChart</span>=<span class="string">&quot;/revenueChart&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">listApi</span>(<span class="params">data:ListType</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">List</span>,data)</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editApi</span>(<span class="params">data:RowType</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Edit</span>,data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deleteApi</span>(<span class="params">id:<span class="built_in">string</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Delete</span>,&#123;id&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">chartApi</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">RevenueChart</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> &#123;listApi,editApi,deleteApi,chartApi&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;revenue.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; chartApi &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/chargingstation&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive,ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useChart &#125; <span class="keyword">from</span> <span class="string">&quot;@/hooks/useChart.ts&quot;</span></span><br><span class="line"><span class="keyword">const</span> chartRef=<span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setChartData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> chartOptions = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">tooltip</span>: &#123;</span><br><span class="line">            <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">legend</span>: &#123;</span><br><span class="line">            <span class="attr">data</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">xAxis</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="string">&#x27;一月&#x27;</span>, <span class="string">&#x27;二月&#x27;</span>, <span class="string">&#x27;三月&#x27;</span>, <span class="string">&#x27;四月&#x27;</span>, <span class="string">&#x27;五月&#x27;</span>, <span class="string">&#x27;六月&#x27;</span>, <span class="string">&#x27;七月&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">yAxis</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;销售&#x27;</span>,</span><br><span class="line">                <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;访问量&#x27;</span>,</span><br><span class="line">                <span class="attr">position</span>: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">series</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: [],</span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#409eff&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: [],</span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#409eff&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">chartApi</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.<span class="property">data</span>.<span class="property">list</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        chartOptions.<span class="property">series</span>[i].<span class="property">name</span> = res.<span class="property">data</span>.<span class="property">list</span>[i].<span class="property">name</span></span><br><span class="line">        chartOptions.<span class="property">series</span>[i].<span class="property">data</span> = res.<span class="property">data</span>.<span class="property">list</span>[i].<span class="property">data</span></span><br><span class="line">    &#125;</span><br><span class="line">    chartOptions.<span class="property">legend</span>.<span class="property">data</span> = res.<span class="property">data</span>.<span class="property">list</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item:<span class="built_in">any</span></span>) =&gt;</span> item.<span class="property">name</span>)</span><br><span class="line">    <span class="keyword">return</span> chartOptions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useChart</span>(chartRef, setChartData)</span><br></pre></td></tr></table></figure>

<h2 id="3-表格开发"><a href="#3-表格开发" class="headerlink" title="3.表格开发"></a>3.表格开发</h2><p>表格接口</p>
<p>&#x3D;&#x3D;Mock-index.ts&#x3D;&#x3D;参见源文件</p>
<p>api</p>
<p>&#x3D;&#x3D;api-chargingstation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">  <span class="title class_">Revenue</span>=<span class="string">&quot;/revenueList&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">revenueApi</span>(<span class="params">data:<span class="built_in">any</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">Revenue</span>,data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">           &lt;el-input v-model=&quot;input&quot; style=&quot;max-width: 400px&quot; placeholder=&quot;输入站点名称筛选&quot;&gt;</span><br><span class="line">               &lt;template #append&gt;</span><br><span class="line">                   &lt;el-button :icon=&quot;Search&quot; @click=&quot;loadData&quot;/&gt;</span><br><span class="line">               &lt;/template&gt;</span><br><span class="line">           &lt;/el-input&gt;</span><br><span class="line">           &lt;el-table :data=&quot;tableData&quot; class=&quot;mt&quot; v-loading=&quot;loading&quot;&gt;</span><br><span class="line">               &lt;el-table-column type=&quot;index&quot; width=&quot;60&quot; label=&quot;序号&quot; /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;name&quot; label=&quot;充电站名称&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;id&quot; label=&quot;充电站id&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;city&quot; label=&quot;所属城市&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;count&quot; label=&quot;充电桩总量(个)&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;day&quot; label=&quot;单日总收入(元)&quot; sortable&gt;</span><br><span class="line">                   &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                       &lt;span&gt;&#123;&#123; scope.row.day&#125;&#125;&lt;/span&gt;</span><br><span class="line">                       &lt;el-tag class=&quot;ml&quot; :type=&quot;scope.row.percent&gt;0?&#x27;success&#x27;:&#x27;danger&#x27;&quot; &gt;&#123;&#123; scope.row.percent&gt;0?&quot;+&quot;+scope.row.percent+&quot;%&quot;:scope.row.percent+&quot;%&quot; &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                   &lt;/template&gt;</span><br><span class="line">               &lt;/el-table-column&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;month&quot; label=&quot;月度总收入(元)&quot; &gt;</span><br><span class="line">                   &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                       &lt;span&gt;&#123;&#123;scope.row.month &#125;&#125;&lt;/span&gt;</span><br><span class="line">                       &lt;el-tag class=&quot;ml&quot; :type=&quot;scope.row.mpercent&gt;0?&#x27;success&#x27;:&#x27;danger&#x27;&quot; &gt;&#123;&#123; scope.row.mpercent&gt;0?&quot;+&quot;+scope.row.mpercent+&quot;%&quot;:scope.row.percent+&quot;%&quot; &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                   &lt;/template&gt;</span><br><span class="line">               &lt;/el-table-column&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;electricity&quot; label=&quot;电费营收(元)&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;parkingFee&quot; label=&quot;停车费营收(元)&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;serviceFee&quot; label=&quot;服务费营收(元)&quot;  /&gt;</span><br><span class="line">               &lt;el-table-column prop=&quot;member&quot; label=&quot;会员储值金(元)&quot;  /&gt;</span><br><span class="line">               </span><br><span class="line">           &lt;/el-table&gt;</span><br><span class="line">       &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> formatNumberToThousands <span class="keyword">from</span> <span class="string">&quot;@/utils/toThousands&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; chartApi &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/chargingstation&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive,ref,onMounted &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useChart &#125; <span class="keyword">from</span> <span class="string">&quot;@/hooks/useChart.ts&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;revenueApi&#125; <span class="keyword">from</span> <span class="string">&quot;@/api/chargingstation&quot;</span></span><br><span class="line"><span class="keyword">const</span> input = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> tableData=<span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span>=<span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>:&#123;list,total&#125; &#125; = <span class="keyword">await</span> <span class="title function_">revenueApi</span>(&#123;  <span class="attr">name</span>:input.<span class="property">value</span>&#125;);</span><br><span class="line"> <span class="comment">//   setTotals(total);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 计算day字段</span></span><br><span class="line">      tableData.<span class="property">value</span> = list.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        <span class="attr">day</span>: item.<span class="property">electricity</span> + item.<span class="property">parkingFee</span> + item.<span class="property">serviceFee</span> + item.<span class="property">member</span></span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//tableData.value=data</span></span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-分页功能"><a href="#4-分页功能" class="headerlink" title="4.分页功能"></a>4.分页功能</h2><p>我们考虑到不同页面分页功能好多东西都是一致的，所以我们去封装一个自定义组合式函数</p>
<p>&#x3D;&#x3D;hooks-usePagination.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">usePagaination</span>(<span class="params">loadData:()=&gt;<span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;,initialPageSize=<span class="number">10</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> totals = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> pageInfo = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: initialPageSize</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleSizeChange</span> = (<span class="params">size: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">        pageInfo.<span class="property">pageSize</span> = size</span><br><span class="line">        <span class="title function_">loadData</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleCurrentChange</span> = (<span class="params">page: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">        pageInfo.<span class="property">page</span> = page;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">666</span>,pageInfo.<span class="property">page</span>)</span><br><span class="line">        <span class="title function_">loadData</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resetPagination</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        pageInfo.<span class="property">page</span> = <span class="number">1</span>;</span><br><span class="line">        pageInfo.<span class="property">pageSize</span> = initialPageSize;</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setTotals</span>=(<span class="params">all:<span class="built_in">number</span></span>)=&gt;&#123;</span><br><span class="line">        totals.<span class="property">value</span>=all</span><br><span class="line">    &#125;  </span><br><span class="line">      <span class="keyword">return</span>&#123;</span><br><span class="line">        totals,setTotals,pageInfo,handleSizeChange,handleCurrentChange,resetPagination</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;revenue.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">               :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">               :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;usePagaination&#125; <span class="keyword">from</span> <span class="string">&quot;@/hooks/usePagaination&quot;</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">     totals,</span><br><span class="line">     setTotals,</span><br><span class="line">     pageInfo,</span><br><span class="line">     handleSizeChange,</span><br><span class="line">     handleCurrentChange,</span><br><span class="line">     resetPagination</span><br><span class="line">    &#125;=<span class="title function_">usePagaination</span>(loadData)</span><br></pre></td></tr></table></figure>

<p><img src="D:/Software/Typora/images/image-20241025134256268.png" alt="image-20241025134256268"></p>
<h1 id="19-充电桩管理页面开发"><a href="#19-充电桩管理页面开发" class="headerlink" title="19.充电桩管理页面开发"></a>19.充电桩管理页面开发</h1><h2 id="1-静态结构开发"><a href="#1-静态结构开发" class="headerlink" title="1.静态结构开发"></a>1.静态结构开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">   &lt;el-card&gt;</span><br><span class="line">     &lt;el-select  style=&quot;width: 300px;&quot; placeholder=&quot;选择站点名称&quot;&gt;&lt;/el-select&gt;</span><br><span class="line">   &lt;/el-card&gt;</span><br><span class="line">   &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">    &lt;el-radio-group  size=&quot;large&quot;&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;全部&quot; :value=&quot;0&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;空闲中&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;充电中&quot; :value=&quot;2&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;连接中&quot; :value=&quot;3&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;排队中&quot; :value=&quot;4&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;已预约&quot; :value=&quot;5&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;故障/离线&quot; :value=&quot;6&quot; /&gt;</span><br><span class="line">        &lt;/el-radio-group&gt;</span><br><span class="line">   &lt;/el-card&gt;</span><br><span class="line">   &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;pic&quot;&gt;</span><br><span class="line">                        &lt;p&gt;空闲中&lt;/p&gt;</span><br><span class="line">                        &lt;img :src=&quot;free&quot; alt=&quot;&quot; width=&quot;100px&quot;&gt;</span><br><span class="line">                        &lt;p&gt; 80%&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;info&quot;&gt;</span><br><span class="line">                        &lt;h3&gt;</span><br><span class="line">                            CD1001</span><br><span class="line">                        &lt;/h3&gt;</span><br><span class="line">                        &lt;hr class=&quot;mb&quot;&gt;</span><br><span class="line">                        &lt;p&gt;电压：314v&lt;/p&gt;</span><br><span class="line">                        &lt;p&gt;电流：212.2A&lt;/p&gt;</span><br><span class="line">                        &lt;p&gt;功率：21KW&lt;/p&gt;</span><br><span class="line">                        &lt;p&gt;温度：32°c&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;divder&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;p class=&quot;fl ml&quot; style=&quot;font-size: 12px;color: #999;&quot;&gt;暂无预警&lt;/p&gt;</span><br><span class="line">                        &lt;div style=&quot;text-align: right;&quot; class=&quot;fr&quot;&gt;</span><br><span class="line">                            &lt;el-button size=&quot;small&quot;&gt;维保记录&lt;/el-button&gt;</span><br><span class="line">                            &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; class=&quot;mr&quot;&gt;使用记录&lt;/el-button&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">   &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line"></span><br><span class="line">import free from &quot;@/assets/free.png&quot;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.item &#123;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    background-color: rgb(247, 251, 254);</span><br><span class="line">    height: 200px;</span><br><span class="line">    border-radius: 10px 10px 0 0;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line"></span><br><span class="line">    .pic &#123;</span><br><span class="line">        p &#123;</span><br><span class="line">            width: 76px;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin-bottom: 10px;</span><br><span class="line">            color: rgb(61, 187, 146);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .info &#123;</span><br><span class="line">        color: #999;</span><br><span class="line">        margin-left: 30px;</span><br><span class="line">        line-height: 26px;</span><br><span class="line">        margin-top: -10px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn &#123;</span><br><span class="line">    background-color: #f7fbfe;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 50px;</span><br><span class="line">    line-height: 50px;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.divder &#123;</span><br><span class="line">    background-color: #f4f4f4;</span><br><span class="line">    height: 2px;</span><br><span class="line">    width: 95%;</span><br><span class="line">    margin: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.record &#123;</span><br><span class="line"></span><br><span class="line">    height: 60px;</span><br><span class="line">    line-height: 60px;</span><br><span class="line">    text-align: center;</span><br><span class="line"></span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-对接接口"><a href="#2-对接接口" class="headerlink" title="2.对接接口"></a>2.对接接口</h2><p>&#x3D;&#x3D;mock ，见源文件&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;api-chargingstation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title class_">CurrentList</span>=<span class="string">&quot;currentList&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">currentListApi</span>(<span class="params">name:<span class="built_in">string</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">currentList</span>,&#123;name&#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-组件中实现搜索框模糊查询"><a href="#3-组件中实现搜索框模糊查询" class="headerlink" title="3.组件中实现搜索框模糊查询"></a>3.组件中实现搜索框模糊查询</h2><blockquote>
<p>为el-select添加filterable属性即可启用搜索功能</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-select v-model=&quot;value&quot; style=&quot;width: 300px;&quot; placeholder=&quot;选择站点名称&quot; filterable </span><br><span class="line">            :remote-method=&quot;remoteMethod&quot;&gt;</span><br><span class="line">            &lt;el-option v-for=&quot;item in optionsCopy&quot; :key=&quot;item.id&quot; :value=&quot;item.name&quot;&gt;&#123;&#123; item.name &#125;&#125;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> ing <span class="keyword">from</span> <span class="string">&quot;@/assets/ing.png&quot;</span></span><br><span class="line"><span class="keyword">import</span> free <span class="keyword">from</span> <span class="string">&quot;@/assets/free.png&quot;</span></span><br><span class="line"><span class="keyword">import</span> outline <span class="keyword">from</span> <span class="string">&quot;@/assets/outline.png&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; currentListApi &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/chargingstation&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ref,onMounted&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">const</span> value = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> options = ref&lt;<span class="built_in">any</span>&gt;([])<span class="comment">//存原始下拉框</span></span><br><span class="line"><span class="keyword">let</span> optionsCopy = ref&lt;<span class="built_in">any</span>&gt;([]);<span class="comment">//复制下拉框</span></span><br><span class="line"><span class="keyword">const</span> dataList = <span class="title function_">ref</span>([]);<span class="comment">//原始数据</span></span><br><span class="line"><span class="keyword">let</span> dataListCopy = <span class="title function_">ref</span>([])<span class="comment">//复制数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params">query = <span class="string">&quot;&quot;</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">currentListApi</span>(query);</span><br><span class="line">    options.<span class="property">value</span> = data</span><br><span class="line">    dataList.<span class="property">value</span> = data[<span class="number">0</span>].<span class="property">list</span> <span class="comment">//默认加载第一个的数据</span></span><br><span class="line">    dataListCopy.<span class="property">value</span> = data[<span class="number">0</span>].<span class="property">list</span></span><br><span class="line">    optionsCopy.<span class="property">value</span> = data;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">remoteMethod</span> = (<span class="params">query: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    optionsCopy.<span class="property">value</span> = options.<span class="property">value</span> <span class="comment">//初始化</span></span><br><span class="line">    optionsCopy.<span class="property">value</span> = optionsCopy.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span>.<span class="title function_">includes</span>(query))</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-单选按钮组查询"><a href="#4-单选按钮组查询" class="headerlink" title="4.单选按钮组查询"></a>4.单选按钮组查询</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-radio-group v-model=&quot;radio&quot; size=&quot;large&quot; @change=&quot;handleChange&quot;&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`全部($&#123;allCount&#125;)`&quot; :value=&quot;0&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`空闲中($&#123;checkCount(1)&#125;)`&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`充电中($&#123;checkCount(2)&#125;)`&quot; :value=&quot;2&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`连接中($&#123;checkCount(3)&#125;)`&quot; :value=&quot;3&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`排队中($&#123;checkCount(4)&#125;)`&quot; :value=&quot;4&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`已预约($&#123;checkCount(5)&#125;)`&quot; :value=&quot;5&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button :label=&quot;`故障/离线($&#123;checkCount(6)&#125;)`&quot; :value=&quot;6&quot; /&gt;</span><br><span class="line">        &lt;/el-radio-group&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> radio = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> allCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">checkCount</span>(<span class="number">1</span>) + <span class="title function_">checkCount</span>(<span class="number">2</span>) + <span class="title function_">checkCount</span>(<span class="number">3</span>) + <span class="title function_">checkCount</span>(<span class="number">4</span>) + <span class="title function_">checkCount</span>(<span class="number">5</span>) + <span class="title function_">checkCount</span>(<span class="number">6</span>))</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkCount</span>(<span class="params">num:<span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> dataList.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item:<span class="built_in">any</span></span>) =&gt;</span> item.<span class="property">status</span> == num).<span class="property">length</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">val: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    dataListCopy.<span class="property">value</span> = dataList.<span class="property">value</span></span><br><span class="line">    <span class="keyword">if</span> (val != <span class="number">0</span>) &#123;</span><br><span class="line">        dataListCopy.<span class="property">value</span> = dataListCopy.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item:<span class="built_in">any</span></span>) =&gt;</span> item.<span class="property">status</span> == val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-充电桩列表"><a href="#5-充电桩列表" class="headerlink" title="5.充电桩列表"></a>5.充电桩列表</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">       &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">           &lt;el-col :span=&quot;6&quot; v-for=&quot;item in dataListCopy&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">               &lt;div class=&quot;item&quot;&gt;</span><br><span class="line">                   &lt;div class=&quot;pic&quot;&gt;</span><br><span class="line">                       &lt;p v-if=&quot;item.status == 1&quot;&gt;空闲中&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else-if=&quot;item.status == 2&quot;&gt;充电中&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else-if=&quot;item.status == 3&quot;&gt;连接中&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else-if=&quot;item.status == 4&quot;&gt;排队中&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else-if=&quot;item.status == 5&quot;&gt;已预约&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else-if=&quot;item.status == 6&quot;&gt;故障/离线&lt;/p&gt;</span><br><span class="line">                       &lt;img :src=&quot;item.status == 1 ? free : (item.status == 6 ? outline : ing)&quot; alt=&quot;&quot; width=&quot;100px&quot;&gt;</span><br><span class="line">                       &lt;p v-if=&quot;item.status == 2&quot;&gt;&#123;&#123; item.percent &#125;&#125;&lt;/p&gt;</span><br><span class="line">                       &lt;p v-else&gt;0%&lt;/p&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">                   &lt;div class=&quot;info&quot;&gt;</span><br><span class="line">                       &lt;h3&gt;</span><br><span class="line">                           &#123;&#123; item.id &#125;&#125;</span><br><span class="line">                       &lt;/h3&gt;</span><br><span class="line">                       &lt;hr class=&quot;mb&quot;&gt;</span><br><span class="line">                       &lt;p&gt;电压：&#123;&#123; item.voltage &#125;&#125;&lt;/p&gt;</span><br><span class="line">                       &lt;p&gt;电流：&#123;&#123; item.current &#125;&#125;&lt;/p&gt;</span><br><span class="line">                       &lt;p&gt;功率：&#123;&#123; item.power &#125;&#125;&lt;/p&gt;</span><br><span class="line">                       &lt;p&gt;温度：&#123;&#123; item.tem &#125;&#125;&lt;/p&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">               &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">               &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">                   &lt;div class=&quot;divder&quot;&gt;&lt;/div&gt;</span><br><span class="line">                   &lt;div&gt;</span><br><span class="line">                       &lt;p class=&quot;fl ml&quot; style=&quot;font-size: 12px;color: #999;&quot;&gt;暂无预警&lt;/p&gt;</span><br><span class="line">                       &lt;div style=&quot;text-align: right;&quot; class=&quot;fr&quot;&gt;</span><br><span class="line">                           &lt;el-button size=&quot;small&quot;&gt;维保记录&lt;/el-button&gt;</span><br><span class="line">                           &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; class=&quot;mr&quot;&gt;使用记录&lt;/el-button&gt;</span><br><span class="line">                       &lt;/div&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">               &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line">       &lt;/el-row&gt;</span><br><span class="line">   &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watch</span>(value, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = optionsCopy.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span> == value.<span class="property">value</span>);</span><br><span class="line">    dataListCopy.<span class="property">value</span> = res[<span class="number">0</span>].<span class="property">list</span></span><br><span class="line">    dataList.<span class="property">value</span> = res[<span class="number">0</span>].<span class="property">list</span></span><br><span class="line">    radio.<span class="property">value</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>添加浮框</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div style=&quot;text-align: right;&quot; class=&quot;fr&quot;&gt;</span><br><span class="line">        &lt;el-button size=&quot;small&quot;&gt;维保记录&lt;/el-button&gt;</span><br><span class="line">        &lt;el-popover placement=&quot;top-start&quot; title=&quot;使用记录&quot; :width=&quot;200&quot; trigger=&quot;hover&quot;</span><br><span class="line">            content=&quot;本日使用记录&quot;&gt;</span><br><span class="line">            &lt;template #reference&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; class=&quot;mr&quot;&gt;使用记录&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;el-timeline style=&quot;max-width: 600px&quot;&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;12:08:17&quot;&gt;</span><br><span class="line">                    充电80度，消费80元</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;13:12:09&quot;&gt;</span><br><span class="line">                   re</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;13:15:22&quot;&gt;</span><br><span class="line">                    充电60度，消费60元</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;16:22:33&quot;&gt;</span><br><span class="line">                    充电70度，消费70元</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;17:27:17&quot;&gt;</span><br><span class="line">                    充电100度，消费100元</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">                &lt;el-timeline-item timestamp=&quot;18:08:33&quot;&gt;</span><br><span class="line">                    充电80度，消费80元</span><br><span class="line">                &lt;/el-timeline-item&gt;</span><br><span class="line">            &lt;/el-timeline&gt;</span><br><span class="line">        &lt;/el-popover&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>



<h1 id="20-电子地图页面开发"><a href="#20-电子地图页面开发" class="headerlink" title="20.电子地图页面开发"></a>20.电子地图页面开发</h1><h2 id="1-高德地图api"><a href="#1-高德地图api" class="headerlink" title="1.高德地图api"></a>1.高德地图api</h2><blockquote>
<p>高德地图官网中，选择js api</p>
</blockquote>
<p><img src="D:/Software/Typora/images/image-20241028144021633.png" alt="image-20241028144021633"></p>
<blockquote>
<p>选择进阶教程，结合vue使用</p>
</blockquote>
<p><img src="D:/Software/Typora/images/image-20241028144138642.png" alt="image-20241028144138642"></p>
<p>&#x3D;&#x3D;components-Map-MapContainer.vue&#x3D;&#x3D;</p>
<p>创建基础容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>添加样式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line">#container &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 80vh;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>安装地图api</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm i @amap/amap<span class="literal">-jsapi-loader</span> <span class="literal">--save</span></span><br></pre></td></tr></table></figure>



<p>根据文档介绍创建基础模板</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import AMapLoader from &quot;@amap/amap-jsapi-loader&quot;;</span><br><span class="line">import &#123; onMounted, onUnmounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">let map = null;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  AMapLoader.load(&#123;</span><br><span class="line">    key: &quot;7066344199d5d8c8bd499c1d4bfc1984&quot;, // 申请好的Web端开发者Key，首次调用 load 时必填</span><br><span class="line">    version: &quot;1.4.15&quot;, // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15</span><br><span class="line">    plugins: [], //需要使用的的插件列表，如比例尺&#x27;AMap.Scale&#x27;，支持添加多个如：[&#x27;...&#x27;,&#x27;...&#x27;]</span><br><span class="line">  &#125;)</span><br><span class="line">    .then((AMap) =&gt; &#123;</span><br><span class="line">      map = new AMap.Map(&quot;container&quot;, &#123;</span><br><span class="line">        // 设置地图容器id</span><br><span class="line">        viewMode: &quot;3D&quot;, // 是否为3D地图模式</span><br><span class="line">        zoom:5, // 初始化地图级别</span><br><span class="line">        center: [116.397428, 39.90923], // 初始化地图中心点位置</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((e) =&gt; &#123;</span><br><span class="line">      console.log(e);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">#container &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 80vh;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;views-map-ElectronicMap.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line">                &lt;MapContainer /&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import MapContainer from &quot;@/components/Map/MapContainer.vue&quot;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="2-地图添加点标记"><a href="#2-地图添加点标记" class="headerlink" title="2.地图添加点标记"></a>2.地图添加点标记</h2><blockquote>
<p>1.创建mock文件：详见源文件</p>
</blockquote>
<blockquote>
<p>2.创建api</p>
</blockquote>
<p>&#x3D;&#x3D;src-api-map.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span>&#123;</span><br><span class="line">    <span class="title class_">MapList</span>=<span class="string">&quot;/mapList&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapListApi</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">MapList</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span>&#123;mapListApi&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;components-Map-MapContain.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import AMapLoader from &quot;@amap/amap-jsapi-loader&quot;;</span><br><span class="line">import &#123; onMounted, onUnmounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">import icon from &quot;../../assets/flashIcon.png&quot;;</span><br><span class="line">import stationPic from &quot;@/assets/station.jpg&quot;</span><br><span class="line">import &#123; mapListApi &#125; from &quot;@/api/map.ts&quot;</span><br><span class="line">let map:any = null;</span><br><span class="line">const markersData = ref&lt;any&gt;([])</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  AMapLoader.load(&#123;</span><br><span class="line">    key: &quot;7066344199d5d8c8bd499c1d4bfc1984&quot;, // 申请好的Web端开发者Key，首次调用 load 时必填</span><br><span class="line">    version: &quot;1.4.15&quot;, // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15</span><br><span class="line">    plugins: [], //需要使用的的插件列表，如比例尺&#x27;AMap.Scale&#x27;，支持添加多个如：[&#x27;...&#x27;,&#x27;...&#x27;]</span><br><span class="line">  &#125;)</span><br><span class="line">    .then((AMap) =&gt; &#123;</span><br><span class="line">      map = new AMap.Map(&quot;container&quot;, &#123;</span><br><span class="line">        // 设置地图容器id</span><br><span class="line">        viewMode: &quot;3D&quot;, // 是否为3D地图模式</span><br><span class="line">        zoom:5, // 初始化地图级别</span><br><span class="line">        center: [116.397428, 39.90923], // 初始化地图中心点位置</span><br><span class="line">      &#125;);</span><br><span class="line">      mapListApi().then((&#123; data &#125;)=&gt; &#123;</span><br><span class="line">        markersData.value = data;</span><br><span class="line">        // 创建信息窗体实例</span><br><span class="line">        const infoWindow = new AMap.InfoWindow(&#123;</span><br><span class="line">          offset: new AMap.Pixel(0, -30), // 信息窗体的偏移量</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // 添加自定义标记</span><br><span class="line">        markersData.value.forEach((markerData:any) =&gt; &#123;</span><br><span class="line">          const marker = new AMap.Marker(&#123;</span><br><span class="line">            position: markerData.position,</span><br><span class="line">            title: markerData.title,</span><br><span class="line">            icon: icon</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          // 添加点击事件</span><br><span class="line">          marker.on(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">            infoWindow.setContent(`</span><br><span class="line">              &lt;div style=&quot;display:flex;padding:10px;align-items:center;&quot;&gt;</span><br><span class="line">                  &lt;div&gt;</span><br><span class="line">                    &lt;img src=&quot;$&#123;stationPic&#125;&quot; width=&quot;200px&quot;/&gt;  </span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div style=&quot;width:180px;line-height:30px;margin-left:20px&quot;&gt;</span><br><span class="line">                    &lt;h3&gt;$&#123;markerData.title&#125;&lt;/h3&gt; </span><br><span class="line">                    &lt;p&gt;充电桩数量：$&#123;markerData.count&#125;&lt;/p&gt; </span><br><span class="line">                    &lt;p &gt;充电站状态：&lt;span style=&quot;color:blue&quot;&gt;$&#123;markerData.status==1?&quot;使用中&quot;:&quot;维护中&quot;&#125;&lt;/span&gt;&lt;/p&gt; </span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            `); // 设置窗体内容</span><br><span class="line">            infoWindow.open(map, marker.getPosition()); // 在地图上打开信息窗体</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          marker.setMap(map); // 将标记添加到地图上</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((e) =&gt; &#123;</span><br><span class="line">      console.log(e);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  map?.destroy();</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">#container &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 80vh;</span><br><span class="line">&#125;</span><br><span class="line">.info-modal&#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  padding: 20px !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>



<h2 id="3-右侧表单开发"><a href="#3-右侧表单开发" class="headerlink" title="3.右侧表单开发"></a>3.右侧表单开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">            &lt;el-card class=&quot;des&quot;&gt;</span><br><span class="line">                &lt;div&gt;1.累计充电站数量：&lt;el-text type=&quot;primary&quot;&gt;34个&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;2.单省份最多充电桩：&lt;el-text type=&quot;primary&quot;&gt;北京(4个)&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;3.充电站遍及省份：&lt;el-text type=&quot;primary&quot;&gt;14个&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;4.暂无充电站省份：&lt;el-text type=&quot;primary&quot;&gt;22个&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;5.累计充电站：&lt;el-text type=&quot;primary&quot;&gt;北京(4个)&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;6.单日营收最高：&lt;el-text type=&quot;primary&quot;&gt;北京西单充电站&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;7.单日营收最低：&lt;el-text type=&quot;primary&quot;&gt;南宁青秀山充电站&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;8.故障率最高：&lt;el-text type=&quot;primary&quot;&gt;兰州黄河桥充电站&lt;/el-text&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">            &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;template #header&gt;</span><br><span class="line">                    &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                        &lt;h3&gt;新增站点地图&lt;/h3&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">                &lt;el-form :model=&quot;form&quot; style=&quot;max-width: 600px&quot; label-width=&quot;85px&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;站点名称：&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.name&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;站点地址：&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.name&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;经度：&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.name&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;纬度：&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.name&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;立即使用：&quot;&gt;</span><br><span class="line">                        &lt;el-switch v-model=&quot;form.delivery&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;备注：&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.desc&quot; type=&quot;textarea&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item&gt;</span><br><span class="line">                        &lt;el-button type=&quot;primary&quot; &gt;创建&lt;/el-button&gt;</span><br><span class="line">                        &lt;el-button&gt;清空&lt;/el-button&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import MapContainer from &quot;@/components/Map/MapContainer.vue&quot;;</span><br><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// do not use same name with ref</span><br><span class="line">const form = reactive(&#123;</span><br><span class="line">    name: &#x27;&#x27;,</span><br><span class="line">    region: &#x27;&#x27;,</span><br><span class="line">    date1: &#x27;&#x27;,</span><br><span class="line">    date2: &#x27;&#x27;,</span><br><span class="line">    delivery: false,</span><br><span class="line">    type: [],</span><br><span class="line">    resource: &#x27;&#x27;,</span><br><span class="line">    desc: &#x27;&#x27;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h1 id="21-订单管理页面开发"><a href="#21-订单管理页面开发" class="headerlink" title="21.订单管理页面开发"></a>21.订单管理页面开发</h1><h2 id="1-静态结构搭建"><a href="#1-静态结构搭建" class="headerlink" title="1.静态结构搭建"></a>1.静态结构搭建</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.orderNo&quot; placeholder=&quot;请输入订单号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-select v-model=&quot;searchParams.status&quot; placeholder=&quot;订单状态&quot;&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;1&quot; label=&quot;全部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;2&quot; label=&quot;进行中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;3&quot; label=&quot;已完成&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;4&quot; label=&quot;异常&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.no&quot; placeholder=&quot;设备编号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button &gt;重置&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.name&quot; placeholder=&quot;请输入站点名称&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;el-date-picker v-model=&quot;date&quot; type=&quot;daterange&quot; range-separator=&quot;/&quot; value-format=&quot;YYYY-MM-DD&quot;</span><br><span class="line">                    @change=&quot;handleChange&quot; start-placeholder=&quot;开始日期&quot; end-placeholder=&quot;结束日期&quot; /&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; &gt;批量删除&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; icon=&quot;Download&quot;&gt;导出订单数据到Excel&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-table &gt;</span><br><span class="line">            &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;orderNo&quot; label=&quot;订单号&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;equipmentNo&quot; label=&quot;设备编号&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;date&quot; label=&quot;订单日期&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;startTime&quot; label=&quot;开始时间&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;endTime&quot; label=&quot;结束时间&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;money&quot; label=&quot;金额&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;pay&quot; label=&quot;支付方式&quot; /&gt;</span><br><span class="line">            &lt;el-table-column&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;success&quot; v-if=&quot;scope.row.status == 2&quot;&gt;进行中&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;primary&quot; v-else-if=&quot;scope.row.status == 3&quot;&gt;已完成&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;warning&quot; v-else-if=&quot;scope.row.status == 4&quot;&gt;异常&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;opera&quot; label=&quot;操作&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        详情</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button type=&quot;danger&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        删除</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;!-- &lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">            :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">            :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt; --&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;  ref &#125; from &quot;vue&quot;</span><br><span class="line">const date = ref([&quot;&quot;, &quot;&quot;])</span><br><span class="line">interface SearchType&#123;</span><br><span class="line">    orderNo: string</span><br><span class="line">    status: number,</span><br><span class="line">    no: string,</span><br><span class="line">    startDate: string,</span><br><span class="line">    endDate: string,</span><br><span class="line">    name: string</span><br><span class="line">&#125;</span><br><span class="line">const searchParams = ref&lt;SearchType&gt;(&#123;</span><br><span class="line">    orderNo: &quot;&quot;,</span><br><span class="line">    status: 1,</span><br><span class="line">    no: &quot;&quot;,</span><br><span class="line">    startDate: &quot;&quot;,</span><br><span class="line">    endDate: &quot;&quot;, //不能写成date.value[0]</span><br><span class="line">    name: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const handleChange = (val:string[]) =&gt; &#123;</span><br><span class="line">    searchParams.value.startDate = val[0]</span><br><span class="line">    searchParams.value.endDate = val[1]</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-创建mock"><a href="#2-创建mock" class="headerlink" title="2.创建mock"></a>2.创建mock</h2><p>&#x3D;&#x3D;api-operations.ts&#x3D;&#x3D;</p>
<h2 id="3-封装自定义组合式函数优化"><a href="#3-封装自定义组合式函数优化" class="headerlink" title="3.封装自定义组合式函数优化"></a>3.封装自定义组合式函数优化</h2><p>我们项目中有很多查询表格，很多操作都是类似的，可以优化吗，当然可以</p>
<p>下面可以封装一个组合式函数处理</p>
<p>&#x3D;&#x3D;hooks-useHttp.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, onMounted,unref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/http&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Http 组合式函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useHttp&lt;T&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">initialParams</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dataList = ref&lt;T[]&gt;([]);</span><br><span class="line">    <span class="keyword">const</span> loading = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> totals = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> pageInfo = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 加载数据的函数</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        loading.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">post</span>(url, &#123;...pageInfo,...<span class="title function_">unref</span>(initialParams)&#125;);</span><br><span class="line">           </span><br><span class="line">            dataList.<span class="property">value</span> = data.<span class="property">list</span>;</span><br><span class="line">            totals.<span class="property">value</span> = data.<span class="property">total</span>; <span class="comment">// 假设返回总数</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching data:&#x27;</span>, error);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            loading.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 在组件挂载时加载数据</span></span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">loadData</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleSizeChange</span> = (<span class="params">size: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleSizeChange&quot;</span>)</span><br><span class="line">        pageInfo.<span class="property">pageSize</span> = size;</span><br><span class="line">        <span class="title function_">loadData</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleCurrentChange</span> = (<span class="params">page: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleCurrentChange&quot;</span>)</span><br><span class="line">       pageInfo.<span class="property">page</span> = page;</span><br><span class="line">        <span class="title function_">loadData</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resetPagination</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        pageInfo.<span class="property">page</span> = <span class="number">1</span>;</span><br><span class="line">        pageInfo.<span class="property">pageSize</span> = <span class="number">10</span>; </span><br><span class="line">        <span class="title function_">loadData</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dataList,</span><br><span class="line">        loading,</span><br><span class="line">        loadData,</span><br><span class="line">        totals,</span><br><span class="line">        pageInfo,</span><br><span class="line">        handleSizeChange,</span><br><span class="line">        handleCurrentChange,</span><br><span class="line">        resetPagination,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-组件中直接使用"><a href="#4-组件中直接使用" class="headerlink" title="4.组件中直接使用"></a>4.组件中直接使用</h2><p>&#x3D;&#x3D;Orders.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.orderNo&quot; placeholder=&quot;请输入订单号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-select v-model=&quot;searchParams.status&quot; placeholder=&quot;订单状态&quot;&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;1&quot; label=&quot;全部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;2&quot; label=&quot;进行中&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;3&quot; label=&quot;已完成&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;4&quot; label=&quot;异常&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.no&quot; placeholder=&quot;设备编号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;loadData&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button @click=&quot;handleReset&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.name&quot; placeholder=&quot;请输入站点名称&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">                &lt;el-date-picker v-model=&quot;date&quot; type=&quot;daterange&quot; range-separator=&quot;/&quot; value-format=&quot;YYYY-MM-DD&quot;</span><br><span class="line">                    @change=&quot;handleChange&quot; start-placeholder=&quot;开始日期&quot; end-placeholder=&quot;结束日期&quot; /&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; :disabled=&quot;!selectionList.length&quot; @click=&quot;handleBatchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; :disabled=&quot;!selectionList.length&quot; icon=&quot;Download&quot;&gt;导出订单数据到Excel&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-table :data=&quot;dataList&quot; v-loading=&quot;loading&quot; @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;orderNo&quot; label=&quot;订单号&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;equipmentNo&quot; label=&quot;设备编号&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;date&quot; label=&quot;订单日期&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;startTime&quot; label=&quot;开始时间&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;endTime&quot; label=&quot;结束时间&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;money&quot; label=&quot;金额&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;pay&quot; label=&quot;支付方式&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;status&quot; label=&quot;订单状态&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;success&quot; v-if=&quot;scope.row.status == 2&quot;&gt;进行中&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;primary&quot; v-else-if=&quot;scope.row.status == 3&quot;&gt;已完成&lt;/el-tag&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;warning&quot; v-else-if=&quot;scope.row.status == 4&quot;&gt;异常&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;opera&quot; label=&quot;操作&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        详情</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button type=&quot;danger&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        删除</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">            :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">            :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;  ref &#125; from &quot;vue&quot;</span><br><span class="line">import &#123; useHttp &#125; from &quot;@/hooks/useHttp&quot;;</span><br><span class="line">import &#123; batchDeleteApi &#125; from &quot;@/api/operations&quot;</span><br><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line">interface SearchType&#123;</span><br><span class="line">    orderNo: string,</span><br><span class="line">    status: number,</span><br><span class="line">    no: string,</span><br><span class="line">    startDate: string,</span><br><span class="line">    endDate: string,</span><br><span class="line">    name: string</span><br><span class="line">&#125;</span><br><span class="line">interface SelectionListType&#123;</span><br><span class="line">    orderNo:string,</span><br><span class="line">    equipmentNo:string,</span><br><span class="line">    date:string,</span><br><span class="line">    startTime:string,</span><br><span class="line">    endTime:string,</span><br><span class="line">    money:string,</span><br><span class="line">    pay:string,</span><br><span class="line">    status:number</span><br><span class="line">&#125;</span><br><span class="line">const date = ref([&quot;&quot;, &quot;&quot;])</span><br><span class="line">const searchParams = ref&lt;SearchType&gt;(&#123;</span><br><span class="line">    orderNo: &quot;&quot;,</span><br><span class="line">    status: 1,</span><br><span class="line">    no: &quot;&quot;,</span><br><span class="line">    startDate: &quot;&quot;,</span><br><span class="line">    endDate: &quot;&quot;, //不能写成date.value[0]</span><br><span class="line">    name: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const &#123; dataList, loading,  resetPagination, loadData, totals, pageInfo, handleSizeChange, handleCurrentChange &#125; = useHttp&lt;SelectionListType&gt;(&quot;/orderList&quot;, searchParams);</span><br><span class="line">const handleChange = (val:string[]) =&gt; &#123;</span><br><span class="line">    searchParams.value.startDate = val[0]</span><br><span class="line">    searchParams.value.endDate = val[1]</span><br><span class="line">&#125;</span><br><span class="line">const handleReset = () =&gt; &#123;</span><br><span class="line">    date.value = [&quot;&quot;, &quot;&quot;]</span><br><span class="line">    searchParams.value = &#123;</span><br><span class="line">        orderNo: &quot;&quot;,</span><br><span class="line">        status: 1,</span><br><span class="line">        no: &quot;&quot;,</span><br><span class="line">        startDate: &quot;&quot;,</span><br><span class="line">        endDate: &quot;&quot;,</span><br><span class="line"></span><br><span class="line">        name: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    resetPagination()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const selectionList = ref&lt;SelectionListType[]&gt;([])</span><br><span class="line">const handleSelectionChange = (selection:any) =&gt; &#123;</span><br><span class="line">    selectionList.value = selection</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleBatchDelete = async () =&gt; &#123;</span><br><span class="line">    const res = await batchDeleteApi(selectionList.value.map((item:SelectionListType) =&gt; item.orderNo))</span><br><span class="line">    if (res.code == 200) &#123;</span><br><span class="line">        ElMessage(&#123;</span><br><span class="line">            message: res.data,</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">        &#125;);</span><br><span class="line">        loadData()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-表格添加多选功能"><a href="#5-表格添加多选功能" class="headerlink" title="5.表格添加多选功能"></a>5.表格添加多选功能</h2><p><img src="D:/Software/Typora/images/image-20241028180750829.png" alt="image-20241028180750829"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> selectionList = <span class="title function_">ref</span>([])</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleSelectionChange</span> = (<span class="params">selection</span>) =&gt; &#123;</span><br><span class="line">    selectionList.<span class="property">value</span> = selection</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-设置两个按钮的禁用状态"><a href="#6-设置两个按钮的禁用状态" class="headerlink" title="6.设置两个按钮的禁用状态"></a>6.设置两个按钮的禁用状态</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; :disabled=&quot;!selectionList.length&quot; @click=&quot;handleBatchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; :disabled=&quot;!selectionList.length&quot; :icon=&quot;Download&quot;</span><br><span class="line">            @click=&quot;exportToExcel&quot;&gt;导出订单数据到Excel&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<h2 id="7-批量删除功能"><a href="#7-批量删除功能" class="headerlink" title="7.批量删除功能"></a>7.批量删除功能</h2><p>批量删除接口</p>
<p>&#x3D;&#x3D;mock-index.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//订单管理-批量删除接口</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&#x27;https://www.demo.com/batchDelete&#x27;</span>, <span class="string">&quot;post&quot;</span>, <span class="function">(<span class="params">options: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; order &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(options.<span class="property">body</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(order))</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;成功&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;操作成功&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api-operations.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">  <span class="title class_">BatchDelete</span>=<span class="string">&#x27;/batchDelete&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">batchDeleteApi</span>(<span class="params">order:[]</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">BatchDelete</span>,&#123;order&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> &#123;batchDeleteApi&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; batchDeleteApi &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/operations&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBatchDelete</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">batchDeleteApi</span>(selectionList.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item:SelectionListType</span>) =&gt;</span> item.<span class="property">orderNo</span>))</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">            <span class="attr">message</span>: res.<span class="property">data</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="title function_">loadData</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-订单详情页面"><a href="#8-订单详情页面" class="headerlink" title="8.订单详情页面"></a>8.订单详情页面</h2><p>&#x3D;&#x3D;Detail.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-descriptions :title=&quot;`订单编号:$&#123;$route.query.orderNo&#125;`&quot;&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;订单编号&quot;&gt;&#123;&#123;$route.query.orderNo&#125;&#125;&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;设备编号&quot;&gt;C2274&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;订单日期&quot;&gt;2024-10-01&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;站点名称&quot;&gt;</span><br><span class="line">                &lt;el-tag size=&quot;small&quot;&gt;北京西单充电站&lt;/el-tag&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;开始时间&quot;&gt;</span><br><span class="line">               08:00:23</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;结束时间&quot;&gt;09:10:11&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;订单金额(元)&quot;&gt;66.5&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;支付方式&quot;&gt;支付宝&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;所属城市&quot;&gt;北京&lt;/el-descriptions-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-descriptions-item label=&quot;充电量(度)&quot;&gt;86&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;充电设备&quot;&gt;充电桩(快充)&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;充电总时长(小时)&quot;&gt;2&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;负责人姓名&quot;&gt;王科&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;负责人电话&quot;&gt;18888888888&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;维保人员姓名&quot;&gt;刘来&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;维保人员电话&quot;&gt;17777777777&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;订单状态&quot;&gt;已完成&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;服务费(元)&quot;&gt;8.0&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;停车费(元)&quot;&gt;4.0&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;电费(元)&quot;&gt;54.0&lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;收费信息&quot;&gt;</span><br><span class="line">                电费+服务费+停车费，高峰时段费用位2.3元1度，停车费2元/小时，服务费5元/次</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;备注&quot;&gt;暂无&lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;/el-descriptions&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-跳转至订单详情功能"><a href="#9-跳转至订单详情功能" class="headerlink" title="9.跳转至订单详情功能"></a>9.跳转至订单详情功能</h2><p>&#x3D;&#x3D;Orders.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;handleDetail(scope.row.orderNo)&quot;&gt;</span><br><span class="line">                       详情</span><br><span class="line">                   &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useTabsStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/tabs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter, useRoute &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"><span class="keyword">const</span> tabsStore = <span class="title function_">useTabsStore</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; addTab, setCurrentTab &#125; = tabsStore;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleDetail</span> = (<span class="params">orderNo</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">addTab</span>(<span class="string">&quot;订单详情&quot;</span>, <span class="string">&quot;/operations/detail&quot;</span>, <span class="string">&quot;Share&quot;</span>)</span><br><span class="line">    <span class="title function_">setCurrentTab</span>(<span class="string">&quot;订单详情&quot;</span>, <span class="string">&quot;/operations/detail&quot;</span>,)</span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&quot;/operations/detail?orderNo=&quot;</span> + orderNo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-解决详情页返回缓存问题"><a href="#10-解决详情页返回缓存问题" class="headerlink" title="10.解决详情页返回缓存问题"></a>10.解决详情页返回缓存问题</h2><p>&#x3D;&#x3D;layouts-TabsLayout.vue&#x3D;&#x3D;</p>
<p>添加缓存，取代掉原本的<RouterView/></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- &lt;RouterView /&gt; --&gt;</span><br><span class="line">   &lt;RouterView v-slot=&quot;&#123; Component &#125;&quot;&gt;</span><br><span class="line">       &lt;KeepAlive&gt;</span><br><span class="line">           &lt;component :is=&quot;Component&quot; :key=&quot;$route.name&quot; v-if=&quot;$route.meta.keepAlive&quot; /&gt;</span><br><span class="line">       &lt;/KeepAlive&gt;</span><br><span class="line">       &lt;component :is=&quot;Component&quot; :key=&quot;$route.name&quot; v-if=&quot;!$route.meta.keepAlive&quot; /&gt;</span><br><span class="line">   &lt;/RouterView&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;router-basicRouterMap.ts&#x3D;&#x3D;</p>
<p>给订单页面添加需要缓存标记</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">               <span class="attr">path</span>: <span class="string">&quot;/operations/orders&quot;</span>,</span><br><span class="line">               <span class="attr">name</span>: <span class="string">&quot;orders&quot;</span>,</span><br><span class="line">               <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/operations/Orders.vue&quot;</span>),</span><br><span class="line">               <span class="attr">meta</span>: &#123;</span><br><span class="line">                   <span class="attr">keepAlive</span>: <span class="literal">true</span></span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果从别的页面返回而不是从详情页返回，那么应该重新加载数据</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>()</span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> route.<span class="property">name</span>, <span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(to,<span class="keyword">from</span>)</span><br><span class="line">    <span class="keyword">if</span> (to == <span class="string">&quot;orders&quot;</span> &amp;&amp; <span class="keyword">from</span> != <span class="string">&quot;detail&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">222</span>)</span><br><span class="line">        <span class="title function_">loadData</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="11-导出订单数据到excel"><a href="#11-导出订单数据到excel" class="headerlink" title="11.导出订单数据到excel"></a>11.导出订单数据到excel</h2><p>1.安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install xlsx file-saver</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line">&lt;el-button type=&quot;primary&quot; :disabled=&quot;!selectionList.length&quot; :icon=&quot;Download&quot;</span><br><span class="line">            @click=&quot;exportToExcel&quot;&gt;导出订单数据到Excel&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入所需的库</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">XLSX</span> <span class="keyword">from</span> <span class="string">&#x27;xlsx&#x27;</span>; <span class="comment">// 导入 xlsx 库，用于处理 Excel 文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; saveAs &#125; <span class="keyword">from</span> <span class="string">&#x27;file-saver&#x27;</span>; <span class="comment">// 导入 file-saver 库，用于保存文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义导出到 Excel 的函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">exportToExcel</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 将选择的数据（selectionList.value）转换为工作表格式</span></span><br><span class="line">    <span class="keyword">const</span> ws = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">json_to_sheet</span>(selectionList.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个新的工作簿（Workbook）</span></span><br><span class="line">    <span class="keyword">const</span> wb = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将工作表（ws）追加到工作簿（wb）中，并命名为 &#x27;Sheet1&#x27;</span></span><br><span class="line">    <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_append_sheet</span>(wb, ws, <span class="string">&#x27;Sheet1&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将工作簿（wb）写入输出格式，这里选择了 &#x27;xlsx&#x27; 格式，并以 &#x27;array&#x27; 类型输出</span></span><br><span class="line">    <span class="keyword">const</span> wbout = <span class="variable constant_">XLSX</span>.<span class="title function_">write</span>(wb, &#123; <span class="attr">bookType</span>: <span class="string">&#x27;xlsx&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;array&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个新的 Blob 对象，并将输出数据放入其中，设置 MIME 类型为 &#x27;application/octet-stream&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([wbout], &#123; <span class="attr">type</span>: <span class="string">&#x27;application/octet-stream&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 file-saver 库的 saveAs 函数，导出并下载 Excel 文件，指定文件名为 &#x27;导出数据.xlsx&#x27;</span></span><br><span class="line">    <span class="title function_">saveAs</span>(blob, <span class="string">&#x27;导出数据.xlsx&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="22-计费管理页面开发"><a href="#22-计费管理页面开发" class="headerlink" title="22.计费管理页面开发"></a>22.计费管理页面开发</h1><h2 id="1-基本搜索框开发"><a href="#1-基本搜索框开发" class="headerlink" title="1.基本搜索框开发"></a>1.基本搜索框开发</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">        &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line">                &lt;el-input style=&quot;width:80%&quot; placeholder=&quot;请输入关键词&quot; v-model=&quot;filterText&quot;&gt;</span><br><span class="line">                    &lt;template #append&gt;</span><br><span class="line">                        &lt;el-button icon=&quot;Search&quot; /&gt;</span><br><span class="line">                    &lt;/template&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span=&quot;18&quot;&gt;&lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line">const filterText = ref(&#x27;&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-设置接口数据"><a href="#2-设置接口数据" class="headerlink" title="2.设置接口数据"></a>2.设置接口数据</h2><p>mock接口：见源文件</p>
<blockquote>
<p>api</p>
</blockquote>
<p>&#x3D;&#x3D;api-operation.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post,get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    <span class="title class_">CityList</span>=<span class="string">&#x27;/cityList&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">cityListApi</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">CityList</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> &#123;listApi,batchDeleteApi,cityListApi&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;views-operation-Total.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">        &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line">                &lt;el-input style=&quot;width:80%&quot; placeholder=&quot;请输入关键词&quot; v-model=&quot;filterText&quot;&gt;</span><br><span class="line">                    &lt;template #append&gt;</span><br><span class="line">                        &lt;el-button icon=&quot;Search&quot; /&gt;</span><br><span class="line">                    &lt;/template&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">                &lt;el-tree style=&quot;max-width: 600px&quot; :data=&quot;treeData&quot; :props=&quot;defaultProps&quot;</span><br><span class="line">                    show-checkbox ref=&quot;treeRef&quot; class=&quot;mt&quot; /&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span=&quot;18&quot;&gt;&lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;ref,onMounted&#125; from &quot;vue&quot;</span><br><span class="line">import &#123; cityListApi &#125; from &#x27;@/api/operations&#x27;;</span><br><span class="line">interface Tree &#123;</span><br><span class="line">    label: string</span><br><span class="line">    children?: Tree[]</span><br><span class="line">&#125;</span><br><span class="line">const defaultProps = &#123;</span><br><span class="line">    children: &#x27;children&#x27;,</span><br><span class="line">    label: &#x27;label&#x27;,</span><br><span class="line">&#125;</span><br><span class="line">const filterText = ref(&#x27;&#x27;)</span><br><span class="line">const treeData = ref&lt;Tree[]&gt;([])</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await cityListApi()</span><br><span class="line">    treeData.value = data</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-tree组件过滤功能"><a href="#3-tree组件过滤功能" class="headerlink" title="3.tree组件过滤功能"></a>3.tree组件过滤功能</h2><blockquote>
<p><code>InstanceType</code> 是 TypeScript 的一个内置类型，它用来获取构造函数类型的实例类型。在你的代码 <code>const treeRef = ref&lt;InstanceType&lt;typeof ElTree&gt;&gt;()</code> 中，<code>ElTree</code> 是一个 Vue 组件（通常是一个类或函数），<code>typeof ElTree</code> 表达式返回这个组件的类型。</p>
</blockquote>
<p><img src="D:/Software/Typora/images/image-20241029194335424.png" alt="image-20241029194335424"></p>
<p><img src="D:/Software/Typora/images/image-20241029194356193.png" alt="image-20241029194356193"></p>
<p>data表示的是每一条数据，返回false则节点会隐藏</p>
<h2 id="4-计费模板开发"><a href="#4-计费模板开发" class="headerlink" title="4.计费模板开发"></a>4.计费模板开发</h2><blockquote>
<p>基础结构</p>
</blockquote>
<blockquote>
<p>关于:prop&#x3D;”‘date.’ + index + ‘.date1’” 拼接问题</p>
</blockquote>
<p><code>&#39;date.&#39; + index + &#39;.date1&#39;</code> 的作用是动态生成表单项的 <code>prop</code> 属性，以便与 Element Plus 的表单校验机制相连。下面是详细解释：</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ol>
<li>**动态生成 <code>prop</code>**：<code>prop</code> 属性用于链接表单项和其在 <code>ruleForm</code> 对象中的字段。通过拼接字符串，可以为每个动态生成的时间区间创建一个唯一的标识。例如：<ul>
<li>当 <code>index</code> 是 0 时，<code>prop</code> 变为 <code>&#39;date.0.date1&#39;</code>，指向 <code>ruleForm.date[0].date1</code>。</li>
<li>当 <code>index</code> 是 1 时，<code>prop</code> 变为 <code>&#39;date.1.date1&#39;</code>，指向 <code>ruleForm.date[1].date1</code>。</li>
</ul>
</li>
<li><strong>与校验规则关联</strong>：Element Plus 会使用这个 <code>prop</code> 来查找对应的字段，并基于 <code>rules</code> 中的定义来进行校验。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line">                &lt;template #header&gt;</span><br><span class="line">                    &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                        &lt;span&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">                &lt;el-form ref=&quot;ruleFormRef&quot; :model=&quot;ruleForm&quot; :rules=&quot;rules&quot; label-width=&quot;auto&quot; class=&quot;demo-ruleForm&quot;</span><br><span class="line">                    status-icon&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;模版名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.name&quot; style=&quot;max-width: 200px&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;div v-for=&quot;(timeSlot, index) in ruleForm.date&quot; :key=&quot;index&quot;&gt;</span><br><span class="line">                        &lt;el-form-item :label=&quot;&#x27;时间区间&#x27; + (index + 1) + &#x27;:&#x27;&quot; required&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">                                &lt;el-form-item :prop=&quot;&#x27;date.&#x27; + index + &#x27;.date1&#x27;&quot;&gt;</span><br><span class="line">                                    &lt;el-time-picker v-model=&quot;timeSlot.date1&quot; type=&quot;date&quot; aria-label=&quot;开始时间&quot;</span><br><span class="line">                                        placeholder=&quot;开始时间&quot; style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col class=&quot;text-center&quot; :span=&quot;1&quot;&gt;</span><br><span class="line">                                &lt;span class=&quot;text-gray-500&quot;&gt;-&lt;/span&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">                                &lt;el-form-item :prop=&quot;&#x27;date.&#x27; + index + &#x27;.date2&#x27;&quot;&gt;</span><br><span class="line">                                    &lt;el-time-picker v-model=&quot;timeSlot.date2&quot; aria-label=&quot;结束时间&quot; placeholder=&quot;结束时间&quot;</span><br><span class="line">                                        style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                                &lt;el-form-item label=&quot;电费：&quot; :prop=&quot;&#x27;electricity.&#x27; + index&quot;&gt;</span><br><span class="line">                                    &lt;el-input v-model=&quot;timeSlot.electricity&quot; style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                        &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;el-button type=&quot;primary&quot; class=&quot;mb&quot; @click=&quot;addTimeSlot&quot;&gt;添加时间区间&lt;/el-button&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;服务费&quot; prop=&quot;service&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.service&quot; style=&quot;max-width: 200px&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;停车费&quot; prop=&quot;parking&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.parking&quot; style=&quot;max-width: 200px&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;特殊备注&quot; prop=&quot;remarks&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;ruleForm.remarks&quot; type=&quot;textarea&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item&gt;</span><br><span class="line">                        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(ruleFormRef)&quot;&gt;</span><br><span class="line">                            创建</span><br><span class="line">                        &lt;/el-button&gt;</span><br><span class="line">                        &lt;el-button @click=&quot;resetForm&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;ref,onMounted,watch,reactive&#125; from &quot;vue&quot;</span><br><span class="line">import &#123; cityListApi &#125; from &#x27;@/api/operations&#x27;;</span><br><span class="line">import &#123; ElTree &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import type &#123; FormInstance, FormRules &#125; from &#x27;element-plus&#x27;</span><br><span class="line">/*计费模板开发*/</span><br><span class="line">const title=ref(&quot;计费模板&quot;)</span><br><span class="line">interface RuleForm &#123;</span><br><span class="line">    date:  Array&lt;&#123; date1: string; date2: string; electricity: string &#125;&gt;,</span><br><span class="line">    name: string,</span><br><span class="line">    service: string,</span><br><span class="line">    parking: string,</span><br><span class="line">    remarks: string</span><br><span class="line">&#125;</span><br><span class="line">const ruleFormRef = ref&lt;FormInstance&gt;()</span><br><span class="line">const ruleForm = ref&lt;RuleForm&gt;(&#123;</span><br><span class="line">    date: [&#123; date1: &#x27;&#x27;, date2: &#x27;&#x27;, electricity: &#x27;&#x27; &#125;],</span><br><span class="line">    name: &#x27;&#x27;,</span><br><span class="line">    service: &quot;&quot;,</span><br><span class="line">    parking: &quot;&quot;,</span><br><span class="line">    remarks: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const rules = reactive&lt;FormRules&lt;RuleForm&gt;&gt;(&#123;</span><br><span class="line">    name: [</span><br><span class="line">        &#123; required: true, message: &#x27;请输入模板名称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    service:[</span><br><span class="line">        &#123; required: true, message: &#x27;请输入服务费&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    parking:[</span><br><span class="line">        &#123; required: true, message: &#x27;请输入停车费&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    remarks:[</span><br><span class="line">        &#123; required: true, message: &#x27;请输入备注&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const addTimeSlot = () =&gt; &#123;</span><br><span class="line">    ruleForm.value.date.push(&#123; date1: &#x27;&#x27;, date2: &#x27;&#x27;, electricity: &#x27;&#x27; &#125;)</span><br><span class="line">&#125;</span><br><span class="line">const submitForm = async (formEl: FormInstance | undefined) =&gt; &#123;</span><br><span class="line">    if (!formEl) return</span><br><span class="line">    await formEl.validate((valid, fields) =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">            console.log(8787, ruleForm)</span><br><span class="line">            console.log(&#x27;submit!&#x27;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(&#x27;error submit!&#x27;, fields)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const resetForm = () =&gt; &#123;</span><br><span class="line">    ruleForm.value = &#123;</span><br><span class="line">        date: [&#123; date1: &#x27;&#x27;, date2: &#x27;&#x27;, electricity: &#x27;&#x27; &#125;],</span><br><span class="line">        name: &#x27;Hello&#x27;,</span><br><span class="line">        service: &quot;&quot;,</span><br><span class="line">        parking: &quot;&quot;,</span><br><span class="line">        remarks: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="5-实现动态规则验证"><a href="#5-实现动态规则验证" class="headerlink" title="5.实现动态规则验证"></a>5.实现动态规则验证</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div v-for=&quot;(timeSlot, index) in ruleForm.date&quot; :key=&quot;index&quot;&gt;</span><br><span class="line">                        &lt;el-form-item :label=&quot;&#x27;时间区间&#x27; + (index + 1) + &#x27;:&#x27;&quot; required&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">                                &lt;el-form-item :prop=&quot;&#x27;date.&#x27; + index + &#x27;.date1&#x27;&quot; :rules=&quot;&#123;required: true,message: &#x27;时间不能为空&#x27;,trigger: &#x27;blur&#x27;&#125;&quot;&gt;</span><br><span class="line">                                    &lt;el-time-picker v-model=&quot;timeSlot.date1&quot; type=&quot;date&quot; aria-label=&quot;开始时间&quot;</span><br><span class="line">                                        placeholder=&quot;开始时间&quot; style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col class=&quot;text-center&quot; :span=&quot;1&quot;&gt;</span><br><span class="line">                                &lt;span class=&quot;text-gray-500&quot;&gt;-&lt;/span&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">                                &lt;el-form-item :prop=&quot;&#x27;date.&#x27; + index + &#x27;.date2&#x27;&quot; :rules=&quot;&#123;required: true,message: &#x27;时间不能为空&#x27;,trigger: &#x27;blur&#x27;&#125;&quot;&gt;</span><br><span class="line">                                    &lt;el-time-picker v-model=&quot;timeSlot.date2&quot; aria-label=&quot;结束时间&quot; placeholder=&quot;结束时间&quot;</span><br><span class="line">                                        style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                                &lt;el-form-item label=&quot;电费：&quot; :prop=&quot;&#x27;electricity.&#x27; + index&quot; :rules=&quot;&#123;required: true,message: &#x27;时间不能为空&#x27;,trigger: &#x27;blur&#x27;&#125;&quot;&gt;</span><br><span class="line">                                    &lt;el-input v-model=&quot;timeSlot.electricity&quot; style=&quot;width: 100%&quot; /&gt;</span><br><span class="line">                                &lt;/el-form-item&gt;</span><br><span class="line">                            &lt;/el-col&gt;</span><br><span class="line">                        &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-树状图和右边联动"><a href="#6-树状图和右边联动" class="headerlink" title="6.树状图和右边联动"></a>6.树状图和右边联动</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tree style=&quot;max-width: 600px&quot; :data=&quot;treeData&quot; :props=&quot;defaultProps&quot; @node-click=&quot;handleNodeClick&quot;</span><br><span class="line">                   show-checkbox ref=&quot;treeRef&quot; :filter-node-method=&quot;filterNode&quot; class=&quot;mt&quot; /&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleNodeClick</span> = (<span class="params">data: Tree</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!data.<span class="property">children</span>)&#123;</span><br><span class="line">        title.<span class="property">value</span>=data.<span class="property">label</span></span><br><span class="line">        <span class="title function_">resetForm</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="23-报警管理页面开发"><a href="#23-报警管理页面开发" class="headerlink" title="23.报警管理页面开发"></a>23.报警管理页面开发</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">     &lt;el-card&gt;</span><br><span class="line">        &lt;el-radio-group v-model=&quot;radio1&quot; size=&quot;large&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;严重告警&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;紧急告警&quot; :value=&quot;2&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;重要告警&quot; :value=&quot;3&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;一般告警&quot; :value=&quot;4&quot; /&gt;</span><br><span class="line">        &lt;/el-radio-group&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref&#125; from &#x27;vue&#x27;</span><br><span class="line">const radio1 = ref&lt;number&gt;(1)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-接口开发"><a href="#1-接口开发" class="headerlink" title="1.接口开发"></a>1.接口开发</h2><p>&#x3D;&#x3D;api-alarm.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    alarmList=<span class="string">&quot;/alarmList&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">alarmListApi</span>(<span class="params"></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">alarmList</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span>&#123; alarmListApi &#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;views-alarm-Alarm.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">     &lt;el-card&gt;</span><br><span class="line">        &lt;el-radio-group v-model=&quot;radio1&quot; size=&quot;large&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;严重告警&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;紧急告警&quot; :value=&quot;2&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;重要告警&quot; :value=&quot;3&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;一般告警&quot; :value=&quot;4&quot; /&gt;</span><br><span class="line">        &lt;/el-radio-group&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot; v-for=&quot;item in alarmList&quot; :key=&quot;item.equNo&quot;&gt;</span><br><span class="line">        &lt;el-alert :title=&quot;`$&#123;item.address&#125;充电站充电异常！`&quot; type=&quot;warning&quot; show-icon class=&quot;mb&quot;&gt;</span><br><span class="line">        &lt;/el-alert&gt;</span><br><span class="line">        &lt;el-descriptions direction=&quot;vertical&quot; :column=&quot;4&quot; border&gt;</span><br><span class="line">            &lt;el-descriptions-item v-for=&quot;(val, key) in item&quot; :label=&quot;getLabel(key)&quot;&gt;</span><br><span class="line">                &lt;el-tag :type=&quot;val == 1 ? &#x27;danger&#x27; : (val == 2 ? &#x27;warning&#x27; : &#x27;info&#x27;)&quot; v-if=&quot;key == &#x27;level&#x27;&quot;&gt;</span><br><span class="line">                    &#123;&#123; val == 1 ? &#x27;严重&#x27; : (val == 2 ? &#x27;紧急&#x27; : &#x27;一般&#x27;) &#125;&#125;</span><br><span class="line">                &lt;/el-tag&gt;</span><br><span class="line">                &lt;el-link type=&quot;danger&quot; v-else-if=&quot;key == &#x27;status&#x27;&quot;&gt;</span><br><span class="line">                    &#123;&#123; val == 1 ? &quot;待指派&quot; : &quot;处理中&quot; &#125;&#125;</span><br><span class="line">                &lt;/el-link&gt;</span><br><span class="line">                &lt;span v-else&gt;</span><br><span class="line">                    &#123;&#123; val &#125;&#125;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-if=&quot;item.status == 1&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;handleOpen&quot;&gt;指派&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-else-if=&quot;item.status == 2&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;warning&quot; @click=&quot;handleOpen&quot;&gt;催办&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-else&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;handleOpen&quot;&gt;查看&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;/el-descriptions&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref,onMounted&#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; alarmListApi &#125; from &#x27;@/api/alarm&#x27;;</span><br><span class="line">import &#123; getLabel &#125; from &#x27;./fieldLabelMap&#x27;;</span><br><span class="line">interface AlarmListType&#123;</span><br><span class="line">    description: string,</span><br><span class="line">    address: string,</span><br><span class="line">    equNo: string,</span><br><span class="line">    level: number,</span><br><span class="line">    time: string,</span><br><span class="line">    code: number,</span><br><span class="line">    status: number,</span><br><span class="line">&#125;</span><br><span class="line">const alarmList = ref&lt;AlarmListType[]&gt;([]);</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await alarmListApi();</span><br><span class="line">    alarmList.value = data</span><br><span class="line">&#125;)</span><br><span class="line">const radio1 = ref&lt;number&gt;(1)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>因为后端返回的字段都是英文名称，但是显示要显示为对应的中文，所以创建映射表</p>
<p>&#x3D;&#x3D;views-alarm-fieldLabelMap.ts&#x3D;&#x3D;</p>
<blockquote>
<p><strong>Tips:</strong></p>
<p><code>Record&lt;string, string&gt;</code> 是一个工具类型，用于定义一个对象类型，其中的键是字符串，值也是字符串</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">fieldLabelMap</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; = &#123;</span><br><span class="line">    <span class="attr">description</span>: <span class="string">&#x27;故障描述&#x27;</span>,</span><br><span class="line">    <span class="attr">address</span>: <span class="string">&#x27;设备地址&#x27;</span>,</span><br><span class="line">    <span class="attr">equNo</span>: <span class="string">&#x27;设备号&#x27;</span>,</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&#x27;当前状态&#x27;</span>,</span><br><span class="line">    <span class="attr">time</span>: <span class="string">&#x27;故障时间&#x27;</span>,</span><br><span class="line">    <span class="attr">level</span>: <span class="string">&#x27;告警级别&#x27;</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;故障代码&#x27;</span>,</span><br><span class="line">    <span class="comment">// 其他字段映射</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> getLabel = (<span class="attr">key</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fieldLabelMap[key] || key; <span class="comment">// 返回映射的中文标签或默认字段名</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">export</span> &#123;getLabel&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-二次封装elementplus组件，实现分部组件"><a href="#2-二次封装elementplus组件，实现分部组件" class="headerlink" title="2.二次封装elementplus组件，实现分部组件"></a>2.二次封装elementplus组件，实现分部组件</h2><blockquote>
<p>核心逻辑</p>
</blockquote>
<p>1.通过插槽让用户传入若干form,至少两个，至多三个</p>
<p>2.点击下一步需要校验表单，需要通过父组件传入表单实例，调用表单validate方法进行校验，</p>
<p>3.提交数据，需要子组件触发父组件的函数，调用提交表单数据方法，通过emit实现</p>
<p>&#x3D;&#x3D;components-StepForm.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div style=&quot;max-width: 600px;&quot;&gt;</span><br><span class="line">        &lt;el-steps :active=&quot;currentStep&quot; align-center finish-status=&quot;success&quot;&gt;</span><br><span class="line">            &lt;el-step v-for=&quot;(step, index) in steps&quot; :key=&quot;index&quot; :title=&quot;step.title&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;/el-steps&gt;</span><br><span class="line">        &lt;div v-if=&quot;currentStep === 0&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;slot name=&quot;step-1&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div v-if=&quot;currentStep === 1&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;slot name=&quot;step-2&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div v-if=&quot;currentStep === 2&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;slot name=&quot;step-3&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;step-buttons&quot;&gt;</span><br><span class="line">            &lt;el-button @click=&quot;prevStep&quot; v-if=&quot;currentStep &gt; 0&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; @click=&quot;nextStep&quot;&gt;</span><br><span class="line">                &#123;&#123; currentStep === steps.length - 1 ? &#x27;提交&#x27; : &#x27;下一步&#x27; &#125;&#125;</span><br><span class="line">            &lt;/el-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">const props = defineProps([&quot;steps&quot;, &quot;form1&quot;, &quot;form2&quot;, &quot;form3&quot;])</span><br><span class="line">const emit = defineEmits([&quot;handleSubmit&quot;])</span><br><span class="line">const currentStep = ref(0);</span><br><span class="line">const nextStep = async () =&gt; &#123;</span><br><span class="line">    if (currentStep.value == 0) &#123;</span><br><span class="line">        props.form1.validate((valid: boolean) =&gt; &#123;</span><br><span class="line">            if (valid) &#123;</span><br><span class="line">                if (currentStep.value &lt; props.steps.length - 1) &#123;</span><br><span class="line">                    currentStep.value++;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 提交逻辑</span><br><span class="line">                   emit(&quot;handleSubmit&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; else if (currentStep.value == 1) &#123;</span><br><span class="line">        props.form2?.validate((valid: boolean) =&gt; &#123;</span><br><span class="line">            if (valid) &#123;</span><br><span class="line">                if (currentStep.value &lt; props.steps.length - 1) &#123;</span><br><span class="line">                    currentStep.value++;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 提交逻辑</span><br><span class="line">                    emit(&quot;handleSubmit&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (props.form3) &#123;</span><br><span class="line">            props.form3.validate((valid: boolean) =&gt; &#123;</span><br><span class="line">                if (valid) &#123;</span><br><span class="line">                    if (currentStep.value &lt; props.steps.length - 1) &#123;</span><br><span class="line">                        currentStep.value++;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // 提交逻辑</span><br><span class="line">                        emit(&quot;handleSubmit&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            emit(&quot;handleSubmit&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">const prevStep = () =&gt; &#123;</span><br><span class="line">    if (currentStep.value &gt; 0) &#123;</span><br><span class="line">        currentStep.value--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.step-buttons &#123;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;views-alarm-Alarm.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;el-radio-group v-model=&quot;radio1&quot; size=&quot;large&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;严重告警&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;紧急告警&quot; :value=&quot;2&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;重要告警&quot; :value=&quot;3&quot; /&gt;</span><br><span class="line">            &lt;el-radio-button label=&quot;一般告警&quot; :value=&quot;4&quot; /&gt;</span><br><span class="line">        &lt;/el-radio-group&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot; v-for=&quot;item in alarmList&quot; :key=&quot;item.equNo&quot;&gt;</span><br><span class="line">        &lt;el-alert :title=&quot;`$&#123;item.address&#125;充电站充电异常！`&quot; type=&quot;warning&quot; show-icon class=&quot;mb&quot;&gt;</span><br><span class="line">        &lt;/el-alert&gt;</span><br><span class="line">        &lt;el-descriptions direction=&quot;vertical&quot; :column=&quot;4&quot; border&gt;</span><br><span class="line">            &lt;el-descriptions-item v-for=&quot;(val, key) in item&quot; :label=&quot;getLabel(key)&quot;&gt;</span><br><span class="line">                &lt;el-tag :type=&quot;val == 1 ? &#x27;danger&#x27; : (val == 2 ? &#x27;warning&#x27; : &#x27;info&#x27;)&quot; v-if=&quot;key == &#x27;level&#x27;&quot;&gt;</span><br><span class="line">                    &#123;&#123; val == 1 ? &#x27;严重&#x27; : (val == 2 ? &#x27;紧急&#x27; : &#x27;一般&#x27;) &#125;&#125;</span><br><span class="line">                &lt;/el-tag&gt;</span><br><span class="line">                &lt;el-link type=&quot;danger&quot; v-else-if=&quot;key == &#x27;status&#x27;&quot;&gt;</span><br><span class="line">                    &#123;&#123; val == 1 ? &quot;待指派&quot; : &quot;处理中&quot; &#125;&#125;</span><br><span class="line">                &lt;/el-link&gt;</span><br><span class="line">                &lt;span v-else&gt;</span><br><span class="line">                    &#123;&#123; val &#125;&#125;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-if=&quot;item.status == 1&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;drawer = true&quot;&gt;指派&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-else-if=&quot;item.status == 2&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;warning&quot; @click=&quot;drawer = true&quot;&gt;催办&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">            &lt;el-descriptions-item label=&quot;操作&quot; v-else&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;drawer = true&quot;&gt;查看&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;/el-descriptions&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-drawer v-model=&quot;drawer&quot; title=&quot;报警任务指派&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;StepForm :steps=&quot;steps&quot; :form1=&quot;form1&quot; :form2=&quot;form2&quot; :form3=&quot;form3&quot; @handle-submit=&quot;handleSubmit&quot;&gt;</span><br><span class="line">            &lt;template #step-1&gt;</span><br><span class="line">                &lt;el-form :model=&quot;formData.basicInfo&quot; :rules=&quot;basicInfoRules&quot; ref=&quot;form1&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;姓名&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.basicInfo.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;电话&quot; prop=&quot;tel&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.basicInfo.tel&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.basicInfo.email&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;工号&quot; prop=&quot;no&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.basicInfo.no&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;是否加急：&quot;&gt;</span><br><span class="line">                        &lt;el-switch v-model=&quot;formData.basicInfo.urgent&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;其他选项：&quot;&gt;</span><br><span class="line">                        &lt;el-checkbox-group v-model=&quot;formData.basicInfo.other&quot;&gt;</span><br><span class="line">                            &lt;el-checkbox value=&quot;换设备&quot; name=&quot;equ&quot;&gt;</span><br><span class="line">                                更换设备</span><br><span class="line">                            &lt;/el-checkbox&gt;</span><br><span class="line">                            &lt;el-checkbox value=&quot;仅维修&quot; name=&quot;repiar&quot;&gt;</span><br><span class="line">                                仅维修</span><br><span class="line">                            &lt;/el-checkbox&gt;</span><br><span class="line">                            &lt;el-checkbox value=&quot;需拍照片&quot; name=&quot;photo&quot;&gt;</span><br><span class="line">                                需拍照片</span><br><span class="line">                            &lt;/el-checkbox&gt;</span><br><span class="line">                            &lt;el-checkbox value=&quot;Simple brand exposure&quot; name=&quot;doc&quot;&gt;</span><br><span class="line">                                需报备</span><br><span class="line">                            &lt;/el-checkbox&gt;</span><br><span class="line">                        &lt;/el-checkbox-group&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;其他备注信息&quot;&gt;</span><br><span class="line">                        &lt;el-input type=&quot;textarea&quot; /&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;template #step-2&gt;</span><br><span class="line">                &lt;el-form :model=&quot;formData.shenpi&quot; :rules=&quot;addressRules&quot; ref=&quot;form2&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;审批部门&quot; prop=&quot;a&quot;&gt;</span><br><span class="line">                        &lt;el-select placeholder=&quot;请选择审批部门&quot; v-model=&quot;formData.shenpi.a&quot;&gt;</span><br><span class="line">                            &lt;el-option label=&quot;总裁办&quot; value=&quot;1&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;运营部&quot; value=&quot;2&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;维修部&quot; value=&quot;3&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;市场部&quot; value=&quot;4&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;财务部&quot; value=&quot;5&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                        &lt;/el-select&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;抄送部门&quot; prop=&quot;b&quot; &gt;</span><br><span class="line">                        &lt;el-select placeholder=&quot;请选择抄送部门&quot;  v-model=&quot;formData.shenpi.b&quot;&gt;</span><br><span class="line">                            &lt;el-option label=&quot;总裁办&quot; value=&quot;1&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;运营部&quot; value=&quot;2&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;维修部&quot; value=&quot;3&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;市场部&quot; value=&quot;4&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                            &lt;el-option label=&quot;财务部&quot; value=&quot;5&quot;&gt; &lt;/el-option&gt;</span><br><span class="line">                        &lt;/el-select&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;template #step-3&gt;</span><br><span class="line">                &lt;el-form :model=&quot;formData.address&quot; :rules=&quot;addressRules2&quot; ref=&quot;form3&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;负责人姓名&quot; prop=&quot;person&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.address.person&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;负责人电话&quot; prop=&quot;tel&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;formData.address.tel&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">        &lt;/StepForm&gt;</span><br><span class="line">        &lt;el-result icon=&quot;warning&quot; title=&quot;设备编号：CD1001&quot; sub-title=&quot;该任务已催促2次，请抓紧处理&quot;&gt;</span><br><span class="line">            &lt;template #extra&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot;&gt;我已知晓&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">        &lt;/el-result&gt;</span><br><span class="line">    &lt;/el-drawer&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; alarmListApi &#125; from &#x27;@/api/alarm&#x27;;</span><br><span class="line">import &#123; getLabel &#125; from &#x27;./fieldLabelMap&#x27;;</span><br><span class="line">import StepForm from &quot;@/components/StepForm/StepForm.vue&quot;</span><br><span class="line">import &#123; FormInstance &#125; from &#x27;element-plus&#x27;;</span><br><span class="line">interface AlarmListType &#123;</span><br><span class="line">    description: string,</span><br><span class="line">    address: string,</span><br><span class="line">    equNo: string,</span><br><span class="line">    level: number,</span><br><span class="line">    time: string,</span><br><span class="line">    code: number,</span><br><span class="line">    status: number,</span><br><span class="line">&#125;</span><br><span class="line">const alarmList = ref&lt;AlarmListType[]&gt;([]);</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await alarmListApi();</span><br><span class="line">    alarmList.value = data</span><br><span class="line">&#125;)</span><br><span class="line">const radio1 = ref&lt;number&gt;(1)</span><br><span class="line">const drawer = ref(false);</span><br><span class="line">const form1=ref&lt;FormInstance&gt;()</span><br><span class="line">const form2=ref&lt;FormInstance&gt;()</span><br><span class="line">const form3=ref&lt;FormInstance&gt;()</span><br><span class="line">const steps = [</span><br><span class="line">    &#123; title: &#x27;基本信息&#x27; &#125;,</span><br><span class="line">    &#123; title: &#x27;审批信息&#x27; &#125;,</span><br><span class="line">    &#123; title: &#x27;日期信息&#x27; &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const formData = ref(&#123;</span><br><span class="line">    basicInfo: &#123;</span><br><span class="line">        name: &#x27;&#x27;,</span><br><span class="line">        email: &#x27;&#x27;,</span><br><span class="line">        tel: &#x27;&#x27;,</span><br><span class="line">        no: &#x27;&#x27;,</span><br><span class="line">        other: [],</span><br><span class="line">        urgent: true</span><br><span class="line">    &#125;,</span><br><span class="line">    shenpi: &#123;</span><br><span class="line">        a: &#x27;&#x27;,</span><br><span class="line">        b: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    address:&#123;</span><br><span class="line">        person:&quot;&quot;,</span><br><span class="line">        tel:&quot;&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">const basicInfoRules = &#123;</span><br><span class="line">    name: [&#123; required: true, message: &#x27;请输入姓名&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">    email: [&#123; required: true, message: &#x27;请输入邮箱&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">    no: [&#123; required: true, message: &#x27;请输入工号&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">    tel: [&#123; required: true, message: &#x27;请输入电话&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">&#125;;</span><br><span class="line">const addressRules = &#123;</span><br><span class="line">    a: [&#123; required: true, message: &#x27;不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">    b: [&#123; required: true, message: &#x27;不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;]</span><br><span class="line">&#125;;</span><br><span class="line">const addressRules2 = &#123;</span><br><span class="line">    person: [&#123; required: true, message: &#x27;不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">    tel: [&#123; required: true, message: &#x27;不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const handleSubmit=()=&gt;&#123;</span><br><span class="line">    console.log(formData.value)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>优化写法</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;script lang=<span class="string">&quot;ts&quot;</span> setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">const</span> currentStep = ref&lt;<span class="built_in">number</span>&gt;(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>([<span class="string">&quot;steps&quot;</span>, <span class="string">&quot;form1&quot;</span>, <span class="string">&quot;form2&quot;</span>, <span class="string">&quot;form3&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> forms = [props.<span class="property">form1</span>, props.<span class="property">form2</span>, props.<span class="property">form3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">prevStep</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (currentStep.<span class="property">value</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        currentStep.<span class="property">value</span>--</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">nextStep</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> currentForm = forms[currentStep.<span class="property">value</span>];</span><br><span class="line"></span><br><span class="line">    currentForm.<span class="title function_">validate</span>(<span class="function">(<span class="params">valid: <span class="built_in">boolean</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="keyword">if</span> (currentStep.<span class="property">value</span> &lt; props.<span class="property">steps</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">                currentStep.<span class="property">value</span>++</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;提交表单&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h1 id="24-会员卡管理"><a href="#24-会员卡管理" class="headerlink" title="24.会员卡管理"></a>24.会员卡管理</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card  &gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.no&quot; placeholder=&quot;请输入会员卡号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.tel&quot; placeholder=&quot;请输入手机号&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.name&quot; placeholder=&quot;请输入姓名&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;loadData&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button @click=&quot;handleReset&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot; &gt;</span><br><span class="line">        &lt;el-table :data=&quot;dataList&quot; v-loading=&quot;loading&quot;&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;memberCardNumber&quot; label=&quot;会员卡号&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;cardType&quot; label=&quot;卡类型&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;issueDate&quot; label=&quot;开卡日期&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;holderName&quot; label=&quot;持有人姓名&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;holderPhone&quot; label=&quot;持有人电话&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;cardBalance&quot; label=&quot;卡余额&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;transactionRecords&quot; label=&quot;消费记录&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-popover placement=&quot;top-start&quot; title=&quot;消费记录&quot; :width=&quot;260&quot; trigger=&quot;hover&quot;</span><br><span class="line">                        content=&quot;this is content, this is content, this is content&quot;&gt;</span><br><span class="line">                        &lt;template #reference&gt;</span><br><span class="line">                            &lt;el-button class=&quot;m-2&quot;&gt;&#123;&#123; scope.row.transactionDate &#125;&#125;日消费&lt;/el-button&gt;</span><br><span class="line">                        &lt;/template&gt;</span><br><span class="line">                        &lt;el-timeline style=&quot;max-width: 600px&quot;&gt;</span><br><span class="line">                            &lt;el-timeline-item v-for=&quot;(item, index) in scope.row.transactionRecords&quot; :key=&quot;index&quot; color=&quot;#0bbd87&quot;</span><br><span class="line">                                :timestamp=&quot;item.transactionDate&quot;&gt;</span><br><span class="line">                              &lt;p&gt; 消费金额：&#123;&#123;item.transactionAmount &#125;&#125; &lt;/p&gt;</span><br><span class="line">                              &lt;p&gt;消费类型：&#123;&#123; item.transactionType &#125;&#125;&lt;/p&gt;</span><br><span class="line">                            &lt;/el-timeline-item&gt;</span><br><span class="line">                        &lt;/el-timeline&gt;</span><br><span class="line">                    &lt;/el-popover&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;validUntil&quot; label=&quot;有效期至&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">            :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">            :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useHttp &#125; from &#x27;@/hooks/useHttp&#x27;;</span><br><span class="line"></span><br><span class="line">const searchParams = ref(&#123;</span><br><span class="line">    no: &quot;&quot;,</span><br><span class="line">    tel: &quot;&quot;,</span><br><span class="line">    name: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const &#123; dataList, loading, resetPagination, loadData, totals, pageInfo, handleSizeChange, handleCurrentChange &#125; = useHttp(&quot;/member&quot;, searchParams);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="25-招商管理"><a href="#25-招商管理" class="headerlink" title="25.招商管理"></a>25.招商管理</h1><p>mock接口</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//招商管理分类列表接口</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&#x27;https://www.demo.com/document&#x27;</span>,<span class="string">&quot;get&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>:<span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">      <span class="attr">type</span>:[<span class="string">&quot;招商类&quot;</span>,<span class="string">&quot;广告类&quot;</span>,<span class="string">&quot;公告类&quot;</span>,<span class="string">&quot;提示类&quot;</span>,<span class="string">&quot;日常类&quot;</span>,<span class="string">&quot;告警类&quot;</span>,<span class="string">&quot;其他&quot;</span>],<span class="comment">//文章类型</span></span><br><span class="line">      <span class="attr">important</span>:[<span class="string">&quot;一级&quot;</span>,<span class="string">&quot;二级&quot;</span>,<span class="string">&quot;三级&quot;</span>,<span class="string">&quot;四级&quot;</span>],<span class="comment">//重要程度</span></span><br><span class="line">      <span class="attr">publish</span>:[<span class="string">&quot;站内信&quot;</span>,<span class="string">&quot;公众号&quot;</span>,<span class="string">&quot;小程序&quot;</span>,<span class="string">&quot;H5&quot;</span>,<span class="string">&quot;官网&quot;</span>]<span class="comment">//发布渠道</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>api文件</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span>&#123;</span><br><span class="line">    <span class="title class_">TypeList</span>=<span class="string">&quot;/document&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">typeListApi</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="title class_">Api</span>.<span class="property">TypeList</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span>&#123;typeListApi&#125;</span><br></pre></td></tr></table></figure>



<p>静态结构开发</p>
<p>&#x3D;&#x3D;document.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;文章类型:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag type=&quot;primary&quot; class=&quot;mr&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;info&quot; class=&quot;mr&quot; v-for=&quot;item in typeList.type&quot; :key=&quot;item&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;重要程度:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag type=&quot;primary&quot; class=&quot;mr&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;info&quot; class=&quot;mr&quot; v-for=&quot;item in typeList.important&quot; :key=&quot;item&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;发布渠道:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag type=&quot;primary&quot; class=&quot;mr&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;info&quot; class=&quot;mr&quot; v-for=&quot;item in typeList.publish&quot; :key=&quot;item&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;el-divider /&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;已选:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag type=&quot;success&quot; class=&quot;mr&quot; closable&gt;全部&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; typeListApi &#125; from &quot;@/api/document&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; onMounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">interface ListType &#123;</span><br><span class="line">    type: string[],</span><br><span class="line">    important: string[],</span><br><span class="line">    publish: string[]</span><br><span class="line">&#125;</span><br><span class="line">const typeList = ref&lt;ListType&gt;(&#123; type: [], important: [], publish: [] &#125;)</span><br><span class="line"></span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await typeListApi();</span><br><span class="line">    typeList.value = data</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.title &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 80px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-点击高亮功能实现"><a href="#2-点击高亮功能实现" class="headerlink" title="2.点击高亮功能实现"></a>2.点击高亮功能实现</h2><blockquote>
<p><strong>高亮实现思路：</strong></p>
<p>如果只是一个列表，要想实现高亮，我们会设置一个currentIndex值，每次点击的时候更新这个currentIndex值,</p>
<p>然后在元素中只需要判断他们的index和currentIndex相等，那就说明是当前点击的元素，就让他高亮</p>
<p>现在我们有三个类别，所以需要三个currentIndex，所以我们设置一个数组，直接存三个currentIndex</p>
</blockquote>
<blockquote>
<p>点击的时候我们规定两个参数，第一个参数就是index，因为从0开始，但是我们默认要让 全部 这两个字高亮，所以可以设置-1就是全部两个字高亮，</p>
<p>第二个参数是类别号，第一个类别就是0，第二个类别就是1，使用0 1 2当类别标记的好处是我们可以直接用他当作角标，能够在currentIndex数组中修改</p>
<p>对应的标记</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;文章类型:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[0]==-1?&#x27;primary&#x27;:&#x27;info&#x27;&quot;  class=&quot;mr&quot; @click=&quot;handleSelect(-1,0)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[0]==index?&#x27;primary&#x27;:&#x27;info&#x27;&quot; class=&quot;mr&quot; v-for=&quot;(item,index) in typeList.type&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index,0)&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;重要程度:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[1]==-1?&#x27;primary&#x27;:&#x27;info&#x27;&quot;  class=&quot;mr&quot; @click=&quot;handleSelect(-1,1)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[1]==index?&#x27;primary&#x27;:&#x27;info&#x27;&quot; class=&quot;mr&quot; v-for=&quot;(item,index) in typeList.important&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index,1)&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;发布渠道:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[2]==-1?&#x27;primary&#x27;:&#x27;info&#x27;&quot;  class=&quot;mr&quot; @click=&quot;handleSelect(-1,2)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[2]==index?&#x27;primary&#x27;:&#x27;info&#x27;&quot; class=&quot;mr&quot; v-for=&quot;(item,index) in typeList.publish&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index,2)&quot;&gt;&#123;&#123; item &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;el-divider /&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;已选:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag type=&quot;success&quot; class=&quot;mr&quot; closable&gt;全部&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; typeListApi &#125; from &quot;@/api/document&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; onMounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">interface ListType &#123;</span><br><span class="line">    type: string[],</span><br><span class="line">    important: string[],</span><br><span class="line">    publish: string[]</span><br><span class="line">&#125;</span><br><span class="line">const typeList = ref&lt;ListType&gt;(&#123; type: [], important: [], publish: [] &#125;)</span><br><span class="line"></span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await typeListApi();</span><br><span class="line">    typeList.value = data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const currentIndex=ref([-1,-1,-1])</span><br><span class="line"></span><br><span class="line">const handleSelect=(index:number,num:number)=&gt;&#123;</span><br><span class="line">    console.log(index)</span><br><span class="line">    currentIndex.value[num]=index</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.title &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 80px;</span><br><span class="line">&#125;</span><br><span class="line">.el-tag&#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-完整功能实现"><a href="#3-完整功能实现" class="headerlink" title="3.完整功能实现"></a>3.完整功能实现</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;文章类型:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[0] == -1 ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                @click=&quot;handleSelect(-1, 0, &#x27;&#x27;)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[0] == index ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                v-for=&quot;(item, index) in typeList.type&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index, 0, item)&quot;&gt;&#123;&#123; item</span><br><span class="line">                &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;重要程度:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[1] == -1 ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                @click=&quot;handleSelect(-1, 1, &#x27;&#x27;)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[1] == index ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                v-for=&quot;(item, index) in typeList.important&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index, 1, item)&quot;&gt;&#123;&#123; item</span><br><span class="line">                &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;发布渠道:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[2] == -1 ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                @click=&quot;handleSelect(-1, 2, &#x27;&#x27;)&quot;&gt;全部&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag :type=&quot;currentIndex[2] == index ? &#x27;primary&#x27; : &#x27;info&#x27;&quot; class=&quot;mr&quot;</span><br><span class="line">                v-for=&quot;(item, index) in typeList.publish&quot; :key=&quot;item&quot; @click=&quot;handleSelect(index, 2, item)&quot;&gt;&#123;&#123; item</span><br><span class="line">                &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;el-divider /&gt;</span><br><span class="line">        &lt;div class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;title&quot;&gt;已选:&lt;/span&gt;</span><br><span class="line">            &lt;el-tag </span><br><span class="line">                disable-transitions </span><br><span class="line">                type=&quot;success&quot; </span><br><span class="line">                class=&quot;mr&quot;</span><br><span class="line">                 v-for=&quot;item in selectedList&quot; </span><br><span class="line">                 :key=&quot;item.name&quot;</span><br><span class="line">                 @close=&quot;handleClose(item.num)&quot;</span><br><span class="line">                closable&gt;&#123;&#123; item.name &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; typeListApi &#125; from &quot;@/api/document&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; onMounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">interface ListType &#123;</span><br><span class="line">    type: string[],</span><br><span class="line">    important: string[],</span><br><span class="line">    publish: string[]</span><br><span class="line">&#125;</span><br><span class="line">const typeList = ref&lt;ListType&gt;(&#123; type: [], important: [], publish: [] &#125;)</span><br><span class="line">const selectedList = ref&lt;any&gt;([]);//要求格式为 &#123;num:1,name:&quot;招商类&quot;&#125;</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">    const &#123; data &#125; = await typeListApi();</span><br><span class="line">    typeList.value = data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const currentIndex = ref([-1, -1, -1])</span><br><span class="line">//index表示点击的tag的序号 num表示第几个品类，name表示点击的tag的内容</span><br><span class="line">const handleSelect = (index: number, num: number, name: string) =&gt; &#123;</span><br><span class="line">    // 查找数组中与 newObj.num 相等的对象的索引</span><br><span class="line">    const ind: number = selectedList.value.findIndex((item: any) =&gt; item.num === num);</span><br><span class="line"></span><br><span class="line">    if (!name) &#123;</span><br><span class="line">        //如果点的是全部,删掉对应的那项，也就是筛选出留下 除了点全部那一品类的数据</span><br><span class="line">        selectedList.value = selectedList.value.filter((item: any) =&gt; item.num != num)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (ind == -1) &#123;//找不到相同num的，证明同品类没有，就添加</span><br><span class="line">            selectedList.value.push(&#123; num, name &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            selectedList.value[ind] = &#123; num, name &#125;//否则直接替换</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    currentIndex.value[num] = index;//应该让第几个高亮</span><br><span class="line">&#125;</span><br><span class="line">const handleClose=(num:number)=&gt;&#123;</span><br><span class="line">    selectedList.value = selectedList.value.filter((item: any) =&gt; item.num != num);</span><br><span class="line">    currentIndex.value[num]=-1 //让对应的品类回到全部 高亮</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.title &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 80px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-tag &#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-富文本编辑器"><a href="#4-富文本编辑器" class="headerlink" title="4.富文本编辑器"></a>4.富文本编辑器</h2><p>Vue3中常见的富文本编辑器：</p>
<ul>
<li>TinyMCE </li>
<li>Quill</li>
<li>CKEditor  </li>
<li>wangeditor5</li>
</ul>
<p>TinyMCE的官网</p>
<p><a target="_blank" rel="noopener" href="https://www.tiny.cloud/docs/tinymce/latest/">https://www.tiny.cloud/docs/tinymce/latest/</a></p>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install <span class="literal">--save</span> <span class="string">&quot;@tinymce/tinymce-vue@^5&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-详细配置"><a href="#2-详细配置" class="headerlink" title="2.详细配置"></a>2.详细配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;Editor   ref=&quot;editorRef&quot; v-model=&quot;EditorContent&quot; api-key=&quot;xvbamfm2vokka8qoim9r801qtdlldskjschd51yha7zhuusp&quot; :init=&quot;&#123;language:&#x27;zh_CN&#x27;&#125;&quot; /&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Editor from &#x27;@tinymce/tinymce-vue&#x27;</span><br><span class="line">const editorRef = ref(null); // 定义一个 ref 来引用编辑器实例</span><br><span class="line">const EditorContent = ref(&#x27;&#x27;)</span><br><span class="line">const getEditorContent = () =&gt; &#123;</span><br><span class="line">  console.log(897,EditorContent.value)</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>常见配置项</p>
</blockquote>
<ol>
<li><strong>初始化设置</strong>:<ul>
<li><code>language</code>：设置编辑器的语言，如 <code>zh_CN</code>。</li>
<li><code>height</code>：设置编辑器的高度。</li>
<li><code>width</code>：设置编辑器的宽度。</li>
<li><code>selector</code>：选择要初始化的编辑器元素。</li>
</ul>
</li>
<li><strong>工具栏配置</strong>:<ul>
<li><code>toolbar</code>：定义显示在工具栏上的按钮，如 <code>undo redo | styleselect | bold italic | link image</code>。</li>
</ul>
</li>
<li><strong>菜单配置</strong>:<ul>
<li><code>menubar</code>：控制菜单栏的显示，值可以是 <code>false</code>（不显示）或菜单名称的组合，如 <code>file edit view insert format tools table</code>。</li>
</ul>
</li>
<li><strong>插件配置</strong>:<ul>
<li><code>plugins</code>：启用需要的插件，例如 <code>lists link image code</code>。插件提供额外的功能。</li>
</ul>
</li>
<li><strong>内容样式</strong>:<ul>
<li><code>content_css</code>：指定内容区域的 CSS 文件，可以自定义编辑器内显示的样式。</li>
</ul>
</li>
<li><strong>格式化选项</strong>:<ul>
<li><code>formats</code>：定义自定义格式，例如指定某些 HTML 标签的样式。</li>
</ul>
</li>
<li><strong>事件监听</strong>:<ul>
<li>可以在 <code>init</code> 中添加事件监听，例如 <code>setup</code> 中定义 <code>editor.on(&#39;change&#39;, ...)</code> 来处理内容变化。</li>
</ul>
</li>
<li><strong>图像和文件上传</strong>:<ul>
<li>通过设置 <code>images_upload_url</code> 和相关处理，允许用户上传图像。</li>
</ul>
</li>
<li><strong>自定义键盘快捷键</strong>:<ul>
<li>可以通过 <code>setup</code> 方法自定义键盘快捷键，例如：<code>editor.addShortcut(&#39;Ctrl+Z&#39;, &#39;Undo&#39;, function () &#123; console.log(&#39;Undo action&#39;); &#125;);</code>。</li>
</ul>
</li>
<li><strong>代码视图</strong>:<ul>
<li>可以启用代码编辑功能，设置 <code>code</code> 插件，并添加到工具栏。</li>
</ul>
</li>
</ol>
<p>示例配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Editor</span><br><span class="line">  ref=&quot;editorRef&quot;</span><br><span class="line">  v-model=&quot;EditorContent&quot;</span><br><span class="line">  api-key=&quot;xvbamfm2vokka8qoim9r801qtdlldskjschd51yha7zhuusp&quot;</span><br><span class="line">  :init=&quot;&#123;</span><br><span class="line">    language: &#x27;zh_CN&#x27;,</span><br><span class="line">    height: 500,</span><br><span class="line">    menubar: false,</span><br><span class="line">    toolbar: &#x27;undo redo | styleselect | bold italic | alignleft aligncenter alignright | link image | code&#x27;,</span><br><span class="line">    plugins: &#x27;lists link image code&#x27;,</span><br><span class="line">    content_css: &#x27;/path/to/custom.css&#x27;,</span><br><span class="line">    setup: (editor) =&gt; &#123;</span><br><span class="line">      editor.on(&#x27;change&#x27;, () =&gt; &#123;</span><br><span class="line">        this.EditorContent = editor.getContent();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-导出html功能"><a href="#3-导出html功能" class="headerlink" title="3.导出html功能"></a>3.导出html功能</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; class=&quot;mt&quot; @click=&quot;getEditorContent&quot;&gt;生成word文件&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>Blob 对象是前端 Web API 中的一种数据类型，用于表示二进制数据的大块内容。Blob 代表“Binary Large Object”，它可以存储各种格式的数据，比如图片、音频、视频等。</p>
<p>将用户生成的数据包装成一个 Blob，然后通过创建一个临时的链接并触发下载操作，让用户可以下载该数据为一个文件</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getEditorContent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"> <span class="comment">// 获取编辑器内容</span></span><br><span class="line">      <span class="comment">// 创建一个 Blob 对象</span></span><br><span class="line">      <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="title class_">EditorContent</span>.<span class="property">value</span>], &#123; <span class="attr">type</span>: <span class="string">&#x27;text/html&#x27;</span> &#125;);</span><br><span class="line">      <span class="comment">// 创建一个链接元素</span></span><br><span class="line">      <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      <span class="comment">// 将 Blob 对象的 URL 设置为链接地址</span></span><br><span class="line">      link.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">      <span class="comment">// 设置下载文件的名称</span></span><br><span class="line">      link.<span class="property">download</span> = <span class="string">&#x27;document.html&#x27;</span>;</span><br><span class="line">      <span class="comment">// 触发点击事件以下载文件</span></span><br><span class="line">      link.<span class="title function_">click</span>();</span><br><span class="line">      <span class="comment">// 释放 URL 对象</span></span><br><span class="line">      <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(link.<span class="property">href</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h1 id="26-系统设置页面"><a href="#26-系统设置页面" class="headerlink" title="26.系统设置页面"></a>26.系统设置页面</h1><p>基本结构开发</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;searchParams.name&quot; placeholder=&quot;请输入姓名&quot;&gt;</span><br><span class="line">                &lt;/el-input&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-select placeholder=&quot;请选择部门&quot; v-model=&quot;searchParams.department&quot;&gt;</span><br><span class="line">                    &lt;el-option label=&quot;全部&quot; value=&quot;&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;总裁办&quot; value=&quot;总裁办&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;技术部&quot; value=&quot;技术部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;市场部&quot; value=&quot;市场部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;维修部&quot; value=&quot;维修部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;运营部&quot; value=&quot;运营部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                    &lt;el-option label=&quot;客服部&quot; value=&quot;客服部&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;loadData&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button&gt;重置&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">        &lt;el-table :data=&quot;dataList&quot; v-loading=&quot;loading&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">            &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;account&quot; label=&quot;账号&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;name&quot; label=&quot;姓名&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;phone&quot; label=&quot;电话&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;idNo&quot; label=&quot;身份证号&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;position&quot; label=&quot;职位&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag&gt;&#123;&#123; scope.row.position &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;department&quot; label=&quot;部门&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;pageAuthority&quot; label=&quot;页面权限&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;success&quot;&gt;&#123;&#123; scope.row.pageAuthority &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column prop=&quot;btnAuthority&quot; label=&quot;按钮权限&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-tag type=&quot;info&quot;&gt;&#123;&#123; scope.row.btnAuthority &#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;opera&quot; label=&quot;操作&quot; width=&quot;280&quot;&gt;</span><br><span class="line">                &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; &gt;</span><br><span class="line">                        权限设置</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button type=&quot;danger&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        删除</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button type=&quot;danger&quot; size=&quot;small&quot;&gt;</span><br><span class="line">                        禁用</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">&lt;el-pagination class=&quot;fr mt mb&quot; v-model:current-page=&quot;pageInfo.page&quot; v-model:page-size=&quot;pageInfo.pageSize&quot;</span><br><span class="line">        :page-sizes=&quot;[10, 20, 30, 40]&quot; :background=&quot;true&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        :total=&quot;totals&quot; @size-change=&quot;handleSizeChange&quot; @current-change=&quot;handleCurrentChange&quot; /&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useHttp &#125; from &#x27;@/hooks/useHttp&#x27;;</span><br><span class="line">const searchParams = ref(&#123;</span><br><span class="line">    name: &quot;&quot;,</span><br><span class="line">    department: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line">const &#123; dataList, loading,  loadData, totals, pageInfo, handleSizeChange, handleCurrentChange &#125; = useHttp(&quot;/permissionList&quot;, searchParams);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-权限弹窗组件开发"><a href="#1-权限弹窗组件开发" class="headerlink" title="1.权限弹窗组件开发"></a>1.权限弹窗组件开发</h2><h3 id="1-定义基本结构"><a href="#1-定义基本结构" class="headerlink" title="1.定义基本结构"></a>1.定义基本结构</h3><p>&#x3D;&#x3D;system-AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-dialog :model-value=&quot;visible&quot; title=&quot;权限设置&quot; width=&quot;600px&quot;&gt;</span><br><span class="line">        权限弹窗</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">    visible: Boolean,</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;system-System.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;AuthModal :visible=&quot;visible&quot;/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">AuthModal</span> <span class="keyword">from</span> <span class="string">&quot;./AuthModal.vue&quot;</span></span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-添加获取当前用户权限接口"><a href="#2-添加获取当前用户权限接口" class="headerlink" title="2.添加获取当前用户权限接口"></a>2.添加获取当前用户权限接口</h3><p>mock设置：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> userMenulist = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;数据看板&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/dashboard&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;DataLine&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;充电站管理&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/chargingstation&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;Lightning&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;充电站监控&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/chargingstation/monitor&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;VideoCamera&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;充电桩管理&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/chargingstation/fault&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;Warning&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;电子地图&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/map&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;MapLocation&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;报警管理&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/alarm&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;Phone&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;会员卡管理&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/equipment&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;Magnet&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;个人中心&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/personal&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;User&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">//获取当前用户权限</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&quot;https://www.demo.com/userAuth&quot;</span>,<span class="string">&quot;post&quot;</span>,<span class="function">(<span class="params">req:<span class="built_in">any</span></span>)=&gt;</span>&#123;</span><br><span class="line"> <span class="comment">//console.log(234,req.body)</span></span><br><span class="line"> <span class="keyword">const</span> &#123;pageAuthority&#125;=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(req.<span class="property">body</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;后端收到当前权限&quot;</span>,pageAuthority)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>:<span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">      <span class="attr">list</span>:pageAuthority==<span class="string">&quot;user&quot;</span>? <span class="attr">userMenulist</span>:(pageAuthority==<span class="string">&quot;manager&quot;</span>?<span class="attr">menulist2</span>:menulist),</span><br><span class="line">      <span class="attr">btn</span>:pageAuthority==<span class="string">&quot;user&quot;</span>?[<span class="string">&#x27;add&#x27;</span>]:(pageAuthority==<span class="string">&quot;manager&quot;</span>?[<span class="string">&#x27;add&#x27;</span>,<span class="string">&quot;edit&quot;</span>]:[<span class="string">&#x27;add&#x27;</span>,<span class="string">&quot;edit&quot;</span>,<span class="string">&quot;all&quot;</span>,<span class="string">&quot;delete&quot;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>api设置</p>
<p>&#x3D;&#x3D;api-system.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    auth = <span class="string">&#x27;/userAuth&#x27;</span>, </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAuthApi</span>(<span class="params">pageAuthority:<span class="built_in">string</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">auth</span>, &#123;pageAuthority&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;getAuthApi&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-获取权限数据"><a href="#3-获取权限数据" class="headerlink" title="3.获取权限数据"></a>3.获取权限数据</h3><p>&#x3D;&#x3D;System.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; size=&quot;small&quot;   @click=&quot;settingAuth(scope.row.pageAuthority)&quot;&gt;</span><br><span class="line">                        权限设置</span><br><span class="line">  &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">settingAuth</span> = <span class="keyword">async</span> (<span class="params">pageAuthority:<span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: &#123; list, btn &#125; &#125; = <span class="keyword">await</span> <span class="title function_">getAuthApi</span>(pageAuthority);</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(list,btn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-在树图中先把所有的菜单渲染出来"><a href="#4-在树图中先把所有的菜单渲染出来" class="headerlink" title="4.在树图中先把所有的菜单渲染出来"></a>4.在树图中先把所有的菜单渲染出来</h3><p>&#x3D;&#x3D;AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-dialog :model-value=&quot;visible&quot; title=&quot;权限设置&quot; width=&quot;600px&quot;&gt;</span><br><span class="line">        &lt;el-card&gt;</span><br><span class="line">            &lt;template #header&gt;</span><br><span class="line">                &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                    &lt;span&gt;页面权限&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;el-tree ref=&quot;treeRef&quot; style=&quot;max-width: 600px&quot; node-key=&quot;url&quot; show-checkbox :data=&quot;treeData&quot;</span><br><span class="line">                @check-change=&quot;handleCheckChange&quot; :check-on-click-node=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; storeToRefs &#125; from &quot;pinia&quot;</span><br><span class="line">import &#123; useUserStore &#125; from &quot;@/store/auth&quot;</span><br><span class="line">import &#123; transformData &#125; from &quot;@/utils/transformMenu&quot;</span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">    visible: Boolean,</span><br><span class="line">&#125;)</span><br><span class="line">const userStore=useUserStore()</span><br><span class="line">const &#123; menu &#125; = storeToRefs(userStore) ;</span><br><span class="line">const treeData = ref(transformData(menu.value));</span><br><span class="line">const treeRef = ref()</span><br><span class="line">const handleCheckChange = () =&gt; &#123;</span><br><span class="line">    console.log(&#x27;checked keys:&#x27;, treeRef.value.getCheckedKeys());</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为menu中的数据跟Tree组件要求的数组格式不一致，所以我们这里封装一个函数,处理menu数据，将其转为Tree组件需要的格式</p>
</blockquote>
<p>&#x3D;&#x3D;utils-transformMenu.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformData</span>(<span class="params">nodes:<span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> nodes.<span class="title function_">map</span>(<span class="function">(<span class="params">node:<span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">newNode</span>:<span class="built_in">any</span> = &#123;</span><br><span class="line">            <span class="attr">label</span>: node.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">url</span>: node.<span class="property">url</span>, <span class="comment">//需要用到url是因为要作为tree组件的node-key来使用</span></span><br><span class="line">           <span class="comment">// icon: node.icon</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">children</span>) &#123;</span><br><span class="line">            newNode.<span class="property">children</span> = <span class="title function_">transformData</span>(node.<span class="property">children</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newNode;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;transformData&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-页面中获取当前权限的菜单数据"><a href="#5-页面中获取当前权限的菜单数据" class="headerlink" title="5.页面中获取当前权限的菜单数据"></a>5.页面中获取当前权限的菜单数据</h3><blockquote>
<p>同理，获取到的数据是一个嵌套的数组对象，我们要动态设置菜单的勾选，我们只需要一个一维的数组，这样就可以设置对应的节点勾选</p>
<p>因此也需要用到一个工具函数，将嵌套的二维或多维数组转成一维，即数组扁平化</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MenuItem</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/user&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; transformData &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/transformMenu&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkedKeys = ref&lt;<span class="built_in">string</span>[]&gt;([])</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">collectUrls</span>(<span class="params">tree:MenuItem[]</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">urls</span>:<span class="built_in">string</span>[] = [];</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">traverse</span>(<span class="params">node:MenuItem</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">url</span>&amp;&amp;!node.<span class="property">children</span>) &#123;</span><br><span class="line">        urls.<span class="title function_">push</span>(node.<span class="property">url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">children</span>) &#123;</span><br><span class="line">      node.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child:MenuItem</span>) =&gt;</span> <span class="title function_">traverse</span>(child));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tree.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node:MenuItem</span>) =&gt;</span> <span class="title function_">traverse</span>(node));</span><br><span class="line">  <span class="keyword">return</span> urls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">settingAuth</span> = <span class="keyword">async</span> (<span class="params">pageAuthority:<span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: &#123; list, btn &#125; &#125; = <span class="keyword">await</span> <span class="title function_">getAuthApi</span>(pageAuthority);</span><br><span class="line">    checkedKeys.<span class="property">value</span> = <span class="title function_">collectUrls</span>(list)</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">99</span>,checkedKeys.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-将动态获取的权限传递给子组件"><a href="#6-将动态获取的权限传递给子组件" class="headerlink" title="6.将动态获取的权限传递给子组件"></a>6.将动态获取的权限传递给子组件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;AuthModal :visible=&quot;visible&quot; ref=&quot;authModal&quot; :checked-keys=&quot;checkedKeys&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>子组件接收</p>
<p>&#x3D;&#x3D;AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog :model-value=&quot;visible&quot; title=&quot;权限设置&quot; width=&quot;600px&quot; @open=&quot;handleOpen&quot;  @close=&quot;handleClose&quot;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> treeRef = <span class="title function_">ref</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleCheckChange</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;checked keys:&#x27;</span>, treeRef.<span class="property">value</span>.<span class="title function_">getCheckedKeys</span>());</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleOpen</span> = (<span class="params"></span>) =&gt; &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">555</span>,props.<span class="property">checkedKeys</span>)</span><br><span class="line">    treeRef.<span class="property">value</span>.<span class="title function_">setCheckedKeys</span>(props.<span class="property">checkedKeys</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleClose</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;close&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-按钮级权限"><a href="#7-按钮级权限" class="headerlink" title="7.按钮级权限"></a>7.按钮级权限</h3><p>&#x3D;&#x3D;System.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;AuthModal :visible=&quot;visible&quot; :checked-keys=&quot;checkedKeys&quot;   @close=&quot;visible = false&quot;  :btnAuth=&quot;btnAuth&quot;/&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> btnAuth=ref&lt;<span class="built_in">string</span>[]&gt;([])</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">settingAuth</span> = <span class="keyword">async</span> (<span class="params">pageAuthority:<span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: &#123; list, btn &#125; &#125; = <span class="keyword">await</span> <span class="title function_">getAuthApi</span>(pageAuthority);</span><br><span class="line">    checkedKeys.<span class="property">value</span> = <span class="title function_">collectUrls</span>(list)</span><br><span class="line">    btnAuth.<span class="property">value</span>=btn</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-card class=&quot;mt&quot;&gt;</span><br><span class="line">           &lt;template #header&gt;</span><br><span class="line">               &lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">                   &lt;span&gt;按钮权限&lt;/span&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line">           &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">           &lt;el-checkbox-group v-model=&quot;initBtnAuth&quot; class=&quot;mt&quot;&gt;</span><br><span class="line">               &lt;el-checkbox label=&quot;全部&quot; value=&quot;all&quot; /&gt;</span><br><span class="line">               &lt;el-checkbox label=&quot;添加&quot; value=&quot;add&quot; /&gt;</span><br><span class="line">               &lt;el-checkbox label=&quot;编辑&quot; value=&quot;edit&quot; /&gt;</span><br><span class="line">               &lt;el-checkbox label=&quot;删除&quot; value=&quot;delete&quot; /&gt;</span><br><span class="line">           &lt;/el-checkbox-group&gt;</span><br><span class="line">       &lt;/el-card&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">checkedKeys</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">btnAuth</span>:<span class="title class_">Array</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleOpen</span> = (<span class="params"></span>) =&gt; &#123; </span><br><span class="line">    treeRef.<span class="property">value</span>.<span class="title function_">setCheckedKeys</span>(props.<span class="property">checkedKeys</span>)</span><br><span class="line">    initBtnAuth.<span class="property">value</span>=props.<span class="property">btnAuth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-提交数据"><a href="#8-提交数据" class="headerlink" title="8.提交数据"></a>8.提交数据</h3><p>&#x3D;&#x3D;AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;setAuthApi&#125; <span class="keyword">from</span> <span class="string">&quot;@/api/system&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;close&#x27;</span>,<span class="string">&quot;reload&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleConfirm</span>=<span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">88</span>,treeRef.<span class="property">value</span>.<span class="title function_">getCheckedKeys</span>(),initBtnAuth.<span class="property">value</span>)  </span><br><span class="line">  <span class="keyword">const</span> res=<span class="keyword">await</span> <span class="title function_">setAuthApi</span>(treeRef.<span class="property">value</span>.<span class="title function_">getCheckedKeys</span>(),initBtnAuth.<span class="property">value</span>);</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&quot;close&quot;</span>) <span class="comment">//关闭弹窗</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&quot;reload&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;AuthModal :visible=&quot;visible&quot; :checked-keys=&quot;checkedKeys&quot;   @close=&quot;visible = false&quot;  :btnAuth=&quot;btnAuth&quot; @reload=&quot;loadData&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="9-传参的时候应该补充上账号名称"><a href="#9-传参的时候应该补充上账号名称" class="headerlink" title="9.传参的时候应该补充上账号名称"></a>9.传参的时候应该补充上账号名称</h3><p>&#x3D;&#x3D;System.vue&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; size=&quot;small&quot;   @click=&quot;settingAuth(scope.row.pageAuthority,scope.row.account)&quot;&gt;</span><br><span class="line">                        权限设置</span><br><span class="line">&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line"> &lt;AuthModal :visible=&quot;visible&quot; :checked-keys=&quot;checkedKeys&quot;   @close=&quot;visible = false&quot;  :btnAuth=&quot;btnAuth&quot; @reload=&quot;loadData&quot; :account=&quot;accoutNo&quot;/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">settingAuth</span> = <span class="keyword">async</span> (<span class="params">pageAuthority:<span class="built_in">string</span>,accout:<span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    accoutNo.<span class="property">value</span>=accout</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: &#123; list, btn &#125; &#125; = <span class="keyword">await</span> <span class="title function_">getAuthApi</span>(pageAuthority);</span><br><span class="line">    checkedKeys.<span class="property">value</span> = <span class="title function_">collectUrls</span>(list)</span><br><span class="line">    btnAuth.<span class="property">value</span>=btn</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>&#x3D;&#x3D;AuthModal.vue&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    <span class="attr">account</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">visible</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">checkedKeys</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">btnAuth</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="title class_">Array</span>,</span><br><span class="line">        <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleConfirm</span>=<span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">88</span>,treeRef.<span class="property">value</span>.<span class="title function_">getCheckedKeys</span>(),initBtnAuth.<span class="property">value</span>)  </span><br><span class="line">  <span class="keyword">const</span> res=<span class="keyword">await</span> <span class="title function_">setAuthApi</span>(props.<span class="property">account</span>,treeRef.<span class="property">value</span>.<span class="title function_">getCheckedKeys</span>(),initBtnAuth.<span class="property">value</span>);</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&quot;close&quot;</span>) <span class="comment">//关闭弹窗</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&quot;reload&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;api-system.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; post &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/http&quot;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Api</span> &#123;</span><br><span class="line">    auth = <span class="string">&#x27;/userAuth&#x27;</span>, </span><br><span class="line">    setAuth=<span class="string">&#x27;setAuth&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAuthApi</span>(<span class="params">pageAuthority:<span class="built_in">string</span></span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">auth</span>, &#123;pageAuthority&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setAuthApi</span>(<span class="params">account:<span class="built_in">string</span>,btnList:<span class="built_in">string</span>[],pageList:<span class="built_in">string</span>[]</span>):<span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">post</span>(<span class="title class_">Api</span>.<span class="property">setAuth</span>,&#123;account,btnList,pageList&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;getAuthApi,setAuthApi&#125;</span><br></pre></td></tr></table></figure>



<h1 id="27-个人中心页面开发"><a href="#27-个人中心页面开发" class="headerlink" title="27.个人中心页面开发"></a>27.个人中心页面开发</h1><p>静态部分及分步表单不做详细介绍</p>
<h2 id="1-按钮级权限控制"><a href="#1-按钮级权限控制" class="headerlink" title="1.按钮级权限控制"></a>1.按钮级权限控制</h2><p>自定义指令的语法</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;指令名&#x27;</span>, 配置项);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myDirective = &#123;</span><br><span class="line">  <span class="comment">// 在绑定元素的 attribute 前</span></span><br><span class="line">  <span class="comment">// 或事件监听器应用前调用</span></span><br><span class="line">  <span class="title function_">created</span>(<span class="params">el, binding, vnode</span>) &#123;</span><br><span class="line">    <span class="comment">// 下面会介绍各个参数的细节</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 在元素被插入到 DOM 前调用</span></span><br><span class="line">  <span class="title function_">beforeMount</span>(<span class="params">el, binding, vnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 在绑定元素的父组件</span></span><br><span class="line">  <span class="comment">// 及他自己的所有子节点都挂载完成后调用</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding, vnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 绑定元素的父组件更新前调用</span></span><br><span class="line">  <span class="title function_">beforeUpdate</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 在绑定元素的父组件</span></span><br><span class="line">  <span class="comment">// 及他自己的所有子节点都更新后调用</span></span><br><span class="line">  <span class="title function_">updated</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 绑定元素的父组件卸载前调用</span></span><br><span class="line">  <span class="title function_">beforeUnmount</span>(<span class="params">el, binding, vnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 绑定元素的父组件卸载后调用</span></span><br><span class="line">  <span class="title function_">unmounted</span>(<span class="params">el, binding, vnode</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置项内容比较多，我们定义单独的文件存储</p>
<p>&#x3D;&#x3D;directives-permission.ts&#x3D;&#x3D;</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/store/auth&quot;</span></span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">beforeMount</span>(<span class="params">el:<span class="built_in">any</span>,binding:<span class="built_in">any</span></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> userStore=<span class="title function_">useUserStore</span>();</span><br><span class="line">        <span class="keyword">const</span> &#123;roles&#125;=userStore;</span><br><span class="line">        <span class="keyword">const</span> requirePermission=binding.<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">if</span>(!roles.<span class="title function_">includes</span>(requirePermission))&#123;</span><br><span class="line">            el.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;none&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要拿到当前用户的角色和该按钮所需要的角色对比，判断当前用户拥有的角色中是否包含该按钮所需的角色，如果不包含，说明权限不够，则按钮隐藏</p>
<blockquote>
<p>使用</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; size=&quot;small&quot; class=&quot;mr&quot; v-permission=&quot;&#x27;user&#x27;&quot;&gt;去处理&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<h1 id="28-环境变量的设置"><a href="#28-环境变量的设置" class="headerlink" title="28.环境变量的设置"></a>28.环境变量的设置</h1><h2 id="1-添加环境变量文件"><a href="#1-添加环境变量文件" class="headerlink" title="1.添加环境变量文件"></a>1.添加环境变量文件</h2><p>在你的项目根目录下，你可以创建不同的环境变量文件。Vite 支持以下类型的文件：</p>
<ul>
<li><code>.env</code>：用于所有环境</li>
<li><code>.env.local</code>：用于本地开发（忽略版本控制）</li>
<li><code>.env.development</code>：用于开发环境</li>
<li><code>.env.production</code>：用于生产环境</li>
</ul>
<h2 id="2-定义环境变量"><a href="#2-定义环境变量" class="headerlink" title="2.定义环境变量"></a>2.定义环境变量</h2><p>环境变量名必须以 <code>VITE_</code> 前缀开头，Vite 只会加载以此前缀开头的环境变量</p>
<p>如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">VITE_API_URL</span>=<span class="attr">https</span>:<span class="comment">//www.demo.com</span></span><br></pre></td></tr></table></figure>

<h2 id="3-访问环境变量"><a href="#3-访问环境变量" class="headerlink" title="3.访问环境变量"></a>3.访问环境变量</h2><ul>
<li>可以在代码中直接使用 <code>import.meta.env</code> 访问这些变量。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_URL</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-获取不同环境变量的原理"><a href="#4-获取不同环境变量的原理" class="headerlink" title="4.获取不同环境变量的原理"></a>4.获取不同环境变量的原理</h2><p>Vite 默认有几个模式，你可以在运行命令时指定不同的模式：</p>
<ul>
<li><p><strong>开发模式</strong>（默认模式）: 使用 <code>vite</code> 或 <code>npm run dev</code> 启动开发服务器。它会使用 <code>.env.development</code> 和 <code>.env</code> 文件。</p>
</li>
<li><p><strong>生产模式</strong>: 使用 <code>vite build</code> 或 <code>npm run build</code> 进行生产构建。它会使用 <code>.env.production</code> 和 <code>.env</code> 文件。</p>
</li>
<li><p><strong>自定义模式</strong>: 你可以通过 Vite 的 <code>--mode</code> 参数指定其他模式。例如，如果你想在测试环境下运行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vite --mode testCopy</span><br></pre></td></tr></table></figure>

<p>这样 Vite 会加载 <code>.env.test</code> 和 <code>.env</code> 文件。</p>
</li>
</ul>
<h2 id="5-修改项目中的接口地址"><a href="#5-修改项目中的接口地址" class="headerlink" title="5.修改项目中的接口地址"></a>5.修改项目中的接口地址</h2><p>&#x3D;&#x3D;utils-axios.ts&#x3D;&#x3D;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">service</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_URL</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h1 id="29-打包上线"><a href="#29-打包上线" class="headerlink" title="29.打包上线"></a>29.打包上线</h1><h2 id="1-打包"><a href="#1-打包" class="headerlink" title="1.打包"></a>1.打包</h2><p>1.运行npm run build</p>
<p>解决打包报错:</p>
<p><img src="D:/Software/Typora/images/image-20241104142504503.png" alt="image-20241104142504503"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">npm install --save-dev <span class="meta">@types</span>/file-saver</span><br></pre></td></tr></table></figure>



<p>打包后生成了dist文件夹，即我们的项目文件</p>
<h2 id="2-部署上线"><a href="#2-部署上线" class="headerlink" title="2.部署上线"></a>2.部署上线</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">ShuoChennn</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/post/355b5773.html">http://example.com/post/355b5773.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ShuoChennn's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/TypeScript/">TypeScript</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a><a class="post-meta__tags" href="/tags/pinia/">pinia</a><a class="post-meta__tags" href="/tags/Vite/">Vite</a><a class="post-meta__tags" href="/tags/Element-plus/">Element-plus</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/post/31ecbc31.html"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">TypeScript学习笔记 by小满zs</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/31ecbc31.html" title="TypeScript学习笔记 by小满zs"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-28</div><div class="title">TypeScript学习笔记 by小满zs</div></div></a></div><div><a href="/post/5b83159.html" title="Vue3学习笔记 by小满zs"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-14</div><div class="title">Vue3学习笔记 by小满zs</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ShuoChennn</div><div class="author-info__description">秋刀鱼也会过期</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客，还在完善！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1.项目介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text">1.项目技术栈</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">2.创建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">常见报错解决：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">3.创建文件夹结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%9F%BA%E6%9C%AC%E8%B7%AF%E7%94%B1%E7%BB%93%E6%9E%84%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">4.</span> <span class="toc-text">4.基本路由结构的创建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE-src%E8%B7%AF%E5%BE%84"><span class="toc-number">5.</span> <span class="toc-text">5.配置@ src路径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E8%B7%AF%E7%94%B1%E6%90%AD%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">6.项目基础路由搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E6%90%AD%E5%BB%BA"><span class="toc-number">7.</span> <span class="toc-text">7.登录页面搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">7.1.</span> <span class="toc-text">1.静态基础结构搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">2.基础逻辑处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%99%BB%E5%BD%95%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86"><span class="toc-number">7.3.</span> <span class="toc-text">3.登录的接口处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-axios%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85"><span class="toc-number">7.4.</span> <span class="toc-text">4.axios二次封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B0%81%E8%A3%85get-post%E8%AF%B7%E6%B1%82"><span class="toc-number">7.5.</span> <span class="toc-text">5.封装get post请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82"><span class="toc-number">7.6.</span> <span class="toc-text">6.创建登录请求</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-useRouter%E4%BD%BF%E7%94%A8%E8%AF%AF%E5%8C%BA"><span class="toc-number">8.</span> <span class="toc-text">8.useRouter使用误区</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB"><span class="toc-number">9.</span> <span class="toc-text">9.导航守卫</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E4%B8%BB%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">10.</span> <span class="toc-text">10.主页面开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%BC%80%E5%8F%91%E4%BE%A7%E8%BE%B9%E6%A0%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">11.</span> <span class="toc-text">11.开发侧边栏组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B0%86%E5%9B%BE%E6%A0%87%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E4%B8%BA%E5%9B%BE%E6%A0%87%E7%BB%84%E4%BB%B6"><span class="toc-number">11.1.</span> <span class="toc-text">2.将图标字符串转为图标组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BC%98%E5%8C%96%E4%BE%A7%E8%BE%B9%E6%A0%8F%E6%A0%B7%E5%BC%8F"><span class="toc-number">11.2.</span> <span class="toc-text">3.优化侧边栏样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%BC%80%E5%90%AF%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">4.开启路由模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%E9%A1%B5%E9%9D%A2"><span class="toc-number">12.</span> <span class="toc-text">12.创建路由页面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E9%A1%B5%E9%9D%A2%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">13.</span> <span class="toc-text">13.页面权限控制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-Header%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">14.</span> <span class="toc-text">14.Header组件开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-%E5%BF%AB%E6%8D%B7%E9%A1%B5%E7%AD%BE%E5%AF%BC%E8%88%AA%E5%BC%80%E5%8F%91"><span class="toc-number">15.</span> <span class="toc-text">15.快捷页签导航开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">15.1.</span> <span class="toc-text">1.基本功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E9%A1%B5%E7%AD%BE"><span class="toc-number">15.2.</span> <span class="toc-text">2.添加页签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E5%92%8C%E9%A1%B5%E7%AD%BE%E5%90%8C%E6%AD%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">15.3.</span> <span class="toc-text">3.左侧菜单和页签同步的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%A7%A3%E5%86%B3%E5%88%B7%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">15.4.</span> <span class="toc-text">4.解决刷新的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">15.5.</span> <span class="toc-text">5.删除功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-%E6%95%B0%E6%8D%AE%E7%9C%8B%E6%9D%BF%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">16.</span> <span class="toc-text">16.数据看板页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AE%BE%E5%A4%87%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="toc-number">16.1.</span> <span class="toc-text">1.设备运行状态模块开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">16.2.</span> <span class="toc-text">2.常用功能页面开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8echarts"><span class="toc-number">16.3.</span> <span class="toc-text">3.使用echarts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%A7%A3%E5%86%B3%E7%AA%97%E5%8F%A3%E5%8F%98%E5%8C%96echarts%E9%80%82%E9%85%8D%E9%97%AE%E9%A2%98"><span class="toc-number">16.4.</span> <span class="toc-text">4.解决窗口变化echarts适配问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B0%81%E8%A3%85useChart%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E5%90%88%E5%BC%8F%E5%87%BD%E6%95%B0"><span class="toc-number">16.5.</span> <span class="toc-text">5.封装useChart自定义组合式函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E7%8E%B0%E7%94%B5%E9%87%8F%E7%BB%9F%E8%AE%A1%E7%9A%84%E5%9B%BE%E8%A1%A8"><span class="toc-number">16.6.</span> <span class="toc-text">6.实现电量统计的图表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%9B%B7%E8%BE%BE%E5%9B%BE"><span class="toc-number">16.7.</span> <span class="toc-text">7.雷达图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%90%A5%E6%94%B6%E7%BB%9F%E8%AE%A1%E8%A1%A8%E5%BC%80%E5%8F%91"><span class="toc-number">16.8.</span> <span class="toc-text">8.营收统计表开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%95%85%E9%9A%9C%E6%8A%A5%E8%AD%A6"><span class="toc-number">16.9.</span> <span class="toc-text">9.故障报警</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-%E5%85%85%E7%94%B5%E7%AB%99%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">17.</span> <span class="toc-text">17.充电站监控页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B6%E9%83%A8%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E5%BC%80%E5%8F%91"><span class="toc-number">17.1.</span> <span class="toc-text">1.顶部静态结构开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A1%A8%E6%A0%BC%E5%BC%80%E5%8F%91"><span class="toc-number">17.2.</span> <span class="toc-text">2.表格开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E9%87%8D%E7%BD%AE%E5%8A%9F%E8%83%BD"><span class="toc-number">17.3.</span> <span class="toc-text">3.查询重置功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%96%B0%E5%A2%9E-x2F-%E7%BC%96%E8%BE%91%E5%85%85%E7%94%B5%E7%AB%99"><span class="toc-number">17.4.</span> <span class="toc-text">4.新增&#x2F;编辑充电站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9E%E7%8E%B0%E5%BC%B9%E7%AA%97%E7%9A%84%E5%BC%80%E5%85%B3%E5%8A%9F%E8%83%BD"><span class="toc-number">17.5.</span> <span class="toc-text">5.实现弹窗的开关功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E7%8E%B0%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD%E5%B8%A6%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">17.6.</span> <span class="toc-text">6.实现编辑功能带入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%96%B0%E5%A2%9E%E5%85%85%E7%94%B5%E7%AB%99"><span class="toc-number">17.7.</span> <span class="toc-text">7.新增充电站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%BC%B9%E6%A1%86%E8%A1%A8%E5%8D%95%E7%A1%AE%E8%AE%A4%E4%BA%8B%E4%BB%B6"><span class="toc-number">17.8.</span> <span class="toc-text">8.弹框表单确认事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%88%A0%E9%99%A4%E5%85%85%E7%94%B5%E7%AB%99"><span class="toc-number">17.9.</span> <span class="toc-text">9.删除充电站</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-%E8%90%A5%E6%94%B6%E7%BB%9F%E8%AE%A1%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">18.</span> <span class="toc-text">18.营收统计页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="toc-number">18.1.</span> <span class="toc-text">1.静态结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9B%BE%E8%A1%A8%E5%BC%80%E5%8F%91"><span class="toc-number">18.2.</span> <span class="toc-text">2.图表开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A1%A8%E6%A0%BC%E5%BC%80%E5%8F%91"><span class="toc-number">18.3.</span> <span class="toc-text">3.表格开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="toc-number">18.4.</span> <span class="toc-text">4.分页功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-%E5%85%85%E7%94%B5%E6%A1%A9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">19.</span> <span class="toc-text">19.充电桩管理页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E5%BC%80%E5%8F%91"><span class="toc-number">19.1.</span> <span class="toc-text">1.静态结构开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AF%B9%E6%8E%A5%E6%8E%A5%E5%8F%A3"><span class="toc-number">19.2.</span> <span class="toc-text">2.对接接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2%E6%A1%86%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">19.3.</span> <span class="toc-text">3.组件中实现搜索框模糊查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8D%95%E9%80%89%E6%8C%89%E9%92%AE%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">19.4.</span> <span class="toc-text">4.单选按钮组查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%85%85%E7%94%B5%E6%A1%A9%E5%88%97%E8%A1%A8"><span class="toc-number">19.5.</span> <span class="toc-text">5.充电桩列表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-%E7%94%B5%E5%AD%90%E5%9C%B0%E5%9B%BE%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">20.</span> <span class="toc-text">20.电子地图页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEapi"><span class="toc-number">20.1.</span> <span class="toc-text">1.高德地图api</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9C%B0%E5%9B%BE%E6%B7%BB%E5%8A%A0%E7%82%B9%E6%A0%87%E8%AE%B0"><span class="toc-number">20.2.</span> <span class="toc-text">2.地图添加点标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%B3%E4%BE%A7%E8%A1%A8%E5%8D%95%E5%BC%80%E5%8F%91"><span class="toc-number">20.3.</span> <span class="toc-text">3.右侧表单开发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">21.</span> <span class="toc-text">21.订单管理页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">21.1.</span> <span class="toc-text">1.静态结构搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BAmock"><span class="toc-number">21.2.</span> <span class="toc-text">2.创建mock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%B0%81%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E5%90%88%E5%BC%8F%E5%87%BD%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">21.3.</span> <span class="toc-text">3.封装自定义组合式函数优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">21.4.</span> <span class="toc-text">4.组件中直接使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%A1%A8%E6%A0%BC%E6%B7%BB%E5%8A%A0%E5%A4%9A%E9%80%89%E5%8A%9F%E8%83%BD"><span class="toc-number">21.5.</span> <span class="toc-text">5.表格添加多选功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%AE%BE%E7%BD%AE%E4%B8%A4%E4%B8%AA%E6%8C%89%E9%92%AE%E7%9A%84%E7%A6%81%E7%94%A8%E7%8A%B6%E6%80%81"><span class="toc-number">21.6.</span> <span class="toc-text">6.设置两个按钮的禁用状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">21.7.</span> <span class="toc-text">7.批量删除功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2"><span class="toc-number">21.8.</span> <span class="toc-text">8.订单详情页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E8%B7%B3%E8%BD%AC%E8%87%B3%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">21.9.</span> <span class="toc-text">9.跳转至订单详情功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%A7%A3%E5%86%B3%E8%AF%A6%E6%83%85%E9%A1%B5%E8%BF%94%E5%9B%9E%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">21.10.</span> <span class="toc-text">10.解决详情页返回缓存问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%AF%BC%E5%87%BA%E8%AE%A2%E5%8D%95%E6%95%B0%E6%8D%AE%E5%88%B0excel"><span class="toc-number">21.11.</span> <span class="toc-text">11.导出订单数据到excel</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-%E8%AE%A1%E8%B4%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">22.</span> <span class="toc-text">22.计费管理页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2%E6%A1%86%E5%BC%80%E5%8F%91"><span class="toc-number">22.1.</span> <span class="toc-text">1.基本搜索框开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE"><span class="toc-number">22.2.</span> <span class="toc-text">2.设置接口数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-tree%E7%BB%84%E4%BB%B6%E8%BF%87%E6%BB%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">22.3.</span> <span class="toc-text">3.tree组件过滤功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%AE%A1%E8%B4%B9%E6%A8%A1%E6%9D%BF%E5%BC%80%E5%8F%91"><span class="toc-number">22.4.</span> <span class="toc-text">4.计费模板开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">22.4.1.</span> <span class="toc-text">作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E9%AA%8C%E8%AF%81"><span class="toc-number">22.5.</span> <span class="toc-text">5.实现动态规则验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A0%91%E7%8A%B6%E5%9B%BE%E5%92%8C%E5%8F%B3%E8%BE%B9%E8%81%94%E5%8A%A8"><span class="toc-number">22.6.</span> <span class="toc-text">6.树状图和右边联动</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-%E6%8A%A5%E8%AD%A6%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">23.</span> <span class="toc-text">23.报警管理页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">23.1.</span> <span class="toc-text">1.接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85elementplus%E7%BB%84%E4%BB%B6%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%88%86%E9%83%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">23.2.</span> <span class="toc-text">2.二次封装elementplus组件，实现分部组件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-%E4%BC%9A%E5%91%98%E5%8D%A1%E7%AE%A1%E7%90%86"><span class="toc-number">24.</span> <span class="toc-text">24.会员卡管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#25-%E6%8B%9B%E5%95%86%E7%AE%A1%E7%90%86"><span class="toc-number">25.</span> <span class="toc-text">25.招商管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%82%B9%E5%87%BB%E9%AB%98%E4%BA%AE%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.1.</span> <span class="toc-text">2.点击高亮功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%8C%E6%95%B4%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.2.</span> <span class="toc-text">3.完整功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">25.3.</span> <span class="toc-text">4.富文本编辑器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85"><span class="toc-number">25.4.</span> <span class="toc-text">1.安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE"><span class="toc-number">25.5.</span> <span class="toc-text">2.详细配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AF%BC%E5%87%BAhtml%E5%8A%9F%E8%83%BD"><span class="toc-number">25.6.</span> <span class="toc-text">3.导出html功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2"><span class="toc-number">26.</span> <span class="toc-text">26.系统设置页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9D%83%E9%99%90%E5%BC%B9%E7%AA%97%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">26.1.</span> <span class="toc-text">1.权限弹窗组件开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">26.1.1.</span> <span class="toc-text">1.定义基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%8E%A5%E5%8F%A3"><span class="toc-number">26.1.2.</span> <span class="toc-text">2.添加获取当前用户权限接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE"><span class="toc-number">26.1.3.</span> <span class="toc-text">3.获取权限数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9C%A8%E6%A0%91%E5%9B%BE%E4%B8%AD%E5%85%88%E6%8A%8A%E6%89%80%E6%9C%89%E7%9A%84%E8%8F%9C%E5%8D%95%E6%B8%B2%E6%9F%93%E5%87%BA%E6%9D%A5"><span class="toc-number">26.1.4.</span> <span class="toc-text">4.在树图中先把所有的菜单渲染出来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%A1%B5%E9%9D%A2%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%9D%83%E9%99%90%E7%9A%84%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">26.1.5.</span> <span class="toc-text">5.页面中获取当前权限的菜单数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%B0%86%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E7%9A%84%E6%9D%83%E9%99%90%E4%BC%A0%E9%80%92%E7%BB%99%E5%AD%90%E7%BB%84%E4%BB%B6"><span class="toc-number">26.1.6.</span> <span class="toc-text">6.将动态获取的权限传递给子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%8C%89%E9%92%AE%E7%BA%A7%E6%9D%83%E9%99%90"><span class="toc-number">26.1.7.</span> <span class="toc-text">7.按钮级权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">26.1.8.</span> <span class="toc-text">8.提交数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E4%BC%A0%E5%8F%82%E7%9A%84%E6%97%B6%E5%80%99%E5%BA%94%E8%AF%A5%E8%A1%A5%E5%85%85%E4%B8%8A%E8%B4%A6%E5%8F%B7%E5%90%8D%E7%A7%B0"><span class="toc-number">26.1.9.</span> <span class="toc-text">9.传参的时候应该补充上账号名称</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#27-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">27.</span> <span class="toc-text">27.个人中心页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8C%89%E9%92%AE%E7%BA%A7%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">27.1.</span> <span class="toc-text">1.按钮级权限控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#28-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">28.</span> <span class="toc-text">28.环境变量的设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6"><span class="toc-number">28.1.</span> <span class="toc-text">1.添加环境变量文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">28.2.</span> <span class="toc-text">2.定义环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AE%BF%E9%97%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">28.3.</span> <span class="toc-text">3.访问环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">28.4.</span> <span class="toc-text">4.获取不同环境变量的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80"><span class="toc-number">28.5.</span> <span class="toc-text">5.修改项目中的接口地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#29-%E6%89%93%E5%8C%85%E4%B8%8A%E7%BA%BF"><span class="toc-number">29.</span> <span class="toc-text">29.打包上线</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%89%93%E5%8C%85"><span class="toc-number">29.1.</span> <span class="toc-text">1.打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF"><span class="toc-number">29.2.</span> <span class="toc-text">2.部署上线</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/355b5773.html" title="能源综合管理平台项目实战"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="能源综合管理平台项目实战"/></a><div class="content"><a class="title" href="/post/355b5773.html" title="能源综合管理平台项目实战">能源综合管理平台项目实战</a><time datetime="2025-07-01T10:56:21.000Z" title="发表于 2025-07-01 18:56:21">2025-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/31ecbc31.html" title="TypeScript学习笔记 by小满zs"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript学习笔记 by小满zs"/></a><div class="content"><a class="title" href="/post/31ecbc31.html" title="TypeScript学习笔记 by小满zs">TypeScript学习笔记 by小满zs</a><time datetime="2025-06-28T09:42:44.000Z" title="发表于 2025-06-28 17:42:44">2025-06-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/5b83159.html" title="Vue3学习笔记 by小满zs"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3学习笔记 by小满zs"/></a><div class="content"><a class="title" href="/post/5b83159.html" title="Vue3学习笔记 by小满zs">Vue3学习笔记 by小满zs</a><time datetime="2025-06-14T09:42:44.000Z" title="发表于 2025-06-14 17:42:44">2025-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/a6f5b56e.html" title="暑期实习｜蚂蚁后端一面：深入源码和操作系统"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="暑期实习｜蚂蚁后端一面：深入源码和操作系统"/></a><div class="content"><a class="title" href="/post/a6f5b56e.html" title="暑期实习｜蚂蚁后端一面：深入源码和操作系统">暑期实习｜蚂蚁后端一面：深入源码和操作系统</a><time datetime="2024-03-25T09:42:44.000Z" title="发表于 2024-03-25 17:42:44">2024-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/54ae0472.html" title="深度学习入门"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深度学习入门"/></a><div class="content"><a class="title" href="/post/54ae0472.html" title="深度学习入门">深度学习入门</a><time datetime="2022-07-19T19:05:17.500Z" title="发表于 2022-07-20 03:05:17">2022-07-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By ShuoChennn</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>